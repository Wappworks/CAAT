
/*
The MIT License

Copyright (c) 2010-2011-2012 Ibon Tolosana [@hyperandroid]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Version: 0.4 build: 275

Created on:
DATE: 2013-11-25
TIME: 16:57:36
*/


var CAAT=CAAT||{};(function(){CAAT.BrowserDetect=function(){this.init();return this};CAAT.BrowserDetect.prototype={browser:"",version:0,OS:"",init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var c=0;c<a.length;c++){var b=a[c].string,d=a[c].prop;this.versionSearchString=a[c].versionSearch||
a[c].identity;if(b){if(-1!==b.indexOf(a[c].subString))return a[c].identity}else if(d)return a[c].identity}},searchVersion:function(a){var c=a.indexOf(this.versionSearchString);if(-1!==c)return parseFloat(a.substring(c+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},
{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",
versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}})();Function.prototype.bind=Function.prototype.bind||function(){var a=this,c=Array.prototype.slice.call(arguments),b=c.shift();return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}};isArray=function(a){return"object"==typeof a&&a instanceof Array};isString=function(a){return"string"==typeof a};
function extend(a,c){var b=a.prototype,d=function(){};d.prototype=c.prototype;a.prototype=new d;a.superclass=c.prototype;a.prototype.constructor=a;c.prototype.constructor===Object.prototype.constructor&&(c.prototype.constructor=c);for(var e in b)b.hasOwnProperty(e)&&(a.prototype[e]=b[e])}
function proxy(a,c,b,d){if("function"===typeof a)return a.__isProxy?a:function(a){var e=function(){c&&c({fn:a,arguments:Array.prototype.slice.call(arguments)});var e=null;try{e=a.apply(a,Array.prototype.slice.call(arguments)),b&&(e=b({fn:a,arguments:Array.prototype.slice.call(arguments)}))}catch(f){if(d)e=d({fn:a,arguments:Array.prototype.slice.call(arguments),exception:f});else throw f;}return e};e.__isProxy=!0;for(var f in a)"function"!==typeof a[f]&&"__object"!==f&&"__isProxy"!==f&&function(c,
a){c.__defineGetter__(f,function(){return a[f]});c.__defineSetter__(f,function(c){a[f]=c})}(e,a);return e}(a);if("object"===!typeof a||isArray(a)||isString(a)||a.__isProxy)return a;var e=new function(){};e.__object=a;e.__isProxy=!0;for(var f in a)"function"===typeof a[f]?e[f]=function(a,e,f){return function(){c&&c({object:a.__object,method:f,arguments:Array.prototype.slice.call(arguments)});var j=null;try{j=e.apply(a.__object,arguments),b&&b({object:a.__object,method:f,arguments:Array.prototype.slice.call(arguments)})}catch(k){if(d)j=
d({object:a.__object,method:f,arguments:Array.prototype.slice.call(arguments),exception:k});else throw k;}return j}}(e,a[f],f):"__object"!==f&&"__isProxy"!==f&&function(c,a){c.__defineGetter__(a,function(){return c.__object[a]});c.__defineSetter__(a,function(b){c.__object[a]=b})}(e,f);return e}
function proxify(a,c,b,d,e,f){for(var g="__"+a+"__",h=window,i=a.split(".");1<i.length;)h=h[i.shift()];window[g]=h[i];(function(a,g,h,i,m){var p=function(){console.log("Creating object of type proxy["+m+"]");var g=new a[i](Array.prototype.slice.call(arguments));g.____name=m;return proxyObject(g,c,b,d,e,f)};p.prototype=a[i].prototype;for(var o in g[h])"function"!==typeof g[h][o]&&"__object"!==o&&"__isProxy"!==o&&function(c,a,b){b.__defineGetter__(a,function(){return c[a]});b.__defineSetter__(a,function(b){c[a]=
b})}(g[h],o,p);g[h]=p})(window,h,i,g,a)}
function proxyObject(a,c,b,d,e,f){if("object"===!typeof a||isArray(a)||isString(a)||a.__isProxy)return a;a.$proxy__isProxy=!0;for(var g in a)if("constructor"!==g)if("function"===typeof a[g]){var h=a[g];a["$proxy__"+g]=h;a[g]=function(a,e,f){return function(){var g=Array.prototype.slice.call(arguments);c&&c({object:a,objectName:a.____name,method:f,arguments:g});var h=null;try{h=e.apply(a,g),b&&b({object:a,objectName:a.____name,method:f,arguments:g})}catch(m){if(d)h=d({object:a,objectName:a.____name,
method:f,arguments:g,exception:m});else throw m;}return h}}(a,h,g)}else"____name"!==g&&function(a,c,b,d){a["$proxy__"+c]=a[c];a.__defineGetter__(c,function(){b&&b(a.____name,c);return a["$proxy__"+c]});a.__defineSetter__(c,function(b){a["$proxy__"+c]=b;d&&d(a.____name,c,b)})}(a,g,e,f);return a};(function(){CAAT.Matrix3=function(){this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};CAAT.Matrix3.prototype={matrix:null,fmatrix:null,transformCoord:function(a){var c=a.x,b=a.y,d=a.z;a.x=c*this.matrix[0][0]+b*this.matrix[0][1]+d*this.matrix[0][2]+this.matrix[0][3];a.y=c*this.matrix[1][0]+b*this.matrix[1][1]+d*this.matrix[1][2]+this.matrix[1][3];a.z=c*this.matrix[2][0]+b*this.matrix[2][1]+d*this.matrix[2][2]+this.matrix[2][3];return a},
transformVect:function(a){var c=a.x,b=a.y,d=a.z;a.x=c*this.matrix[0][0]+b*this.matrix[0][1]+d*this.matrix[0][2];a.y=c*this.matrix[1][0]+b*this.matrix[1][1]+d*this.matrix[1][2];a.z=c*this.matrix[2][0]+b*this.matrix[2][1]+d*this.matrix[2][2];return point},initialize:function(a,c,b,d,e,f,g,h,i){this.identity();this.matrix[0][0]=a;this.matrix[0][1]=c;this.matrix[0][2]=b;this.matrix[1][0]=d;this.matrix[1][1]=e;this.matrix[1][2]=f;this.matrix[2][0]=g;this.matrix[2][1]=h;this.matrix[2][2]=i;return this},
initWithMatrix:function(a){this.matrix=a;return this},flatten:function(){var a=this.fmatrix,c=this.matrix;a[0]=c[0][0];a[1]=c[1][0];a[2]=c[2][0];a[3]=c[3][0];a[4]=c[0][1];a[5]=c[1][1];a[6]=c[2][1];a[7]=c[2][1];a[8]=c[0][2];a[9]=c[1][2];a[10]=c[2][2];a[11]=c[3][2];a[12]=c[0][3];a[13]=c[1][3];a[14]=c[2][3];a[15]=c[3][3];return this.fmatrix},identity:function(){for(var a=0;4>a;a++)for(var c=0;4>c;c++)this.matrix[a][c]=a===c?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(a){return this.rotate(a,
0,0)},rotateXZ:function(a){return this.rotate(0,a,0)},rotateYZ:function(a){return this.rotate(0,0,a)},setRotate:function(a,c,b){this.copy(this.rotate(a,c,b));return this},rotate:function(a,c,b){var d=new CAAT.Matrix3,e,f;0!==a&&(f=new CAAT.Matrix3,e=Math.sin(a),a=Math.cos(a),f.matrix[1][1]=a,f.matrix[1][2]=-e,f.matrix[2][1]=e,f.matrix[2][2]=a,d.multiply(f));0!==c&&(f=new CAAT.Matrix3,e=Math.sin(c),a=Math.cos(c),f.matrix[0][0]=a,f.matrix[0][2]=-e,f.matrix[2][0]=e,f.matrix[2][2]=a,d.multiply(f));0!==
b&&(f=new CAAT.Matrix3,e=Math.sin(b),a=Math.cos(b),f.matrix[0][0]=a,f.matrix[0][1]=-e,f.matrix[1][0]=e,f.matrix[1][1]=a,d.multiply(f));return d},getClone:function(){var a=new CAAT.Matrix3;a.copy(this);return a},multiply:function(a){var c=this.getClone().matrix,b=c[0][0],d=c[0][1],e=c[0][2],f=c[0][3],g=c[1][0],h=c[1][1],i=c[1][2],j=c[1][3],k=c[2][0],l=c[2][1],n=c[2][2],c=c[2][3],m=a.matrix,a=m[0][0],p=m[0][1],o=m[0][2],q=m[0][3],r=m[1][0],s=m[1][1],t=m[1][2],u=m[1][3],v=m[2][0],w=m[2][1],x=m[2][2],
y=m[2][3],z=m[3][0],A=m[3][1],B=m[3][2],m=m[3][3];this.matrix[0][0]=b*a+d*r+e*v+f*z;this.matrix[0][1]=b*p+d*s+e*w+f*A;this.matrix[0][2]=b*o+d*t+e*x+f*B;this.matrix[0][3]=b*q+d*u+e*y+f*m;this.matrix[1][0]=g*a+h*r+i*v+j*z;this.matrix[1][1]=g*p+h*s+i*w+j*A;this.matrix[1][2]=g*o+h*t+i*x+j*B;this.matrix[1][3]=g*q+h*u+i*y+j*m;this.matrix[2][0]=k*a+l*r+n*v+c*z;this.matrix[2][1]=k*p+l*s+n*w+c*A;this.matrix[2][2]=k*o+l*t+n*x+c*B;this.matrix[2][3]=k*q+l*u+n*y+c*m;return this},premultiply:function(a){var c=
this.getClone().matrix,b=c[0][0],d=c[0][1],e=c[0][2],f=c[0][3],g=c[1][0],h=c[1][1],i=c[1][2],j=c[1][3],k=c[2][0],l=c[2][1],n=c[2][2],c=c[2][3],m=a.matrix,a=m[0][0],p=m[0][1],o=m[0][2],q=m[0][3],r=m[1][0],s=m[1][1],t=m[1][2],u=m[1][3],v=m[2][0],w=m[2][1],x=m[2][2],m=m[2][3];this.matrix[0][0]=b*a+d*r+e*v;this.matrix[0][1]=b*p+d*s+e*w;this.matrix[0][2]=b*o+d*t+e*x;this.matrix[0][3]=b*q+d*u+e*m+f;this.matrix[1][0]=g*a+h*r+i*v;this.matrix[1][1]=g*p+h*s+i*w;this.matrix[1][2]=g*o+h*t+i*x;this.matrix[1][3]=
g*q+h*u+i*m+j;this.matrix[2][0]=k*a+l*r+n*v;this.matrix[2][1]=k*p+l*s+n*w;this.matrix[2][2]=k*o+l*t+n*x;this.matrix[2][3]=k*q+l*u+n*m+c;return this},setTranslate:function(a,c,b){this.identity();this.matrix[0][3]=a;this.matrix[1][3]=c;this.matrix[2][3]=b;return this},translate:function(a,c,b){var d=new CAAT.Matrix3;d.setTranslate(a,c,b);return d},setScale:function(a,c,b){this.identity();this.matrix[0][0]=a;this.matrix[1][1]=c;this.matrix[2][2]=b;return this},scale:function(a,c,b){var d=new CAAT.Matrix3;
d.setScale(a,c,b);return d},rotateModelView:function(a,c,b){var d=Math.sin(a),e=Math.sin(c),f=Math.sin(b),a=Math.cos(a),c=Math.cos(c),b=Math.cos(b);this.matrix[0][0]=c*a;this.matrix[0][1]=-c*d;this.matrix[0][2]=e;this.matrix[0][3]=0;this.matrix[1][0]=f*e*a+d*b;this.matrix[1][1]=b*a-f*e*d;this.matrix[1][2]=-f*c;this.matrix[1][3]=0;this.matrix[2][0]=f*d-b*e*a;this.matrix[2][1]=b*e*d+f*a;this.matrix[2][2]=b*c;this.matrix[2][3]=0;this.matrix[3][0]=0;this.matrix[3][1]=0;this.matrix[3][2]=0;this.matrix[3][3]=
1;return this},copy:function(a){for(var c=0;4>c;c++)for(var b=0;4>b;b++)this.matrix[c][b]=a.matrix[c][b];return this},calculateDeterminant:function(){var a=this.matrix,c=a[0][0],b=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],l=a[2][2],n=a[2][3],m=a[3][0],p=a[3][1],o=a[3][2],a=a[3][3];return e*g*l*m+b*i*l*m+e*h*j*p+d*i*j*p+d*f*n*p+c*h*n*p+e*f*k*o+c*i*k*o+d*g*j*a+b*h*j*a+b*f*l*a+c*g*l*a+e*h*k*m-d*i*k*m-d*g*n*m-b*h*n*m-e*f*l*p-c*i*l*p-e*g*j*o-b*i*j*o-b*f*n*
o-c*g*n*o-d*f*k*a-c*h*k*a},getInverse:function(){var a=this.matrix,c=a[0][0],b=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],l=a[2][2],n=a[2][3],m=a[3][0],p=a[3][1],o=a[3][2],a=a[3][3],q=new CAAT.Matrix3;q.matrix[0][0]=h*n*p+i*k*o+g*l*a-i*l*p-g*n*o-h*k*a;q.matrix[0][1]=e*l*p+b*n*o+d*k*a-b*l*a-d*n*p-e*k*o;q.matrix[0][2]=d*i*p+b*h*a+e*g*o-b*i*o-d*g*a-e*h*p;q.matrix[0][3]=e*h*k+b*i*l+d*g*n-d*i*k-e*g*l-b*h*n;q.matrix[1][0]=i*l*m+f*n*o+h*j*a-h*n*m-i*j*o-f*l*a;
q.matrix[1][1]=d*n*m+e*j*o+c*l*a-e*l*m-c*n*o-d*j*a;q.matrix[1][2]=e*h*m+c*i*o+d*f*a-d*i*m-e*f*o-c*h*a;q.matrix[1][3]=d*i*j+e*f*l+c*h*n-e*h*j-c*i*l-d*f*n;q.matrix[2][0]=g*n*m+i*j*p+f*k*a-i*k*m-f*n*p-g*j*a;q.matrix[2][1]=e*k*m+c*n*p+b*j*a-c*k*a-b*n*m-e*j*p;q.matrix[2][2]=d*i*m+e*f*p+c*g*a-e*g*m-c*i*p-b*f*a;q.matrix[2][3]=e*g*j+c*i*k+b*f*n-c*g*n-b*i*j-e*f*k;q.matrix[3][0]=h*k*m+f*l*p+g*j*o-g*l*m-h*j*p-f*k*o;q.matrix[3][1]=b*l*m+d*j*p+c*k*o-d*k*m-c*l*p-b*j*o;q.matrix[3][2]=d*g*m+c*h*p+b*f*o-c*g*o-b*h*
m-d*f*p;q.matrix[3][3]=b*h*j+d*f*k+c*g*l-d*g*j-c*h*k-b*f*l;return q.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(a){var c,b;for(c=0;4>c;c++)for(b=0;4>b;b++)this.matrix[c][b]*=a;return this}}})();
(function(){CAAT.Matrix=function(){this.matrix=[1,0,0,0,1,0,0,0,1];"undefined"!==typeof Float32Array&&(this.matrix=new Float32Array(this.matrix));return this};CAAT.Matrix.prototype={matrix:null,transformCoord:function(a){var c=a.x,b=a.y,d=this.matrix;a.x=c*d[0]+b*d[1]+d[2];a.y=c*d[3]+b*d[4]+d[5];return a},transformVect:function(a){var c=a.x,b=a.y,d=this.matrix;a.x=c*d[0]+b*d[1];a.y=c*d[3]+b*d[4];return a},rotate:function(a){var c=new CAAT.Matrix;c.setRotation(a);return c},setRotation:function(a){this.identity();
var c=this.matrix,b=Math.cos(a),a=Math.sin(a);c[0]=b;c[1]=-a;c[3]=a;c[4]=b;return this},scale:function(a,c){var b=new CAAT.Matrix;b.matrix[0]=a;b.matrix[4]=c;return b},setScale:function(a,c){this.identity();this.matrix[0]=a;this.matrix[4]=c;return this},translate:function(a,c){var b=new CAAT.Matrix;b.matrix[2]=a;b.matrix[5]=c;return b},setTranslate:function(a,c){this.identity();this.matrix[2]=a;this.matrix[5]=c;return this},copy:function(a){var a=a.matrix,c=this.matrix;c[0]=a[0];c[1]=a[1];c[2]=a[2];
c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return this},identity:function(){var a=this.matrix;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this},multiply:function(a){var c=this.matrix,b=a.matrix,a=c[0],d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],i=c[6],j=c[7],k=c[8],l=b[0],n=b[1],m=b[2],p=b[3],o=b[4],q=b[5],r=b[6],s=b[7],b=b[8];c[0]=a*l+d*p+e*r;c[1]=a*n+d*o+e*s;c[2]=a*m+d*q+e*b;c[3]=f*l+g*p+h*r;c[4]=f*n+g*o+h*s;c[5]=f*m+g*q+h*b;c[6]=i*l+j*p+k*r;c[7]=i*n+j*o+k*s;c[8]=
i*m+j*q+k*b;return this},premultiply:function(a){var c=a.matrix[0]*this.matrix[1]+a.matrix[1]*this.matrix[4]+a.matrix[2]*this.matrix[7],b=a.matrix[0]*this.matrix[2]+a.matrix[1]*this.matrix[5]+a.matrix[2]*this.matrix[8],d=a.matrix[3]*this.matrix[0]+a.matrix[4]*this.matrix[3]+a.matrix[5]*this.matrix[6],e=a.matrix[3]*this.matrix[1]+a.matrix[4]*this.matrix[4]+a.matrix[5]*this.matrix[7],f=a.matrix[3]*this.matrix[2]+a.matrix[4]*this.matrix[5]+a.matrix[5]*this.matrix[8],g=a.matrix[6]*this.matrix[0]+a.matrix[7]*
this.matrix[3]+a.matrix[8]*this.matrix[6],h=a.matrix[6]*this.matrix[1]+a.matrix[7]*this.matrix[4]+a.matrix[8]*this.matrix[7],i=a.matrix[6]*this.matrix[2]+a.matrix[7]*this.matrix[5]+a.matrix[8]*this.matrix[8];this.matrix[0]=a.matrix[0]*this.matrix[0]+a.matrix[1]*this.matrix[3]+a.matrix[2]*this.matrix[6];this.matrix[1]=c;this.matrix[2]=b;this.matrix[3]=d;this.matrix[4]=e;this.matrix[5]=f;this.matrix[6]=g;this.matrix[7]=h;this.matrix[8]=i;return this},getInverse:function(){var a=this.matrix,c=a[0],b=
a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],a=a[8],j=new CAAT.Matrix,k=c*(f*a-i*g)-e*(b*a-i*d)+h*(b*g-f*d);if(0===k)return null;var l=j.matrix;l[0]=f*a-g*i;l[1]=d*i-b*a;l[2]=b*g-d*f;l[3]=g*h-e*a;l[4]=c*a-d*h;l[5]=d*e-c*g;l[6]=e*i-f*h;l[7]=b*h-c*i;l[8]=c*f-b*e;j.multiplyScalar(1/k);return j},multiplyScalar:function(a){var c;for(c=0;9>c;c++)this.matrix[c]*=a;return this},transformRenderingContextSet:null,transformRenderingContext:null,transformRenderingContextSet_NoClamp:function(a){var c=this.matrix;
a.setTransform(c[0],c[3],c[1],c[4],c[2],c[5]);return this},transformRenderingContext_NoClamp:function(a){var c=this.matrix;a.transform(c[0],c[3],c[1],c[4],c[2],c[5]);return this},transformRenderingContextSet_Clamp:function(a){var c=this.matrix;a.setTransform(c[0],c[3],c[1],c[4],c[2]>>0,c[5]>>0);return this},transformRenderingContext_Clamp:function(a){var c=this.matrix;a.transform(c[0],c[3],c[1],c[4],c[2]>>0,c[5]>>0);return this}};CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp;
CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp})();
(function(){CAAT.MatrixStack=function(){this.stack=[];this.saved=[];return this};CAAT.MatrixStack.prototype={stack:null,saved:null,pushMatrix:function(a){this.stack.push(a);return this},popMatrix:function(){return this.stack.pop()},save:function(){this.saved.push(this.stack.length);return this},restore:function(){for(var a=this.saved.pop();this.stack.length!==a;)this.popMatrix();return this},getMatrix:function(){for(var a=new CAAT.Matrix,c=0;c<this.stack.length;c++)a.multiply(this.stack[c]);return a}}})();(function(){CAAT.Color={hsvToRgb:function(a,c,b){var d,e,f,a=Math.max(0,Math.min(360,a)),c=Math.max(0,Math.min(100,c)),b=Math.max(0,Math.min(100,b)),c=c/100,b=b/100;if(0===c)return d=c=b,[Math.round(255*d),Math.round(255*c),Math.round(255*b)];a/=60;d=Math.floor(a);e=a-d;a=b*(1-c);f=b*(1-c*e);e=b*(1-c*(1-e));switch(d){case 0:d=b;c=e;b=a;break;case 1:d=f;c=b;b=a;break;case 2:d=a;c=b;b=e;break;case 3:d=a;c=f;break;case 4:d=e;c=a;break;default:d=b,c=a,b=f}return new CAAT.Color.RGB(Math.round(255*d),Math.round(255*
c),Math.round(255*b))},RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},interpolate:function(a,c,b,d,e,f,g){if(0>=g)return{r:a,g:c,b:b};if(1<=g)return{r:d,g:e,b:f};a=a+(d-a)*g>>0;c=c+(e-c)*g>>0;b=b+(f-b)*g>>0;255<a?a=255:0>a&&(a=0);255<c?c=255:0>c&&(c=0);255<b?b=255:0>b&&(b=0);return{r:a,g:c,b:b}},makeRGBColorRamp:function(a,c,b){var d=[],e=a.length-1,c=c/e,f,g,h,i,j,k,l,n,m,p,o,q,r,s;for(f=0;f<e;f+=1){l=a[f];n=l>>24&
255;m=(l&16711680)>>16;p=(l&65280)>>8;l&=255;g=a[f+1];o=g>>24&255;q=(g&16711680)>>16;r=(g&65280)>>8;g&=255;o=(o-n)/c;q=(q-m)/c;r=(r-p)/c;s=(g-l)/c;for(g=0;g<c;g+=1)switch(h=n+o*g>>0,i=m+q*g>>0,j=p+r*g>>0,k=l+s*g>>0,b){case this.RampEnumeration.RAMP_RGBA:d.push("argb("+h+","+i+","+j+","+k+")");break;case this.RampEnumeration.RAMP_RGB:d.push("rgb("+i+","+j+","+k+")");break;case this.RampEnumeration.RAMP_CHANNEL_RGB:d.push(4278190080|i<<16|j<<8|k);break;case this.RampEnumeration.RAMP_CHANNEL_RGBA:d.push(h<<
24|i<<16|j<<8|k);break;case this.RampEnumeration.RAMP_CHANNEL_RGBA_ARRAY:d.push([i,j,k,h]);break;case this.RampEnumeration.RAMP_CHANNEL_RGB_ARRAY:d.push([i,j,k])}}return d}}})();
(function(){CAAT.Color.RGB=function(a,c,b){this.r=a;this.g=c;this.b=b;return this};CAAT.Color.RGB.fromHex=function(a){var c=0,b,d;"#"===a.charAt(0)&&(c=1);b=parseInt(a.substring(c,c+2),16);d=parseInt(a.substring(c+2,c+4),16);a=parseInt(a.substring(c+4,c+6),16);return new CAAT.Color.RGB(b,d,a)};CAAT.Color.RGB.prototype={r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}})();(function(){CAAT.Rectangle=function(){return this};CAAT.Rectangle.prototype={x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){this.height=this.width=-1;this.y1=this.x1=this.y=this.x=0;return this},setPosition:function(a,c){this.x=a;this.y=c;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setDimension:function(a,c){this.width=a;this.height=c;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setBounds:function(a,c,b,d){this.setPosition(a,c);this.setDimension(b,
d);return this},contains:function(a,c){return a>=this.x&&a<this.x1&&c>=this.y&&c<this.y1},isEmpty:function(){return-1===this.width&&-1===this.height},union:function(a,c){this.isEmpty()?(this.x1=this.x=a,this.y1=this.y=c,this.height=this.width=0):(this.x1=this.x+this.width,this.y1=this.y+this.height,c<this.y&&(this.y=c),a<this.x&&(this.x=a),c>this.y1&&(this.y1=c),a>this.x1&&(this.x1=a),this.width=this.x1-this.x,this.height=this.y1-this.y)},unionRectangle:function(a){this.union(a.x,a.y);this.union(a.x1,
a.y);this.union(a.x,a.y1);this.union(a.x1,a.y1);return this},intersects:function(a){return a.isEmpty()||this.isEmpty()||a.x1<=this.x||a.x>=this.x1||a.y1<=this.y||a.y>=this.y1?!1:!0},intersectsRect:function(a,c,b,d){return-1===b||-1===d||a+b-1<this.x||a>this.x1||c+d-1<this.y||c>this.y1?!1:!0},intersect:function(a,c){"undefined"===typeof c&&(c=new CAAT.Rectangle);c.x=Math.max(this.x,a.x);c.y=Math.max(this.y,a.y);c.x1=Math.min(this.x1,a.x1);c.y1=Math.min(this.y1,a.y1);c.width=c.x1-c.x;c.height=c.y1-
c.y;return c}}})();(function(){CAAT.Curve=function(){return this};CAAT.Curve.prototype={coordlist:null,k:0.05,length:-1,interpolator:!1,HANDLE_SIZE:20,drawHandles:!0,paint:function(a){if(!1!==this.drawHandles){var c=this.coordlist,a=a.ctx;a.save();a.beginPath();a.strokeStyle="#a0a0a0";a.moveTo(c[0].x,c[0].y);a.lineTo(c[1].x,c[1].y);a.stroke();this.cubic&&(a.moveTo(c[2].x,c[2].y),a.lineTo(c[3].x,c[3].y),a.stroke());a.globalAlpha=0.5;for(var b=0;b<this.coordlist.length;b++){a.fillStyle="#7f7f00";var d=CAAT.Curve.prototype.HANDLE_SIZE/
2;a.beginPath();a.arc(c[b].x,c[b].y,d,0,2*Math.PI,!1);a.fill()}a.restore()}},update:function(){this.calcLength()},solve:function(){},getContour:function(a){var c=[],b;for(b=0;b<=a;b++){var d=new CAAT.Point;this.solve(d,b/a);c.push(d)}return c},getBoundingBox:function(a){a||(a=new CAAT.Rectangle);a.setEmpty();a.union(this.coordlist[0].x,this.coordlist[0].y);for(var c=new CAAT.Point,b=this.k;b<=1+this.k;b+=this.k)this.solve(c,b),a.union(c.x,c.y);return a},calcLength:function(){var a,c;a=this.coordlist[0].x;
c=this.coordlist[0].y;for(var b=0,d=new CAAT.Point,e=this.k;e<=1+this.k;e+=this.k)this.solve(d,e),b+=Math.sqrt((d.x-a)*(d.x-a)+(d.y-c)*(d.y-c)),a=d.x,c=d.y;return this.length=b},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(){},setPoint:function(a,c){0<=c&&c<this.coordlist.length&&(this.coordlist[c]=a)},applyAsPath:function(){}}})();
(function(){CAAT.Bezier=function(){CAAT.Bezier.superclass.constructor.call(this);return this};CAAT.Bezier.prototype={cubic:!1,applyAsPath:function(a){var c=this.coordlist;this.cubic?a.ctx.bezierCurveTo(c[1].x,c[1].y,c[2].x,c[2].y,c[3].x,c[3].y):a.ctx.quadraticCurveTo(c[1].x,c[1].y,c[2].x,c[2].y);return this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(a,c,b,d,e,f,g,h){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(a,c));this.coordlist.push((new CAAT.Point).set(b,
d));this.coordlist.push((new CAAT.Point).set(e,f));this.coordlist.push((new CAAT.Point).set(g,h));this.cubic=!0;this.update();return this},setQuadric:function(a,c,b,d,e,f){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(a,c));this.coordlist.push((new CAAT.Point).set(b,d));this.coordlist.push((new CAAT.Point).set(e,f));this.cubic=!1;this.update();return this},setPoints:function(a){if(3===a.length)this.coordlist=a,this.cubic=!1,this.update();else if(4===a.length)this.coordlist=a,this.cubic=
!0,this.update();else throw"points must be an array of 3 or 4 CAAT.Point instances.";return this},paint:function(a){this.cubic?this.paintCubic(a):this.paintCuadric(a);CAAT.Bezier.superclass.paint.call(this,a)},paintCuadric:function(a){var c,b;c=this.coordlist[0].x;b=this.coordlist[0].y;a=a.ctx;a.save();a.beginPath();a.moveTo(c,b);c=new CAAT.Point;for(b=this.k;b<=1+this.k;b+=this.k)this.solve(c,b),a.lineTo(c.x,c.y);a.stroke();a.restore()},paintCubic:function(a){var c,b;c=this.coordlist[0].x;b=this.coordlist[0].y;
a=a.ctx;a.save();a.beginPath();a.moveTo(c,b);c=new CAAT.Point;for(b=this.k;b<=1+this.k;b+=this.k)this.solve(c,b),a.lineTo(c.x,c.y);a.stroke();a.restore()},solve:function(a,c){return this.cubic?this.solveCubic(a,c):this.solveQuadric(a,c)},solveCubic:function(a,c){var b=c*c,d=c*b,e=this.coordlist,f=e[0],g=e[1],h=e[2],e=e[3];a.x=f.x+c*(3*-f.x+c*(3*f.x-f.x*c))+c*(3*g.x+c*(-6*g.x+3*g.x*c))+b*(3*h.x-3*h.x*c)+e.x*d;a.y=f.y+c*(3*-f.y+c*(3*f.y-f.y*c))+c*(3*g.y+c*(-6*g.y+3*g.y*c))+b*(3*h.y-3*h.y*c)+e.y*d;return a},
solveQuadric:function(a,c){var b=this.coordlist,d=b[0],e=b[1],b=b[2],f=1-c;a.x=f*f*d.x+2*f*c*e.x+c*c*b.x;a.y=f*f*d.y+2*f*c*e.y+c*c*b.y;return a}};extend(CAAT.Bezier,CAAT.Curve,null)})();
(function(){CAAT.CatmullRom=function(){CAAT.CatmullRom.superclass.constructor.call(this);return this};CAAT.CatmullRom.prototype={setCurve:function(a,c,b,d){this.coordlist=[];this.coordlist.push(a);this.coordlist.push(c);this.coordlist.push(b);this.coordlist.push(d);this.update();return this},paint:function(a){var c,b;c=this.coordlist[1].x;b=this.coordlist[1].y;var d=a.ctx;d.save();d.beginPath();d.moveTo(c,b);c=new CAAT.Point;for(b=this.k;b<=1+this.k;b+=this.k)this.solve(c,b),d.lineTo(c.x,c.y);d.stroke();
d.restore();CAAT.CatmullRom.superclass.paint.call(this,a)},solve:function(a,c){var b=this.coordlist,d=0.5*((-c+2)*c-1)*c,e=0.5*((3*c-5)*c*c+2),f=0.5*((-3*c+4)*c+1)*c,g=0.5*(c-1)*c*c;a.x=b[0].x*d+b[1].x*e+b[2].x*f+b[3].x*g;a.y=b[0].y*d+b[1].y*e+b[2].y*f+b[3].y*g;return a},applyAsPath:function(a){for(var a=a.ctx,c=new CAAT.Point,b=this.k;b<=1+this.k;b+=this.k)this.solve(c,b),a.lineTo(c.x,c.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}};
extend(CAAT.CatmullRom,CAAT.Curve,null)})();(function(){CAAT.Point=function(a,c,b){this.x=a;this.y=c;this.z=b||0;return this};CAAT.Point.prototype={x:0,y:0,z:0,set:function(a,c,b){this.x=a;this.y=c;this.z=b||0;return this},clone:function(){return new CAAT.Point(this.x,this.y,this.z)},translate:function(a,c,b){this.x+=a;this.y+=c;this.z+=b;return this},translatePoint:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},rotate:function(a){var c=this.x,b=this.y;this.x=c*Math.cos(a)-Math.sin(a)*b;this.y=c*Math.sin(a)+Math.cos(a)*b;this.z=0;return this},setAngle:function(a){var c=this.getLength();this.x=Math.cos(a)*c;this.y=Math.sin(a)*c;this.z=0;return this},setLength:function(a){var c=this.getLength();c?this.multiply(a/c):this.x=this.y=this.z=a;return this},normalize:function(){var a=this.getLength();this.x/=a;this.y/=a;this.z/=a;return this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(a){var c=
this.getLengthSquared();c+0.01>a*a&&(c=Math.sqrt(c),this.x=this.x/c*a,this.y=this.y/c*a,this.z=this.z/c*a);return this},getLength:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0.005>a&&-0.005<a?1.0E-6:a},getLengthSquared:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;return 0.005>a&&-0.005<a?0:a},getDistance:function(a){var c=this.x-a.x,b=this.y-a.y,a=this.z-a.z;return Math.sqrt(c*c+b*b+a*a)},getDistanceSquared:function(a){var c=this.x-a.x,b=this.y-a.y,a=
this.z-a.z;return c*c+b*b+a*a},toString:function(){return"(CAAT.Point) x:"+Math.round(Math.floor(10*this.x))/10+" y:"+(""+Math.round(Math.floor(10*this.y))/10)+" z:"+(""+Math.round(Math.floor(10*this.z))/10)}}})();(function(){CAAT.QuadTree=function(){return this};CAAT.QuadTree.prototype={bgActors:null,quadData:null,create:function(a,c,b,d,e,f,g){"undefined"===typeof f&&(f=32);"undefined"===typeof g&&(g=1);var h=(a+b)/2,i=(c+d)/2;this.x=a;this.y=c;this.x1=b;this.y1=d;this.width=b-a;this.height=d-c;this.bgActors=this.__getOverlappingActorList(e);if(this.bgActors.length<=g||this.width<=f)return this;this.quadData=Array(4);this.quadData[0]=(new CAAT.QuadTree).create(a,c,h,i,this.bgActors);this.quadData[1]=(new CAAT.QuadTree).create(h,
c,b,i,this.bgActors);this.quadData[2]=(new CAAT.QuadTree).create(a,i,h,d,this.bgActors);this.quadData[3]=(new CAAT.QuadTree).create(h,i,b,d,this.bgActors);return this},__getOverlappingActorList:function(a){for(var c=[],b=0,d=a.length;b<d;b++){var e=a[b];this.intersects(e.AABB)&&c.push(e)}return c},getOverlappingActors:function(a){var c,b,d,e=[],f;b=this.bgActors;if(this.quadData)for(c=0;4>c;c++){if(this.quadData[c].intersects(a)){f=this.quadData[c].getOverlappingActors(a);b=0;for(d=f.length;b<d;b++)e.push(f[b])}}else{c=
0;for(d=b.length;c<d;c++)f=b[c],a.intersects(f.AABB)&&e.push(f)}return e}};extend(CAAT.QuadTree,CAAT.Rectangle)})();
(function(){CAAT.SpatialHash=function(){return this};CAAT.SpatialHash.prototype={elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(a,c,b,d){var e;this.elements=[];for(e=0;e<b*d;e++)this.elements.push([]);this.width=a;this.height=c;this.rows=b;this.columns=d;this.xcache=[];for(e=0;e<a;e++)this.xcache.push(e/(a/d)>>0);this.ycache=[];for(e=0;e<c;e++)this.ycache.push(e/(c/b)>>0);this.xycache=[];for(e=0;e<
this.rows;e++){this.xycache.push([]);for(b=0;b<this.columns;b++)this.xycache[e].push(b+e*d)}this.rectangle=(new CAAT.Rectangle).setBounds(0,0,a,c);this.r0=new CAAT.Rectangle;this.r1=new CAAT.Rectangle;return this},clearObject:function(){var a;for(a=0;a<this.rows*this.columns;a++)this.elements[a]=[];return this},addObject:function(a){for(var c=this.__getCells(a.x|0,a.y|0,a.width|0,a.height|0),b=0;b<c.length;b++)this.elements[c[b]].push(a)},__getCells:function(a,c,b,d){var e=[];this.rectangle.contains(a,
c)&&e.push(this.xycache[this.ycache[c]][this.xcache[a]]);if(this.rectangle.contains(a+b-1,c+d-1)){var f=this.xycache[this.ycache[c+d-1]][this.xcache[a+b-1]];if(f===e[0])return e;e.push(f)}if(this.rectangle.contains(a+b-1,c)){f=this.xycache[this.ycache[c]][this.xcache[a+b-1]];if(f===e[0]||f===e[1])return e;e.push(f)}this.rectangle.contains(a+b-1,c+d-1)&&(f=this.xycache[this.ycache[c+d-1]][this.xcache[a]],e.push(f));return e},solveCollision:function(a){var c;for(c=0;c<this.elements.length;c++){var b=
this.elements[c];1<b.length&&this._solveCollisionCell(b,a)}},_solveCollisionCell:function(a,c){var b,d;for(b=0;b<a.length;b++){var e=a[b];this.r0.setBounds(e.x,e.y,e.width,e.height);for(d=b+1;d<a.length;d++){var f=a[d];this.r0.intersects(this.r1.setBounds(f.x,f.y,f.width,f.height))&&c(e,f)}}},collide:function(a,c,b,d,e){var a=a|0,c=c|0,b=b|0,d=d|0,f=this.__getCells(a,c,b,d),g=this.elements;this.r0.setBounds(a,c,b,d);for(a=0;a<f.length;a++){d=g[f[a]];c=0;for(b=d.length;c<b;c++){var h=d[c];this.r1.setBounds(h.x,
h.y,h.width,h.height);if(this.r0.intersects(this.r1)&&e(h))return}}}}})();(function(){CAAT.Interpolator=function(){this.interpolated=new CAAT.Point(0,0,0);return this};CAAT.Interpolator.prototype={interpolated:null,paintScale:90,createLinearInterpolator:function(a,c){this.getPosition=function(b){var d=b;a&&(b=0.5>b?2*b:1-2*(b-0.5));null!==c&&c&&(b=1-b);return this.interpolated.set(d,b)};return this},createBackOutInterpolator:function(a){this.getPosition=function(c){var b=c;a&&(c=0.5>c?2*c:1-2*(c-0.5));c-=1;return this.interpolated.set(b,c*c*(2.70158*c+1.70158)+1)};return this},
createExponentialInInterpolator:function(a,c){this.getPosition=function(b){var d=b;c&&(b=0.5>b?2*b:1-2*(b-0.5));return this.interpolated.set(d,Math.pow(b,a))};return this},createExponentialOutInterpolator:function(a,c){this.getPosition=function(b){var d=b;c&&(b=0.5>b?2*b:1-2*(b-0.5));return this.interpolated.set(d,1-Math.pow(1-b,a))};return this},createExponentialInOutInterpolator:function(a,c){this.getPosition=function(b){var d=b;c&&(b=0.5>b?2*b:1-2*(b-0.5));return 1>2*b?this.interpolated.set(d,
Math.pow(2*b,a)/2):this.interpolated.set(d,1-Math.abs(Math.pow(2*b-2,a))/2)};return this},createQuadricBezierInterpolator:function(a,c,b,d){this.getPosition=function(e){var f=e;d&&(e=0.5>e?2*e:1-2*(e-0.5));e=(1-e)*(1-e)*a.y+2*(1-e)*e*c.y+e*e*b.y;return this.interpolated.set(f,e)};return this},createCubicBezierInterpolator:function(a,c,b,d,e){this.getPosition=function(f){var g=f;e&&(f=0.5>f?2*f:1-2*(f-0.5));var h=f*f,f=a.y+f*(3*-a.y+f*(3*a.y-a.y*f))+f*(3*c.y+f*(-6*c.y+3*c.y*f))+h*(3*b.y-3*b.y*f)+d.y*
f*h;return this.interpolated.set(g,f)};return this},createElasticOutInterpolator:function(a,c,b){this.getPosition=function(d){b&&(d=0.5>d?2*d:1-2*(d-0.5));if(0===d)return{x:0,y:0};if(1===d)return{x:1,y:1};var e=c/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(d,a*Math.pow(2,-10*d)*Math.sin((d-e)*2*Math.PI/c)+1)};return this},createElasticInInterpolator:function(a,c,b){this.getPosition=function(d){b&&(d=0.5>d?2*d:1-2*(d-0.5));if(0===d)return{x:0,y:0};if(1===d)return{x:1,y:1};var e=c/(2*Math.PI)*
Math.asin(1/a);return this.interpolated.set(d,-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*2*Math.PI/c)))};return this},createElasticInOutInterpolator:function(a,c,b){this.getPosition=function(d){b&&(d=0.5>d?2*d:1-2*(d-0.5));var e=c/(2*Math.PI)*Math.asin(1/a),d=2*d;return 1>=d?this.interpolated.set(d,-0.5*a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*2*Math.PI/c)):this.interpolated.set(d,1+0.5*a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*2*Math.PI/c))};return this},bounce:function(a){return(a/=1)<1/2.75?{x:a,y:7.5625*
a*a}:a<2/2.75?{x:a,y:7.5625*(a-=1.5/2.75)*a+0.75}:a<2.5/2.75?{x:a,y:7.5625*(a-=2.25/2.75)*a+0.9375}:{x:a,y:7.5625*(a-=2.625/2.75)*a+0.984375}},createBounceOutInterpolator:function(a){this.getPosition=function(c){a&&(c=0.5>c?2*c:1-2*(c-0.5));return this.bounce(c)};return this},createBounceInInterpolator:function(a){this.getPosition=function(c){a&&(c=0.5>c?2*c:1-2*(c-0.5));c=this.bounce(1-c);c.y=1-c.y;return c};return this},createBounceInOutInterpolator:function(a){this.getPosition=function(c){a&&(c=
0.5>c?2*c:1-2*(c-0.5));if(0.5>c)return c=this.bounce(1-2*c),c.y=0.5*(1-c.y),c;c=this.bounce(2*c-1,a);c.y=0.5*c.y+0.5;return c};return this},paint:function(a){a=a.crc;a.save();a.beginPath();a.moveTo(0,this.getPosition(0).y*this.paintScale);for(var c=0;c<=this.paintScale;c++)a.lineTo(c,this.getPosition(c/this.paintScale).y*this.paintScale);a.strokeStyle="black";a.stroke();a.restore()},getContour:function(a){for(var c=[],b=0;b<=a;b++)c.push({x:b/a,y:this.getPosition(b/a).y});return c},enumerateInterpolators:function(){return[(new CAAT.Interpolator).createLinearInterpolator(!1,
!1),"Linear pingpong=false, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(!0,!1),"Linear pingpong=true, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(!1,!0),"Linear pingpong=false, inverse=true",(new CAAT.Interpolator).createLinearInterpolator(!0,!0),"Linear pingpong=true, inverse=true",(new CAAT.Interpolator).createExponentialInInterpolator(2,!1),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,!1),"ExponentialOut pingpong=false, exponent=2",
(new CAAT.Interpolator).createExponentialInOutInterpolator(2,!1),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(2,!0),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,!0),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInOutInterpolator(2,!0),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(4,!1),"ExponentialIn pingpong=false, exponent=4",
(new CAAT.Interpolator).createExponentialOutInterpolator(4,!1),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,!1),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInInterpolator(4,!0),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialOutInterpolator(4,!0),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,!0),"ExponentialInOut pingpong=true, exponent=4",
(new CAAT.Interpolator).createExponentialInInterpolator(6,!1),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,!1),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInOutInterpolator(6,!1),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInInterpolator(6,!0),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,!0),"ExponentialOut pingpong=true, exponent=6",
(new CAAT.Interpolator).createExponentialInOutInterpolator(6,!0),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Interpolator).createBounceInInterpolator(!1),"BounceIn pingpong=false",(new CAAT.Interpolator).createBounceOutInterpolator(!1),"BounceOut pingpong=false",(new CAAT.Interpolator).createBounceInOutInterpolator(!1),"BounceInOut pingpong=false",(new CAAT.Interpolator).createBounceInInterpolator(!0),"BounceIn pingpong=true",(new CAAT.Interpolator).createBounceOutInterpolator(!0),"BounceOut pingpong=true",
(new CAAT.Interpolator).createBounceInOutInterpolator(!0),"BounceInOut pingpong=true",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,!1),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4,!1),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,!1),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,!0),"ElasticIn pingpong=true, amp=1.1, d=.4",
(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4,!0),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,!0),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1,0.2,!1),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,!1),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,!1),"ElasticInOut pingpong=false, amp=1.0, d=.2",
(new CAAT.Interpolator).createElasticInInterpolator(1,0.2,!0),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,!0),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,!0),"ElasticInOut pingpong=true, amp=1.0, d=.2"]}}})();(function(){CAAT.Behavior=function(){this.lifecycleListenerList=[];this.setDefaultInterpolator();return this};CAAT.Behavior.Status={NOT_STARTED:0,STARTED:1,EXPIRED:2};var a=(new CAAT.Interpolator).createLinearInterpolator(!1),c=(new CAAT.Interpolator).createLinearInterpolator(!0);CAAT.Behavior.prototype={lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:!1,status:CAAT.Behavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:!0,solved:!0,
discardable:!1,setValueApplication:function(a){this.doValueApplication=a;return this},setTimeOffset:function(a){this.timeOffset=a;return this},setDiscardable:function(a){this.discardable=a;return this},setId:function(a){this.id=a;return this},setDefaultInterpolator:function(){this.interpolator=a;return this},setPingPong:function(){this.interpolator=c;return this},setStatus:function(a){this.status=a},setFrameTime:function(a,c){this.behaviorStartTime=a;this.behaviorDuration=c;this.setStatus(CAAT.Behavior.Status.NOT_STARTED);
return this},setDelayTime:function(a,c){this.behaviorStartTime=a;this.behaviorDuration=c;this.setStatus(CAAT.Behavior.Status.NOT_STARTED);this.solved=!1;return this},setOutOfFrameTime:function(){this.setStatus(CAAT.Behavior.Status.EXPIRED);this.behaviorStartTime=Number.MAX_VALUE;this.behaviorDuration=0;return this},setOutOfFrameOnCycleEndTime:function(a){if(!this.cycleBehavior)return this.setOutOfFrameTime();this.setCycle(!1);if(this.status!==CAAT.Behavior.Status.STARTED)return this;this.solved&&
a>this.behaviorStartTime&&(this.behaviorStartTime=a-(a-this.behaviorStartTime)%this.behaviorDuration);return this},setInterpolator:function(a){this.interpolator=a;return this},apply:function(a,c){this.solved||(this.behaviorStartTime+=a,this.solved=!0);var e=a+=this.timeOffset*this.behaviorDuration;this.isBehaviorInTime(a,c)&&(a=this.normalizeTime(a),this.fireBehaviorAppliedEvent(c,e,a,this.setForTime(a,c)))},setCycle:function(a){this.cycleBehavior=a;return this},addListener:function(a){this.lifecycleListenerList.push(a);
return this},emptyListenerList:function(){this.lifecycleListenerList=[];return this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},getEstimateEndTimeMs:function(a){return this.status==CAAT.Behavior.Status.EXPIRED?a:this.cycleBehavior?Number.POSITIVE_INFINITY:this.behaviorStartTime+(this.solved?0:a)+Math.max(0,this.behaviorDuration*(1-this.timeOffset))},getEstimateElapsedTimeMs:function(a){if(this.status==CAAT.Behavior.Status.EXPIRED)return this.behaviorDuration;
if(!this.solved)return 0;a=a+this.timeOffset*this.behaviorDuration-this.behaviorStartTime;return 0>=a?0:this.cycleBehavior?a%this.behaviorDuration:Math.min(this.behaviorDuration,a)},isBehaviorInTime:function(a,c){var e=CAAT.Behavior.Status;if(this.status===e.EXPIRED||0>this.behaviorStartTime)return!1;this.cycleBehavior&&a>=this.behaviorStartTime&&(a=(a-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime);if(a>this.behaviorStartTime+this.behaviorDuration)return this.status!==e.EXPIRED&&
this.setExpired(c,a),!1;this.status===e.NOT_STARTED&&(this.status=e.STARTED,this.fireBehaviorStartedEvent(c,a));return this.behaviorStartTime<=a},fireBehaviorStartedEvent:function(a,c){for(var e=0,f=this.lifecycleListenerList.length;e<f;e++){var g=this.lifecycleListenerList[e];g.behaviorStarted&&g.behaviorStarted(this,c,a)}},fireBehaviorExpiredEvent:function(a,c){for(var e=0,f=this.lifecycleListenerList.length;e<f;e++){var g=this.lifecycleListenerList[e];g.behaviorExpired&&g.behaviorExpired(this,
c,a)}},fireBehaviorAppliedEvent:function(a,c,e,f){for(var g=0,h=this.lifecycleListenerList.length;g<h;g++){var i=this.lifecycleListenerList[g];i.behaviorApplied&&i.behaviorApplied(this,c,e,a,f)}},normalizeTime:function(a){a-=this.behaviorStartTime;this.cycleBehavior&&(a%=this.behaviorDuration);return this.interpolator.getPosition(a/this.behaviorDuration).y},setExpired:function(a,c){this.status=CAAT.Behavior.Status.EXPIRED;this.setForTime(this.interpolator.getPosition(1).y,a);this.fireBehaviorExpiredEvent(a,
c);this.discardable&&a.removeBehavior(this)},setForTime:function(){},initialize:function(a){if(a)for(var c in a)this[c]=a[c];return this},getPropertyName:function(){return""}}})();
(function(){CAAT.ContainerBehavior=function(){CAAT.ContainerBehavior.superclass.constructor.call(this);this.behaviors=[];return this};CAAT.ContainerBehavior.prototype={behaviors:null,conformToDuration:function(a){this.duration=a;for(var a=a/this.duration,c,b=0;b<this.behavior.length;b++)c=this.behavior[b],c.setFrameTime(c.getStartTime()*a,c.getDuration()*a);return this},addBehavior:function(a){this.behaviors.push(a);a.addListener(this);return this},apply:function(a,c){this.solved||(this.behaviorStartTime+=
a,this.solved=!0);a+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(a,c)){a-=this.getStartTime();this.cycleBehavior&&(a%=this.getDuration());for(var b=this.behaviors,d=b.length-1;0<=d;d--)b[d].apply(a,c)}},behaviorExpired:function(a){this.cycleBehavior&&a.setStatus(CAAT.Behavior.Status.STARTED)},setForTime:function(a,c){for(var b=this.behaviors,d=0;d<b.length;d++)b[d].setForTime(a,c);return null},setExpired:function(a,c){CAAT.ContainerBehavior.superclass.setExpired.call(this,a,c);
for(var b=this.behaviors,d=0;d<b.length;d++){var e=b[d];e.status!==CAAT.Behavior.Status.EXPIRED&&e.setExpired(a,c-this.behaviorStartTime)}return this},setFrameTime:function(a,c){CAAT.ContainerBehavior.superclass.setFrameTime.call(this,a,c);for(var b=this.behaviors,d=0;d<b.length;d++)b[d].setStatus(CAAT.Behavior.Status.NOT_STARTED);return this},calculateKeyFrameData:function(a,c,b){function d(a){if(g[a])i+=g[a];else if(b&&(j=b[a]))i+=j,g[a]=j}var e,f,g={},h;for(e=0;e<this.behaviors.length;e++)f=this.behaviors[e],
f.status!==CAAT.Behavior.Status.EXPIRED&&!(f instanceof CAAT.GenericBehavior)&&(h=a*this.behaviorDuration,f.behaviorStartTime<=h&&f.behaviorStartTime+f.behaviorDuration>=h&&(h=(h-f.behaviorStartTime)/f.behaviorDuration,h=f.calculateKeyFrameData(h),f=f.getPropertyName(c),"undefined"===typeof g[f]&&(g[f]=""),g[f]+=h+" "));var i="",j;d("translate");d("rotate");d("scale");a="";i&&(a="-"+c+"-transform: "+i+";");i="";d("opacity");i&&(a+=" opacity: "+i+";");return{rules:a,ret:g}},calculateKeyFramesData:function(a,
c,b){if(this.duration===Number.MAX_VALUE)return"";"undefined"===typeof b&&(b=100);for(var d=null,e="@-"+a+"-keyframes "+c+" {",f,c=0;c<=b;c++)f=this.interpolator.getPosition(c/b).y,d=this.calculateKeyFrameData(f,a,d),f=""+100*(c/b)+"%{"+d.rules+"}\n",d=d.ret,e+=f;return e+"}"}};extend(CAAT.ContainerBehavior,CAAT.Behavior,null)})();
(function(){CAAT.RotateBehavior=function(){CAAT.RotateBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.RotateBehavior.prototype={startAngle:0,endAngle:0,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"rotate"},setForTime:function(a,c){var b=this.startAngle+a*(this.endAngle-this.startAngle);this.doValueApplication&&c.setRotationAnchored(b,this.anchorX,this.anchorY);return b},setValues:function(a,c,b,d){this.startAngle=a;this.endAngle=
c;"undefined"!==typeof b&&"undefined"!==typeof d&&(this.anchorX=b,this.anchorY=d);return this},setAngles:function(a,c){return this.setValues(a,c)},setAnchor:function(a,c,b){this.anchorX=c/a.width;this.anchorY=b/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return"rotate("+(this.startAngle+a*(this.endAngle-this.startAngle))+"rad)"},calculateKeyFramesData:function(a,c,b){"undefined"===typeof b&&(b=100);for(var b=b>>0,d,e="@-"+a+"-keyframes "+c+" {",c=0;c<=
b;c++)d=""+100*(c/b)+"%{-"+a+"-transform:"+this.calculateKeyFrameData(c/b)+"}\n",e+=d;return e+"}"}};extend(CAAT.RotateBehavior,CAAT.Behavior,null)})();
(function(){CAAT.GenericBehavior=function(){CAAT.GenericBehavior.superclass.constructor.call(this);return this};CAAT.GenericBehavior.prototype={start:0,end:0,target:null,property:null,callback:null,setForTime:function(a,c){var b=this.start+a*(this.end-this.start);this.callback&&this.callback(b,this.target,c);this.property&&(this.target[this.property]=b)},setValues:function(a,c,b,d,e){this.start=a;this.end=c;this.target=b;this.property=d;this.callback=e;return this}};extend(CAAT.GenericBehavior,CAAT.Behavior,
null)})();
(function(){CAAT.ScaleBehavior=function(){CAAT.ScaleBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.ScaleBehavior.prototype={startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"scale"},setForTime:function(a,c){var b=this.startScaleX+a*(this.endScaleX-this.startScaleX),d=this.startScaleY+a*(this.endScaleY-this.startScaleY);0===b&&(b=0.01);0===d&&(d=0.01);this.doValueApplication&&c.setScaleAnchored(b,
d,this.anchorX,this.anchorY);return{scaleX:b,scaleY:d}},setValues:function(a,c,b,d,e,f){this.startScaleX=a;this.endScaleX=c;this.startScaleY=b;this.endScaleY=d;"undefined"!==typeof e&&"undefined"!==typeof f&&(this.anchorX=e,this.anchorY=f);return this},setAnchor:function(a,c,b){this.anchorX=c/a.width;this.anchorY=b/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return"scaleX("+(this.startScaleX+a*(this.endScaleX-this.startScaleX))+") scaleY("+(this.startScaleY+
a*(this.endScaleY-this.startScaleY))+")"},calculateKeyFramesData:function(a,c,b){"undefined"===typeof b&&(b=100);for(var b=b>>0,d,e="@-"+a+"-keyframes "+c+" {",c=0;c<=b;c++)d=""+100*(c/b)+"%{-"+a+"-transform:"+this.calculateKeyFrameData(c/b)+"}",e+=d;return e+"}"}};extend(CAAT.ScaleBehavior,CAAT.Behavior,null)})();
(function(){CAAT.AlphaBehavior=function(){CAAT.AlphaBehavior.superclass.constructor.call(this);return this};CAAT.AlphaBehavior.prototype={startAlpha:0,endAlpha:0,getPropertyName:function(){return"opacity"},setForTime:function(a,c){var b=this.startAlpha+a*(this.endAlpha-this.startAlpha);this.doValueApplication&&c.setAlpha(b);return b},setValues:function(a,c){this.startAlpha=a;this.endAlpha=c;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return this.startAlpha+
a*(this.endAlpha-this.startAlpha)},calculateKeyFramesData:function(a,c,b){"undefined"===typeof b&&(b=100);for(var b=b>>0,d="@-"+a+"-keyframes "+c+" {",a=0;a<=b;a++)c=""+100*(a/b)+"%{opacity: "+this.calculateKeyFrameData(a/b)+"}",d+=c;return d+"}"}};extend(CAAT.AlphaBehavior,CAAT.Behavior,null)})();
(function(){CAAT.PathBehavior=function(){CAAT.PathBehavior.superclass.constructor.call(this);return this};CAAT.PathBehavior.autorotate={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2};CAAT.PathBehavior.prototype={path:null,autoRotate:!1,prevX:-1,prevY:-1,autoRotateOp:CAAT.PathBehavior.autorotate.FREE,getPropertyName:function(){return"translate"},setAutoRotate:function(a,c){this.autoRotate=a;void 0!==c&&(this.autoRotateOp=c);return this},setPath:function(a){this.path=a;return this},setValues:function(a){return this.setPath(a)},
setTranslation:function(){return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;a=this.path.getPosition(a);return"translateX("+a.x+"px) translateY("+a.y+"px)"},calculateKeyFramesData:function(a,c,b){"undefined"===typeof b&&(b=100);for(var b=b>>0,d,e="@-"+a+"-keyframes "+c+" {",c=0;c<=b;c++)d=""+100*(c/b)+"%{-"+a+"-transform:"+this.calculateKeyFrameData(c/b)+"}",e+=d;return e+"}"},setForTime:function(a,c){if(!this.path)return{x:c.x,y:c.y};var b=this.path.getPosition(a);
if(this.autoRotate){-1===this.prevX&&-1===this.prevY&&(this.prevX=b.x,this.prevY=b.y);var d=b.x-this.prevX,e=b.y-this.prevY;if(0===d&&0===e)return c.setPosition(b.x,b.y),{x:c.x,y:c.y};var f=Math.atan2(e,d),g=CAAT.SpriteImage.prototype,h=CAAT.PathBehavior.autorotate;this.autoRotateOp===h.LEFT_TO_RIGHT?this.prevX<=b.x?c.setImageTransformation(g.TR_NONE):(c.setImageTransformation(g.TR_FLIP_HORIZONTAL),f+=Math.PI):this.autoRotateOp===h.RIGHT_TO_LEFT&&(this.prevX<=b.x?c.setImageTransformation(g.TR_FLIP_HORIZONTAL):
(c.setImageTransformation(g.TR_NONE),f-=Math.PI));c.setRotation(f);this.prevX=b.x;this.prevY=b.y;Math.sqrt(d*d+e*e)}return this.doValueApplication?(c.setPosition(b.x,b.y),{x:c.x,y:c.y}):{x:b.x,y:b.y}},positionOnTime:function(a){return this.isBehaviorInTime(a,null)?(a=this.normalizeTime(a),this.path.getPosition(a)):{x:-1,y:-1}}};extend(CAAT.PathBehavior,CAAT.Behavior)})();
(function(){CAAT.ColorBehavior=function(){CAAT.ColorBehavior.superclass.constructor.call(this);return this};CAAT.ColorBehavior.prototype={colorStart:null,colorEnd:null,setValues:function(a,c){"string"===typeof a&&(a=CAAT.Color.RGB.fromHex(a));"string"===typeof c&&(c=CAAT.Color.RGB.fromHex(c));this.colorStart=a;this.colorEnd=c;return this},setForTime:function(a,c){var b=this.colorStart,d=this.colorEnd,b=CAAT.Color.interpolate(b.r,b.g,b.b,d.r,d.g,d.b,a),b="#"+CAAT.Color.RGB.prototype.toHex.apply(b);
c.setFillStyle(b)}};extend(CAAT.ColorBehavior,CAAT.Behavior)})();
(function(){CAAT.Scale1Behavior=function(){CAAT.Scale1Behavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.Scale1Behavior.AXIS_X=0;CAAT.Scale1Behavior.AXIS_Y=1;CAAT.Scale1Behavior.prototype={startScale:1,endScale:1,anchorX:0.5,anchorY:0.5,sx:1,sy:1,applyOnX:!0,applyOnAxis:function(a){this.applyOnX=1===a?!1:!0},getPropertyName:function(){return"scale"},setForTime:function(a,c){var b=this.startScale+a*(this.endScale-this.startScale);0===b&&(b=0.01);
this.doValueApplication&&(this.applyOnX?c.setScaleAnchored(b,c.scaleY,this.anchorX,this.anchorY):c.setScaleAnchored(c.scaleX,b,this.anchorX,this.anchorY));return b},setValues:function(a,c,b,d,e){this.startScale=a;this.endScale=c;this.applyOnX=!!b;"undefined"!==typeof d&&"undefined"!==typeof e&&(this.anchorX=d,this.anchorY=e);return this},setAnchor:function(a,c,b){this.anchorX=c/a.width;this.anchorY=b/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;a=this.startScale+
a*(this.endScale-this.startScale);return this.applyOnX?"scaleX("+a+")":"scaleY("+a+")"},calculateKeyFramesData:function(a,c,b){"undefined"===typeof b&&(b=100);for(var b=b>>0,d,e="@-"+a+"-keyframes "+c+" {",c=0;c<=b;c++)d=""+100*(c/b)+"%{-"+a+"-transform:"+this.calculateKeyFrameData(c/b)+"}",e+=d;return e+"}"}};extend(CAAT.Scale1Behavior,CAAT.Behavior)})();(function(){CAAT.Debug=function(){return this};CAAT.Debug.prototype={width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:!1,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',
setScale:function(a){this.scale=a;return this},initialize:function(a,c){this.width=a=window.innerWidth;this.height=c;this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1E3,fpsMax:0};if(!document.getElementById("caat-debug")){var b=document.createElement("div");b.innerHTML=this.debugTpl;document.body.appendChild(b);eval('        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", CAAT.director[0].isSoundEffectsEnabled(), function(e, bool) {            CAAT.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", CAAT.director[0].isMusicEnabled(), function(e, bool) {            CAAT.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            CAAT.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            CAAT.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}this.canvas=
document.getElementById("caat-debug-canvas");if(null===this.canvas)this.canDebug=!1;else return this.canvas.width=a,this.canvas.height=c,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=
document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.canDebug=!0,this},debugInfo:function(a){this.statistics=a;this.frameTimeAcc+=CAAT.FRAME_TIME;this.frameRAFAcc+=CAAT.REQUEST_ANIMATION_FRAME_TIME;this.framerate.frames++;CAAT.RAF>this.framerate.timeLastRefresh+this.framerate.refreshInterval&&(this.framerate.fps=1E3*this.framerate.frames/(CAAT.RAF-this.framerate.timeLastRefresh)|0,this.framerate.fpsMin=
0<this.framerate.frames?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin,this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps),this.textFPS.innerHTML=this.framerate.fps,a=(100*this.frameTimeAcc/this.framerate.frames|0)/100,this.frameTimeAcc=0,this.textDrawTime.innerHTML=a,a=(100*this.frameRAFAcc/this.framerate.frames|0)/100,this.frameRAFAcc=0,this.textRAFTime.innerHTML=a,this.framerate.timeLastRefresh=CAAT.RAF,this.framerate.frames=0,this.paint(a));this.textEntitiesTotal.innerHTML=
this.statistics.size_total;this.textEntitiesActive.innerHTML=this.statistics.size_active;this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects;this.textDraws.innerHTML=this.statistics.draws},paint:function(a){var c=this.ctx,b=0;c.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height);c.strokeStyle="black";c.beginPath();c.moveTo(this.width-0.5,0);c.lineTo(this.width-0.5,this.height);c.stroke();c.strokeStyle="#a22";c.beginPath();b=this.height-(20/this.SCALE*this.height>>
0)-0.5;c.moveTo(0.5,b);c.lineTo(this.width+0.5,b);c.stroke();c.strokeStyle="#aa2";c.beginPath();b=this.height-(30/this.SCALE*this.height>>0)-0.5;c.moveTo(0.5,b);c.lineTo(this.width+0.5,b);c.stroke();b=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);-1===this.framerate.prevFps&&(this.framerate.prevFps=b|0);c.strokeStyle="#0ff";c.beginPath();c.moveTo(this.width,(b|0)-0.5);c.lineTo(this.width,this.framerate.prevFps-0.5);c.stroke();this.framerate.prevFps=b;a=(this.height-a/this.SCALE*
this.height>>0)-0.5;c.strokeStyle="#ff0";c.beginPath();c.moveTo(this.width,a);c.lineTo(this.width,a);c.stroke()}}})();(function(){var a=0;CAAT.Actor=function(){this.behaviorList=[];this.lifecycleListenerList=[];this.AABB=new CAAT.Rectangle;this.viewVertices=[new CAAT.Point(0,0,0),new CAAT.Point(0,0,0),new CAAT.Point(0,0,0),new CAAT.Point(0,0,0)];this.scaleAnchor=this.ANCHOR_CENTER;this.modelViewMatrix=new CAAT.Matrix;this.worldModelViewMatrix=new CAAT.Matrix;this.resetTransform();this.setScale(1,1);this.setRotation(0);this.id=a++;return this};CAAT.Actor.__reflectionInfo={x:"property:x, type:number",y:"property:y, type:number",
scaleX:"property:scaleX, type:number",scaleY:"property:scaleY, type:number",cached:"get:isCached(), type:boolean"};CAAT.Actor.ANCHOR_CENTER=0;CAAT.Actor.ANCHOR_TOP=1;CAAT.Actor.ANCHOR_BOTTOM=2;CAAT.Actor.ANCHOR_LEFT=3;CAAT.Actor.ANCHOR_RIGHT=4;CAAT.Actor.ANCHOR_TOP_LEFT=5;CAAT.Actor.ANCHOR_TOP_RIGHT=6;CAAT.Actor.ANCHOR_BOTTOM_LEFT=7;CAAT.Actor.ANCHOR_BOTTOM_RIGHT=8;CAAT.Actor.ANCHOR_CUSTOM=9;CAAT.Actor.CACHE_SIMPLE=1;CAAT.Actor.CACHE_DEEP=2;CAAT.Actor.prototype={lifecycleListenerList:null,behaviorList:null,
parent:null,x:0,y:0,width:0,height:0,start_time:0,duration:Number.MAX_VALUE,clip:!1,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:0,scaleY:0,scaleTX:0.5,scaleTY:0.5,scaleAnchor:0,rotationAngle:0,rotationY:0.5,rotationX:0.5,alpha:1,inheritAlpha:!0,frameAlpha:1,expired:!1,discardable:!1,alwaysPaint:!1,fastAABB:!1,pointed:!1,mouseEnabled:!0,visible:!0,ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,
ANCHOR_CUSTOM:9,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:!1,dirty:!0,wdirty:!0,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:!1,backgroundImage:null,id:null,size_active:1,size_total:1,__scene:void 0,__next:null,__d_ax:-1,__d_ay:-1,gestureEnabled:!1,invalid:!0,cached:0,collides:!1,collidesAsRect:!0,isAA:!0,create:function(){return this},moveTo:function(a,b,d,e,f){var g=this.getBehavior("__moveTo");
g||(g=(new CAAT.PathBehavior).setId("__moveTo").setValues(new CAAT.LinearPath),this.addBehavior(g));g.path.setInitialPosition(this.x,this.y).setFinalPosition(a,b);g.setDelayTime(e?e:0,d);f&&g.setInterpolator(f);return this},rotateTo:function(a,b,d,e,f,g){var h=this.getBehavior("__rotateTo");h||(h=(new CAAT.RotateBehavior).setId("__rotateTo").setValues(0,0,0.5,0.5),this.addBehavior(h));h.setValues(this.rotationAngle,a,e,f).setDelayTime(d?d:0,b);g&&h.setInterpolator(g);return this},scaleTo:function(a,
b,d,e,f,g,h){var i=this.getBehavior("__scaleTo");i||(i=(new CAAT.ScaleBehavior).setId("__scaleTo").setValues(1,1,1,1,0.5,0.5),this.addBehavior(i));i.setValues(this.scaleX,this.scaleY,a,b,f,g).setDelayTime(e?e:0,d);h&&i.setInterpolator(h);return this},scaleXTo:function(a,b,d,e,f,g){return this.__scale1To(CAAT.Scale1Behavior.AXIS_X,a,b,d,e,f,g)},scaleYTo:function(a,b,d,e,f,g){return this.__scale1To(CAAT.Scale1Behavior.AXIS_Y,a,b,d,e,f,g)},__scale1To:function(a,b,d,e,f,g,h){var i=this.getBehavior("__scaleXTo");
i||(i=(new CAAT.Scale1Behavior).setId("__scaleXTo").setValues(1,1,a===CAAT.Scale1Behavior.AXIS_X,0.5,0.5),this.addBehavior(i));i.setValues(a?this.scaleX:this.scaleY,b,f,g).setDelayTime(e?e:0,d);h&&i.setInterpolator(h);return this},touchStart:function(){},touchMove:function(){},touchEnd:function(){},gestureStart:function(){},gestureChange:function(a,b,d){this.gestureEnabled&&(this.setRotation(a),this.setScale(b,d));return this},gestureEnd:function(){},isVisible:function(){return this.isVisible},setupCollission:function(a,
b){this.collides=a;this.collidesAsRect=!b},invalidate:function(){this.invalid=!0},setGestureEnabled:function(a){this.gestureEnabled=!!a;return this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(a){this.id=a;return this},setParent:function(a){this.parent=a;this.__scene=void 0;this.dirty=!0;return this},setBackgroundImage:function(a,b){if(a){a instanceof CAAT.SpriteImage||(a=(new CAAT.SpriteImage).initialize(a,1,1));a.setOwner(this);this.backgroundImage=
a;if("undefined"===typeof b||b)this.width=a.getWidth(),this.height=a.getHeight();this.glEnabled=!0}else this.backgroundImage=null;return this},setSpriteIndex:function(a){this.backgroundImage&&(this.backgroundImage.setSpriteIndex(a),this.invalidate());return this},setBackgroundImageOffset:function(a,b){this.backgroundImage&&this.backgroundImage.setOffset(a,b);return this},setAnimationImageIndex:function(a,b){this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.backgroundImage.setAnimationImageIndex(a,
b));return this},resetAnimationTime:function(){this.backgroundImage&&this.backgroundImage.resetAnimationTime();return this},setChangeFPS:function(a){this.backgroundImage&&this.backgroundImage.setChangeFPS(a);return this},setImageTransformation:function(a){this.backgroundImage&&this.backgroundImage.setSpriteTransformation(a);return this},centerOn:function(a,b){this.setPosition(a-this.width/2,b-this.height/2);return this},centerAt:function(a,b){return this.centerOn(a,b)},getScene:function(){if(void 0===
this.__scene){var a=this.parent;this.__scene=a instanceof CAAT.Scene?a:null==a?null:a.getScene()}return this.__scene},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(a){this.visible=a;return this},setOutOfFrameTime:function(){return this.expired?this:this.setFrameTime(-1,0)},addListener:function(a){this.lifecycleListenerList.push(a);return this},removeListener:function(a){for(var b=this.lifecycleListenerList.length;b--;)if(this.lifecycleListenerList[b]===
a){this.lifecycleListenerList.splice(b,1);break}},setInheritAlpha:function(a){this.inheritAlpha=a;return this},fireEvent:function(a,b){for(var d=0;d<this.lifecycleListenerList.length;d++)this.lifecycleListenerList[d].actorLifeCycleEvent(this,a,b)},setExpired:function(a){this.expired=!0;this.fireEvent("expired",a);return this},enableEvents:function(a){this.mouseEnabled=a;return this},emptyBehaviorList:function(){this.behaviorList=[];return this},setFillStyle:function(a){this.fillStyle=a;return this},
setStrokeStyle:function(a){this.strokeStyle=a;return this},setPaint:function(a){return this.setFillStyle(a)},setAlpha:function(a){this.alpha=a;this.invalidate();return this},resetTransform:function(){this.rotationAngle=0;this.rotationY=this.rotationX=0.5;this.scaleY=this.scaleX=1;this.scaleTY=this.scaleTX=0.5;this.scaleAnchor=0;this.oldY=this.oldX=-1;this.dirty=!0;return this},setFrameTime:function(a,b){this.start_time=a;this.duration=b;this.expired=!1;this.dirty=!0;return this},paint:function(a,
b){if(this.backgroundImage)this.backgroundImage.paint(a,b,0,0);else if(this.fillStyle){var d=a.crc;d.fillStyle=this.fillStyle;d.fillRect(0,0,this.width,this.height)}},setScale:function(a,b){this.scaleX=a;this.scaleY=b;this.dirty=!0;return this},getAnchorPercent:function(a){var b=[0.5,0.5,0.5,0,0.5,1,0,0.5,1,0.5,0,0,1,0,0,1,1,1];return{x:b[2*a],y:b[2*a+1]}},getAnchor:function(a){var b=0,d=0;switch(a){case this.ANCHOR_CENTER:d=b=0.5;break;case this.ANCHOR_TOP:b=0.5;d=0;break;case this.ANCHOR_BOTTOM:b=
0.5;d=1;break;case this.ANCHOR_LEFT:b=0;d=0.5;break;case this.ANCHOR_RIGHT:b=1;d=0.5;break;case this.ANCHOR_TOP_RIGHT:b=1;d=0;break;case this.ANCHOR_BOTTOM_LEFT:b=0;d=1;break;case this.ANCHOR_BOTTOM_RIGHT:d=b=1;break;case this.ANCHOR_TOP_LEFT:d=b=0}return{x:b,y:d}},setGlobalAnchor:function(a,b){this.scaleTX=this.rotationX=this.tAnchorX=a;this.scaleTY=this.rotationY=this.tAnchorY=b;this.dirty=!0;return this},setScaleAnchor:function(a,b){this.scaleTX=a;this.scaleTY=b;this.dirty=!0;return this},setScaleAnchored:function(a,
b,d,e){this.scaleTX=d;this.scaleTY=e;this.scaleX=a;this.scaleY=b;this.dirty=!0;return this},setRotationAnchor:function(a,b){this.rotationX=a;this.rotationY=b;this.dirty=!0;return this},setRotation:function(a){this.rotationAngle=a;this.dirty=!0;return this},setRotationAnchored:function(a,b,d){this.rotationAngle=a;this.rotationX=b;this.rotationY=d;this.dirty=!0;return this},setSize:function(a,b){this.width=a|0;this.height=b|0;this.dirty=!0;return this},setBounds:function(a,b,d,e){this.x=a;this.y=b;
this.width=d;this.height=e;this.dirty=!0;return this},setLocation:function(a,b){return this.setPosition(a,b)},setPosition:function(a,b){this.x=a;this.y=b;this.oldX=a;this.oldY=b;this.dirty=!0;return this},setPositionAnchor:function(a,b){this.tAnchorX=a;this.tAnchorY=b;this.dirty=!0;return this},setPositionAnchored:function(a,b,d,e){this.setPosition(a,b);this.tAnchorX=d;this.tAnchorY=e;return this},isInAnimationFrame:function(a){return this.expired?!1:this.duration===Number.MAX_VALUE?this.start_time<=
a:a>=this.start_time+this.duration?(this.expired||this.setExpired(a),!1):this.start_time<=a&&a<this.start_time+this.duration},contains:function(a,b){return 0<=a&&0<=b&&a<this.width&&b<this.height},addBehavior:function(a){this.behaviorList.push(a);return this},removeBehavior:function(a){for(var b=this.behaviorList,d=b.length-1;0<=d;){if(b[d]===a){b.splice(d,1);break}d--}return this},removeBehaviorById:function(a){for(var b=this.behaviorList,d=0;d<b.length;d++)b[d].id===a&&b.splice(d,1);return this},
getBehavior:function(a){for(var b=this.behaviorList,d=0;d<b.length;d++){var e=b[d];if(e.id===a)return e}return null},setDiscardable:function(a){this.discardable=a;return this},destroy:function(a){this.parent&&this.parent.removeChild(this);this.expired||this.setExpired(a||this.time);this.fireEvent("destroyed",a)},modelToView:function(a){var b,d,e,f;this.dirty&&this.setModelViewMatrix();f=this.worldModelViewMatrix.matrix;if(a instanceof Array)for(var g=0;g<a.length;g++)e=a[g],b=e.x,d=e.y,e.x=b*f[0]+
d*f[1]+f[2],e.y=b*f[3]+d*f[4]+f[5];else b=a.x,d=a.y,a.x=b*f[0]+d*f[1]+f[2],a.y=b*f[3]+d*f[4]+f[5];return a},modelToViewVect:function(a){var b,d,e,f;this.dirty&&this.setModelViewMatrix();f=this.worldModelViewMatrix.matrix;if(a instanceof Array)for(var g=0;g<a.length;g++)e=a[g],b=e.x,d=e.y,e.x=b*f[0]+d*f[1],e.y=b*f[3]+d*f[4];else b=a.x,d=a.y,a.x=b*f[0]+d*f[1],a.y=b*f[3]+d*f[4];return a},modelToModel:function(a,b){if(b==this)return a;this.dirty&&this.setModelViewMatrix();return b.viewToModel(this.modelToView(a))},
viewToModel:function(a){this.dirty&&this.setModelViewMatrix();this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse();this.worldModelViewMatrixI.transformCoord(a);return a},viewToModelVect:function(a){this.dirty&&this.setModelViewMatrix();this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse();this.worldModelViewMatrixI.transformVect(a);return a},findActorAtPosition:function(a){if(!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time))return null;this.modelViewMatrixI=
this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(a);return this.contains(a.x,a.y)?this:null},enableDrag:function(){this.ay=this.ax=0;this.asy=this.asx=1;this.screeny=this.screenx=this.ara=0;this.mouseEnter=function(){this.__d_ay=this.__d_ax=-1;this.pointed=!0;CAAT.setCursor("move")};this.mouseExit=function(){this.__d_ay=this.__d_ax=-1;this.pointed=!1;CAAT.setCursor("default")};this.mouseMove=function(){};this.mouseUp=function(){this.__d_ay=this.__d_ax=-1};this.mouseDrag=function(a){var b;
b=this.modelToView(new CAAT.Point(a.x,a.y));this.parent.viewToModel(b);if(-1===this.__d_ax||-1===this.__d_ay)this.__d_ax=b.x,this.__d_ay=b.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=a.screenPoint.x,this.__d_screeny=a.screenPoint.y;if(a.isShiftDown()){var d=(a.screenPoint.x-this.__d_screenx)/100,e=(a.screenPoint.y-this.__d_screeny)/100;a.isAltDown()||(e=d=a=Math.max(d,e));this.setScale(d+this.__d_asx,e+this.__d_asy)}else a.isControlDown()?this.setRotation(-Math.atan2(a.screenPoint.x-
this.__d_screenx,a.screenPoint.y-this.__d_screeny)+this.__d_ara):(this.x+=b.x-this.__d_ax,this.y+=b.y-this.__d_ay);this.__d_ax=b.x;this.__d_ay=b.y};return this},disableDrag:function(){this.mouseEnter=function(){};this.mouseExit=function(){};this.mouseMove=function(){};this.mouseUp=function(){};this.mouseDrag=function(){};return this},mouseClick:function(){},mouseDblClick:function(){},mouseEnter:function(){this.pointed=!0},mouseExit:function(){this.pointed=!1},mouseMove:function(){},mouseDown:function(){},
mouseUp:function(){},mouseOut:function(){},mouseOver:function(){},mouseDrag:function(){},drawScreenBoundingBox:function(a){if(null!==this.AABB&&this.inFrame){var b=this.AABB,a=a.ctx;a.strokeStyle=CAAT.DEBUGAABBCOLOR;a.strokeRect(0.5+(b.x|0),0.5+(b.y|0),b.width|0,b.height|0);CAAT.DEBUGBB&&(b=this.viewVertices,a.beginPath(),a.lineTo(b[0].x,b[0].y),a.lineTo(b[1].x,b[1].y),a.lineTo(b[2].x,b[2].y),a.lineTo(b[3].x,b[3].y),a.closePath(),a.strokeStyle=CAAT.DEBUGBBCOLOR,a.stroke())}},animate:function(a,b){var d;
if(!this.isInAnimationFrame(b))return this.inFrame=!1,this.dirty=!0,!1;if(this.x!==this.oldX||this.y!==this.oldY)this.dirty=!0,this.oldX=this.x,this.oldY=this.y;for(d=this.behaviorList.length-1;0<=d;d--)this.behaviorList[d].apply(b,this);this.clipPath&&this.clipPath.applyBehaviors(b);this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid)a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB),this.setScreenBounds(),a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB);this.invalid=this.dirty=!1;this.inFrame=
!0;return this.alwaysPaint||this.AABB.intersects(a.AABB)},setModelViewMatrix:function(){var a,b,d,e,f,g,h,i,j,k,l;this.wdirty=!1;l=this.modelViewMatrix.matrix;if(this.dirty){h=1;j=e=0;g=1;i=this.x-this.tAnchorX*this.width;k=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var n=this.rotationX*this.width,m=this.rotationY*this.height;i+=h*n+e*m;k+=j*n+g*m;a=Math.cos(this.rotationAngle);b=Math.sin(this.rotationAngle);d=h;f=j;h=d*a+e*b;e=-d*b+e*a;j=f*a+g*b;g=-f*b+g*a;i+=-h*n-e*m;k+=-j*n-g*m}if(1!=
this.scaleX||1!=this.scaleY)a=this.scaleTX*this.width,b=this.scaleTY*this.height,i+=h*a+e*b,k+=j*a+g*b,h*=this.scaleX,e*=this.scaleY,j*=this.scaleX,g*=this.scaleY,i+=-h*a-e*b,k+=-j*a-g*b;l[0]=h;l[1]=e;l[2]=i;l[3]=j;l[4]=g;l[5]=k}if(this.parent){if(this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY&&this.parent.isAA,this.dirty||this.parent.wdirty)this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix),this.isAA?(h=this.worldModelViewMatrix.matrix,h[2]+=l[2],h[5]+=l[5]):this.worldModelViewMatrix.multiply(this.modelViewMatrix),
this.wdirty=!0}else this.dirty&&(this.wdirty=!0),this.worldModelViewMatrix.identity(),this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY},setScreenBounds:function(){var a=this.AABB,b=this.viewVertices;if(this.isAA){var d=this.worldModelViewMatrix.matrix,e=d[2],d=d[5],f=this.width,g=this.height;a.x=e;a.y=d;a.x1=e+f;a.y1=d+g;a.width=f;a.height=g;if(CAAT.GLRENDER){var h;h=b[0];h.x=e;h.y=d;h=b[1];h.x=e+f;h.y=d;h=b[2];h.x=e+f;h.y=d+g;h=b[3];h.x=e;h.y=d+g}return this}if(!this.fastAABB||
CAAT.GLRENDER||CAAT.DEBUGAABB&&CAAT.DEBUGBB)return h=b[0],h.x=0,h.y=0,h=b[1],h.x=this.width,h.y=0,h=b[2],h.x=this.width,h.y=this.height,h=b[3],h.x=0,h.y=this.height,this.modelToView(this.viewVertices),e=Number.MAX_VALUE,d=-Number.MAX_VALUE,f=Number.MAX_VALUE,g=-Number.MAX_VALUE,h=b[0],h.x<e&&(e=h.x),h.x>d&&(d=h.x),h.y<f&&(f=h.y),h.y>g&&(g=h.y),h=b[1],h.x<e&&(e=h.x),h.x>d&&(d=h.x),h.y<f&&(f=h.y),h.y>g&&(g=h.y),h=b[2],h.x<e&&(e=h.x),h.x>d&&(d=h.x),h.y<f&&(f=h.y),h.y>g&&(g=h.y),h=b[3],h.x<e&&(e=h.x),
h.x>d&&(d=h.x),h.y<f&&(f=h.y),h.y>g&&(g=h.y),a.x=e,a.y=f,a.x1=d,a.y1=g,a.width=d-e,a.height=g-f,this;f=this.width;g=this.height;h=this.modelToView({x:f,y:g});b=f>g?f+0.41414*g:g+0.41414*f;e=0.5*b;d=this.worldModelViewMatrix.matrix;a.x=0.5*(d[2]+h.x)-e;a.y=0.5*(d[5]+h.y)-e;a.x1=a.x+b;a.y1=a.y+b;a.width=b;a.heigt=b;return this},paintActor:function(a,b){if(!this.visible)return!0;var d=a.ctx;this.frameAlpha=this.alpha;this.inheritAlpha&&this.parent&&(this.frameAlpha*=this.parent.frameAlpha);d.globalAlpha=
this.frameAlpha;a.modelViewMatrix.transformRenderingContextSet(d);this.worldModelViewMatrix.transformRenderingContext(d);this.clip&&(d.beginPath(),this.clipPath?this.clipPath.applyAsPath(a):d.rect(0,0,this.width,this.height),d.clip());this.paint(a,b);return!0},paintActorGL:function(a){this.frameAlpha=this.alpha;this.inheritAlpha&&this.parent&&(this.frameAlpha*=this.parent.frameAlpha);if(this.glEnabled&&this.visible)if(this.glNeedsFlush(a))a.glFlush(),this.glSetShader(a),this.__uv||(this.__uv=new Float32Array(8)),
this.__vv||(this.__vv=new Float32Array(12)),this.setGLCoords(this.__vv,0),this.setUV(this.__uv,0),a.glRender(this.__vv,12,this.__uv);else{var b=a.coordsIndex;this.setGLCoords(a.coords,b);a.coordsIndex=b+12;this.setUV(a.uv,a.uvIndex);a.uvIndex+=8}},setGLCoords:function(a,b){var d=this.viewVertices;a[b++]=d[0].x;a[b++]=d[0].y;a[b++]=0;a[b++]=d[1].x;a[b++]=d[1].y;a[b++]=0;a[b++]=d[2].x;a[b++]=d[2].y;a[b++]=0;a[b++]=d[3].x;a[b++]=d[3].y;a[b++]=0},setUV:function(a,b){this.backgroundImage.setUV(a,b)},glNeedsFlush:function(a){return this.getTextureGLPage()!==
a.currentTexturePage||this.frameAlpha!==a.currentOpacity?!0:!1},glSetShader:function(a){var b=this.getTextureGLPage();b!==a.currentTexturePage&&a.setGLTexturePage(b);this.frameAlpha!==a.currentOpacity&&a.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(){return this},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this},setClip:function(a,b){this.clip=a;this.clipPath=b;return this},cacheAsBitmap:function(a,b){var a=a||0,d=document.createElement("canvas");d.width=this.width;
d.height=this.height;var e=d.getContext("2d"),e={ctx:e,crc:e,modelViewMatrix:new CAAT.Matrix};this.cached=!1;var f=this.inheritAlpha,g=this.alpha;this.inheritAlpha=!1;this.alpha=1;this.paintActor(e,a);this.setBackgroundImage(d);this.inheritAlpha=f;this.alpha=g;this.cached=b?b:CAAT.Actor.CACHE_SIMPLE;return this},setAsButton:function(a,b,d,e,f,g){this.setBackgroundImage(a,!0);this.iNormal=b||0;this.iOver=d||this.iNormal;this.iPress=e||this.iNormal;this.iDisabled=f||this.iNormal;this.fnOnClick=g;this.enabled=
!0;this.setSpriteIndex(b);this.setEnabled=function(a){this.enabled=a;this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled);return this};this.actionPerformed=function(){this.enabled&&this.fnOnClick&&this.fnOnClick(this)};this.mouseEnter=function(){this.enabled&&(this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer"))};this.mouseExit=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),CAAT.setCursor("default"))};this.mouseDown=function(){this.enabled&&
this.setSpriteIndex(this.iPress)};this.mouseUp=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),this.dragging=!1)};this.mouseClick=function(){};this.mouseDrag=function(){this.enabled&&(this.dragging=!0)};this.setButtonImageIndex=function(a,c,b,d){this.iNormal=a||0;this.iOver=c||this.iNormal;this.iPress=b||this.iNormal;this.iDisabled=d||this.iNormal;this.setSpriteIndex(this.iNormal);return this};return this}}})();
(function(){CAAT.ActorContainer=function(a){CAAT.ActorContainer.superclass.constructor.call(this);this.childrenList=[];this.pendingChildrenList=[];"undefined"!==typeof a&&(this.addHint=a,this.boundingBox=new CAAT.Rectangle);return this};CAAT.ActorContainer.AddHint={CONFORM:1};CAAT.ActorContainer.EventMode={normal:3,childOnly:1,selfOnly:2};CAAT.ActorContainer.prototype={childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Rectangle,mouseEventMode:CAAT.ActorContainer.EventMode.normal,
setEventMode:function(a){this.mouseEventMode=a;return this},drawScreenBoundingBox:function(a,c){if(this.inFrame){for(var b=this.childrenList,d=0;d<b.length;d++)b[d].drawScreenBoundingBox(a,c);CAAT.ActorContainer.superclass.drawScreenBoundingBox.call(this,a,c)}},emptyChildren:function(){this.childrenList=[];return this},paintActor:function(a,c){if(!this.visible)return!0;var b=a.ctx;b.save();CAAT.ActorContainer.superclass.paintActor.call(this,a,c);b.restore();if(2!==this.cached)return this.paintChildren(a,
c),!0},paintChildren:function(a,c){for(var b=a.ctx,d=this.activeChildren;d;d=d.__next)d.visible&&(b.save(),d.paintActor(a,c),b.restore())},paintActorGL:function(a,c){var b;if(!this.visible)return!0;CAAT.ActorContainer.superclass.paintActorGL.call(this,a,c);for(b=this.activeChildren;b;b=b.__next)b.paintActorGL(a,c)},animate:function(a,c){var b=this.activeChildren=null;if(!1===CAAT.ActorContainer.superclass.animate.call(this,a,c))return!1;if(2===this.cached)return!0;var d,e=this.pendingChildrenList;
for(d=0;d<e.length;d++)this.addChild(e[d]);this.pendingChildrenList=[];var e=[],f=this.childrenList;this.size_total=this.size_active=1;for(d=0;d<f.length;d++){var g=f[d];g.time=c;this.size_total+=g.size_total;g.animate(a,c)?(this.activeChildren?(g.__next=null,b.__next=g):(this.activeChildren=g,g.__next=null),b=g,this.size_active+=g.size_active):g.expired&&g.discardable&&e.push(g)}d=0;for(b=e.length;d<b;d++)f=e[d],f.destroy(c),a.dirtyRectsEnabled&&a.addDirtyRect(f.AABB);return!0},endAnimate:function(){},
addChildImmediately:function(a){return this.addChild(a)},addChild:function(a){if(null!=a.parent)throw"adding to a container an element with parent.";a.setParent(this);this.childrenList.push(a);this.addHint===CAAT.ActorContainer.AddHint.CONFORM&&this.recalcSize();return this},recalcSize:function(){var a=this.boundingBox;a.setEmpty();for(var c=this.childrenList,b,d=0;d<c.length;d++)b=c[d],this.runion.setBounds(0>b.x?0:b.x,0>b.y?0:b.y,b.width,b.height),a.unionRectangle(this.runion);this.setSize(a.x1,
a.y1);return this},addChildDelayed:function(a){this.pendingChildrenList.push(a);return this},addChildAt:function(a,c){if(0>=c)return a.setParent(this),this.childrenList.splice(0,0,a),this;c>=this.childrenList.length&&(c=this.childrenList.length);a.setParent(this);this.childrenList.splice(c,0,a);return this},findActorById:function(a){for(var c=this.childrenList,b=0,d=c.length;b<d;b++)if(c[b].id===a)return c[b];return null},findChild:function(a){for(var c=this.childrenList,b=0,d=c.length,b=0;b<d;b++)if(c[b]===
a)return b;return-1},removeChild:function(a){var a=this.findChild(a),c=this.childrenList;-1!==a&&(c[a].setParent(null),c.splice(a,1));return this},removeFirstChild:function(){var a=this.childrenList.shift();a.setParent(null);return a},findActorAtPosition:function(a){if(null===CAAT.ActorContainer.superclass.findActorAtPosition.call(this,a))return null;if(0!=(this.mouseEventMode&1))for(var c=this.childrenList.length-1;0<=c;c--){var b=this.childrenList[c],d=new CAAT.Point(a.x,a.y,0),b=b.findActorAtPosition(d);
if(null!==b)return b}return 0!=(this.mouseEventMode&2)?this:null},destroy:function(){var a=this.childrenList;this.childrenList=[];for(var c=a.length-1;0<=c;c--)a[c].destroy();CAAT.ActorContainer.superclass.destroy.call(this);return this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(a){return this.childrenList[a]},setZOrder:function(a,c){var b=this.findChild(a);if(-1!==b){var d=this.childrenList,e=
d.length;c!==b&&(d.splice(b,1),c>=e?d.push(a):0>=c?d.unshift(a):(b<c&&c--,d.splice(c,0,a)))}}};extend(CAAT.ActorContainer,CAAT.Actor,null)})();
(function(){CAAT.TextActor=function(){CAAT.TextActor.superclass.constructor.call(this);this.font="10px sans-serif";this.textAlign="left";this.textBaseline="top";this.outlineColor="black";this.clip=!1;return this};CAAT.TextActor.TRAVERSE_PATH_FORWARD=1;CAAT.TextActor.TRAVERSE_PATH_BACKWARD=-1;CAAT.TextActor.calcTextSize=function(a,c,b){if("string"!=typeof a)return{width:0,height:0};if(c instanceof CAAT.SpriteImage)return{width:c.stringWidth(a),height:c.stringHeight()};if(b.glEnabled)return{width:0,
height:0};b=b.ctx;b.save();b.font=c;var a=b.measureText(a).width,d=20;try{var e=c.match(/(\d+)px/),f=parseInt(e[1],10);isFinite(f)&&(d=1.1*f>>0)}catch(g){d=20}b.restore();return{width:a,height:d}};CAAT.TextActor.prototype={font:null,textAlign:null,textBaseline:null,fill:!0,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:!1,outlineColor:null,path:null,pathInterpolator:null,pathDuration:1E4,sign:1,spriteTextAlignOffset:null,setFill:function(a){this.fill=a;return this},setTextFillStyle:function(a){this.textFillStyle=
a;return this},setOutline:function(a){this.outline=a;return this},setPathTraverseDirection:function(a){this.sign=a;return this},setOutlineColor:function(a){this.outlineColor=a;return this},setText:function(a){this.text=a;if(null===this.text||""===this.text)this.width=this.height=0;this.calcTextSize(CAAT.director[0]);return this},setTextAlign:function(a){this.textAlign=a;this.spriteTextAlignOffset=null;return this},setAlign:function(a){return this.setTextAlign(a)},setTextBaseline:function(a){this.textBaseline=
a;return this},setBaseline:function(a){return this.setTextBaseline(a)},setFont:function(a){a||(a="10px sans-serif");this.font=a;this.calcTextSize(CAAT.director[0]);return this},calcTextSize:function(a){a=CAAT.TextActor.calcTextSize(this.text,this.font,a);this.textWidth=a.width;this.textHeight=a.height;this.spriteTextAlignOffset=null;this.width=this.width||this.textWidth;this.height=this.height||this.textHeight;this.dirty=!0;return this},paint:function(a,c){CAAT.TextActor.superclass.paint.call(this,
a,c);if(!this.cached&&null!==this.text){(0===this.textWidth||0===this.textHeight)&&this.calcTextSize(a);var b=a.ctx;if(this.font instanceof CAAT.SpriteImage)return this.drawSpriteText(a,c);null!==this.font&&(b.font=this.font);null!==this.textAlign&&(b.textAlign=this.textAlign);null!==this.textBaseline&&(b.textBaseline=this.textBaseline);this.fill&&null!==this.textFillStyle&&(b.fillStyle=this.textFillStyle);this.outline&&null!==this.outlineColor&&(b.strokeStyle=this.outlineColor);if(null===this.path){var d=
0;"center"===this.textAlign?d=this.width/2|0:"right"===this.textAlign&&(d=this.width);this.fill?(b.fillText(this.text,d,0),this.outline&&(b.beginPath(),b.strokeText(this.text,d,0))):(null!==this.outlineColor&&(b.strokeStyle=this.outlineColor),b.beginPath(),b.strokeText(this.text,d,0))}else this.drawOnPath(a,c)}},drawOnPath:function(a,c){for(var b=a.ctx,d=this.sign*this.pathInterpolator.getPosition(c%this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Point(0,0,0),f=new CAAT.Point(0,
0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),i=b.measureText(h).width,f=d,e=this.path.getPositionFromLength(f).clone(),f=this.path.getPositionFromLength(f-0.1).clone(),f=Math.atan2(e.y-f.y,e.x-f.x);b.save();b.translate(e.x>>0,e.y>>0);b.rotate(f);this.fill&&b.fillText(h,0,0);this.outline&&b.strokeText(h,0,0);b.restore();d+=i}},drawSpriteText:function(a,c){if(null===this.path){if(null==this.spriteTextAlignOffset)switch(this.textAlign){case "right":this.spriteTextAlignOffset=this.width-
this.textWidth;break;case "center":this.spriteTextAlignOffset=0.5*(this.width-this.textWidth)>>0;break;default:this.spriteTextAlignOffset=0}this.font.drawString(a.ctx,this.text,this.spriteTextAlignOffset,0)}else this.drawSpriteTextOnPath(a,c)},drawSpriteTextOnPath:function(a,c){for(var b=a.ctx,d=this.sign*this.pathInterpolator.getPosition(c%this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Point(0,0,0),f=new CAAT.Point(0,0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),
i=this.font.stringWidth(h);this.path.getLength();f=i/2+d;e=this.path.getPositionFromLength(f).clone();f=this.path.getPositionFromLength(f-0.1).clone();f=Math.atan2(e.y-f.y,e.x-f.x);b.save();b.translate(e.x|0,e.y|0);b.rotate(f);this.font.drawString(b,h,0,"bottom"===this.textBaseline?0-this.font.height:0);b.restore();d+=i}},setPath:function(a,c,b){this.path=a;this.pathInterpolator=c||(new CAAT.Interpolator).createLinearInterpolator();this.pathDuration=b||1E4;this.mouseEnabled=!1;return this}};extend(CAAT.TextActor,
CAAT.Actor,null)})();
(function(){CAAT.ShapeActor=function(){CAAT.ShapeActor.superclass.constructor.call(this);this.compositeOp="source-over";this.setShape(this.SHAPE_CIRCLE);return this};CAAT.ShapeActor.prototype={shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=a;return this},setLineJoin:function(a){this.lineJoin=a;return this},setMiterLimit:function(a){this.miterLimit=a;
return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(a){this.shape=a;this.paint=this.shape===this.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle;return this},setCompositeOp:function(a){this.compositeOp=a;return this},paint:function(){},paintCircle:function(a){var a=a.crc,c,b;if(!(null==this.fillStyle&&null==this.strokeStyle)&&(c=this.width/
2,b=this.height/2,a.beginPath(),this.width===this.height?a.arc(c,b,Math.min(this.width,this.height)/2,0,2*Math.PI,!1):(a.moveTo(c,0),a.bezierCurveTo(this.width,0,this.width,this.height,c,this.height),a.bezierCurveTo(0,this.height,0,0,c,0)),a.lineWidth=this.lineWidth,a.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(a.fillStyle=this.fillStyle,a.fill()),null!==this.strokeStyle))a.strokeStyle=this.strokeStyle,a.stroke()},paintRectangle:function(a){a=a.crc;if(!(null==this.fillStyle&&
null==this.strokeStyle)&&(a.lineWidth=this.lineWidth,this.lineCap&&(a.lineCap=this.lineCap),this.lineJoin&&(a.lineJoin=this.lineJoin),this.miterLimit&&(a.miterLimit=this.miterLimit),a.beginPath(),a.rect(0,0,this.width,this.height),a.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(a.fillStyle=this.fillStyle,a.fill()),null!==this.strokeStyle))a.strokeStyle=this.strokeStyle,a.stroke()}};extend(CAAT.ShapeActor,CAAT.ActorContainer,null)})();
(function(){CAAT.StarActor=function(){CAAT.StarActor.superclass.constructor.call(this);this.compositeOp="source-over";return this};CAAT.StarActor.prototype={nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=a;return this},setLineJoin:function(a){this.lineJoin=a;return this},setMiterLimit:function(a){this.miterLimit=a;return this},getLineCap:function(){return this.lineCap},
getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(){return this},setOutlined:function(){return this},setCompositeOp:function(a){this.compositeOp=a;return this},setInitialAngle:function(a){this.initialAngle=a;return this},initialize:function(a,c,b){this.setSize(2*c,2*c);this.nPeaks=a;this.maxRadius=c;this.minRadius=b;return this},paint:function(a){var a=a.ctx,c=this.width/2,b=this.height/2,
d=this.maxRadius,e=this.minRadius,f=c+d*Math.cos(this.initialAngle),g=b+d*Math.sin(this.initialAngle);a.lineWidth=this.lineWidth;this.lineCap&&(a.lineCap=this.lineCap);this.lineJoin&&(a.lineJoin=this.lineJoin);this.miterLimit&&(a.miterLimit=this.miterLimit);a.globalCompositeOperation=this.compositeOp;a.beginPath();a.moveTo(f,g);for(f=1;f<2*this.nPeaks;f++){var h=Math.PI/this.nPeaks*f+this.initialAngle,i=0===f%2?d:e,g=c+i*Math.cos(h),h=b+i*Math.sin(h);a.lineTo(g,h)}a.lineTo(c+d*Math.cos(this.initialAngle),
b+d*Math.sin(this.initialAngle));a.closePath();this.fillStyle&&(a.fillStyle=this.fillStyle,a.fill());this.strokeStyle&&(a.strokeStyle=this.strokeStyle,a.stroke())}};extend(CAAT.StarActor,CAAT.ActorContainer,null)})();
(function(){CAAT.IMActor=function(){CAAT.IMActor.superclass.constructor.call(this);return this};CAAT.IMActor.prototype={imageProcessor:null,changeTime:100,lastApplicationTime:-1,setImageProcessor:function(a){this.imageProcessor=a;return this},setImageProcessingTime:function(a){this.changeTime=a;return this},paint:function(a,c){c-this.lastApplicationTime>this.changeTime&&(this.imageProcessor.apply(a,c),this.lastApplicationTime=c);this.imageProcessor.paint(a,c)}};extend(CAAT.IMActor,CAAT.ActorContainer,
null)})();(function(){CAAT.AudioManager=function(){this.browserInfo=new CAAT.BrowserDetect;return this};CAAT.AudioManager.prototype={browserInfo:null,musicEnabled:!0,fxEnabled:!0,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(a){this.audioCache=[];this.channels=[];this.workingChannels=[];for(var c=0;c<a;c++){var b=document.createElement("audio");
if(null!==b){b.finished=-1;this.channels.push(b);var d=this;b.addEventListener("ended",function(a){var a=a.target,c;for(c=0;c<d.workingChannels.length;c++)if(d.workingChannels[c]===a){d.workingChannels.splice(c,1);break}a.caat_callback&&a.caat_callback(a.caat_id);d.channels.push(a)},!1)}}return this},addAudioFromURL:function(a,c,b){var d=null,e=document.createElement("audio");if(null!==e){if(!e.canPlayType)return!1;d=c.substr(c.lastIndexOf(".")+1);d=e.canPlayType(this.audioTypes[d]);if(""!==d&&"no"!==
d)return e.src=c,e.preload="auto",e.load(),b&&(e.caat_callback=b,e.caat_id=a),this.audioCache.push({id:a,audio:e}),!0}return!1},addAudioFromDomNode:function(a,c,b){var d=c.src.substr(c.src.lastIndexOf(".")+1);return c.canPlayType(this.audioTypes[d])?(b&&(c.caat_callback=b,c.caat_id=a),this.audioCache.push({id:a,audio:c}),!0):!1},addAudioElement:function(a,c,b){if("string"===typeof c)return this.addAudioFromURL(a,c,b);try{if(c instanceof HTMLAudioElement)return this.addAudioFromDomNode(a,c,b)}catch(d){}return!1},
addAudio:function(a,c,b){if(c instanceof Array)for(var d=0;d<c.length&&!this.addAudioElement(a,c[d],b);d++);else this.addAudioElement(a,c,b);return this},getAudio:function(a){for(var c=0;c<this.audioCache.length;c++)if(this.audioCache[c].id===a)return this.audioCache[c].audio;return null},setVolume:function(a,c){var b=this.getAudio(a);null!=b&&(b.volume=c);return this},play:function(a){if(!this.fxEnabled)return this;a=this.getAudio(a);if(null!==a&&0<this.channels.length){var c=this.channels.shift();
c.src=a.src;c.load();c.volume=a.volume;c.play();this.workingChannels.push(c)}return this},loop:function(a){if(!this.musicEnabled)return this;a=this.getAudio(a);if(null!==a){var c=document.createElement("audio");if(null!==c)return c.src=a.src,c.preload="auto","Firefox"===this.browserInfo.browser?c.addEventListener("ended",function(a){a.target.currentTime=0},!1):c.loop=!0,c.load(),c.play(),this.loopingChannels.push(c),c}return null},endSound:function(){var a;for(a=0;a<this.workingChannels.length;a++)this.workingChannels[a].pause(),
this.channels.push(this.workingChannels[a]);for(a=0;a<this.loopingChannels.length;a++)this.loopingChannels[a].pause();return this},setSoundEffectsEnabled:function(a){this.fxEnabled=a;return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(a){this.musicEnabled=a;for(var c=0;c<this.loopingChannels.length;c++)a?this.loopingChannels[c].play():this.loopingChannels[c].pause();return this},isMusicEnabled:function(){return this.musicEnabled}}})();(function(){CAAT.Dock=function(){CAAT.Dock.superclass.constructor.call(this);return this};CAAT.Dock.prototype={scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3,initialize:function(a){this.scene=a;return this},setApplicationRange:function(a){this.range=a;return this},setLayoutOp:function(a){this.layoutOp=a;return this},setSizes:function(a,c){this.minSize=a;this.maxSize=c;for(var b=0;b<this.childrenList.length;b++)this.childrenList[b].width=
a,this.childrenList[b].height=a;return this},layout:function(){var a,c;if(this.layoutOp===this.OP_LAYOUT_BOTTOM||this.layoutOp===this.OP_LAYOUT_TOP){var b=c=0;for(a=0;a<this.getNumChildren();a++)c+=this.getChildAt(a).width;b=(this.width-c)/2;for(a=0;a<this.getNumChildren();a++)c=this.getChildAt(a),c.x=b,b+=c.width,c.y=this.layoutOp===this.OP_LAYOUT_BOTTOM?this.maxSize-c.height:0}else{for(a=b=c=0;a<this.getNumChildren();a++)c+=this.getChildAt(a).height;b=(this.height-c)/2;for(a=0;a<this.getNumChildren();a++)c=
this.getChildAt(a),c.y=b,b+=c.height,c.x=this.layoutOp===this.OP_LAYOUT_LEFT?0:this.width-c.width}},mouseMove:function(){this.actorNotPointed()},mouseExit:function(){this.actorNotPointed()},actorNotPointed:function(){var a,c=this;for(a=0;a<this.getNumChildren();a++){var b=this.getChildAt(a);b.emptyBehaviorList();b.addBehavior((new CAAT.GenericBehavior).setValues(b.width,this.minSize,b,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.GenericBehavior).setValues(b.height,this.minSize,
b,"height").setFrameTime(this.scene.time,250));a===this.getNumChildren()-1&&b.behaviorList[0].addListener({behaviorApplied:function(a,c,b,g){g.parent.layout()},behaviorExpired:function(d,e,f){for(a=0;a<c.getNumChildren();a++)b=c.getChildAt(a),b.width=c.minSize,b.height=c.minSize;f.parent.layout()}})}},actorPointed:function(a,c,b){for(var d=this.findChild(b),e=0,e=this.layoutOp===this.OP_LAYOUT_BOTTOM||this.layoutOp===this.OP_LAYOUT_TOP?a/b.width:c/b.height,a=0;a<this.childrenList.length;a++)c=this.childrenList[a],
c.emptyBehaviorList(),b=0,b=a<d-this.range||a>d+this.range?this.minSize:a===d?this.maxSize:a<d?this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-e+1)/this.range*Math.PI)+1)/2:this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-e)/this.range*Math.PI)+1)/2,c.height=b,c.width=b;this.layout()},actorMouseExit:function(){null!==this.ttask&&this.ttask.cancel();var a=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(){a.actorNotPointed()},null,null)},actorMouseEnter:function(){null!==
this.ttask&&(this.ttask.cancel(),this.ttask=null)},addChild:function(a){var c=this;a.__Dock_mouseEnter=a.mouseEnter;a.__Dock_mouseExit=a.mouseExit;a.__Dock_mouseMove=a.mouseMove;a.mouseEnter=function(a){c.actorMouseEnter(a);this.__Dock_mouseEnter(a)};a.mouseExit=function(a){c.actorMouseExit(a);this.__Dock_mouseExit(a)};a.mouseMove=function(a){c.actorPointed(a.point.x,a.point.y,a.source);this.__Dock_mouseMove(a)};a.width=this.minSize;a.height=this.minSize;return CAAT.Dock.superclass.addChild.call(this,
a)}};extend(CAAT.Dock,CAAT.ActorContainer,null)})();(function(){var a={};CAAT.Director=function(){CAAT.Director.superclass.constructor.call(this);this.browserInfo=new CAAT.BrowserDetect;this.audioManager=(new CAAT.AudioManager).initialize(8);this.scenes=[];this.mousePoint=new CAAT.Point(0,0,0);this.prevScreenMousePoint=new CAAT.Point(0,0,0);this.screenMousePoint=new CAAT.Point(0,0,0);this.isMouseDown=!1;this.lastSelectedActor=null;this.dragging=!1;this.cDirtyRects=[];this.dirtyRects=[];for(var a=0;64>a;a++)this.dirtyRects.push(new CAAT.Rectangle);
this.dirtyRectsIndex=0;this.touches={};return this};CAAT.Director.RENDER_MODE_CONTINUOUS=1;CAAT.Director.RENDER_MODE_DIRTY=2;CAAT.Director.CLEAR_DIRTY_RECTS=1;CAAT.Director.CLEAR_ALL=!0;CAAT.Director.CLEAR_NONE=!1;CAAT.Director.prototype={debug:!1,renderMode:CAAT.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevScreenMousePoint:null,screenMousePoint:null,isMouseDown:!1,lastSelectedActor:null,dragging:!1,scenes:null,currentScene:null,canvas:null,crc:null,ctx:null,
time:0,timeline:0,timeDelta:0,imagesCache:null,audioManager:null,clear:!0,transitionScene:null,browserInfo:null,gl:null,glEnabled:!1,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:!1,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16,resize:1,onResizeCallback:null,
__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:!1,nDirtyRects:0,stopped:!1,needsRepaint:!1,touches:null,touching:null,requestRepaint:function(){this.needsRepaint=!0},getCurrentScene:function(){return this.currentScene},setRenderMode:function(a){if(a===CAAT.Director.RENDER_MODE_CONTINUOUS||a===CAAT.Director.RENDER_MODE_DIRTY)this.renderMode=a;return this},checkDebug:function(){if(CAAT.DEBUG){var a=(new CAAT.Debug).initialize(this.width,60);
this.debugInfo=a.debugInfo.bind(a)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(a,b){var d=this.canvas.parentNode,e=document.getElementsByTagName("body")[0];d!=e&&(a=d.clientWidth,b=d.clientHeight);switch(this.resize){case this.RESIZE_WIDTH:this.setBounds(0,0,a,this.height);break;case this.RESIZE_HEIGHT:this.setBounds(0,0,this.width,b);break;case this.RESIZE_BOTH:this.setBounds(0,0,a,b);break;case this.RESIZE_PROPORTIONAL:this.setScaleProportional(a,b)}this.glEnabled&&
this.glReset();if(this.onResizeCallback)this.onResizeCallback(this,a,b)},setScaleProportional:function(a,b){var d=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.setScaleAnchored(d,d,0,0);this.canvas.width=this.referenceWidth*d;this.canvas.height=this.referenceHeight*d;this.crc=this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.glEnabled&&this.glReset()},enableResizeEvents:function(a,b){a===this.RESIZE_BOTH||a===this.RESIZE_WIDTH||a===this.RESIZE_HEIGHT||a===
this.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=a,CAAT.registerResizeListener(this),this.onResizeCallback=b,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null)},setBounds:function(a,b,d,e){CAAT.Director.superclass.setBounds.call(this,a,b,d,e);this.canvas.width=d;this.canvas.height=e;this.crc=this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");for(a=0;a<
this.scenes.length;a++)this.scenes[a].setBounds(0,0,d,e);this.glEnabled&&this.glReset();return this},initialize:function(a,b,d,e){d||(d=document.createElement("canvas"),document.body.appendChild(d));this.canvas=d;"undefined"===typeof e&&(e=d);this.setBounds(0,0,a,b);this.enableEvents(e);this.timeline=-1;this.transitionScene=(new CAAT.Scene).setBounds(0,0,a,b);d=document.createElement("canvas");d.width=a;d.height=b;a=(new CAAT.Actor).setBackgroundImage(d);this.transitionScene.ctx=d.getContext("2d");
this.transitionScene.addChildImmediately(a);this.transitionScene.setEaseListener(this);this.checkDebug();return this},glReset:function(){this.pMatrix=makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1);this.gl.viewport(0,0,this.canvas.width,this.canvas.height);this.glColorProgram.setMatrixUniform(this.pMatrix);this.glTextureProgram.setMatrixUniform(this.pMatrix);this.gl.viewportWidth=this.canvas.width;this.gl.viewportHeight=this.canvas.height},initializeGL:function(a,b,d){d||(d=document.createElement("canvas"),
document.body.appendChild(d));d.width=a;d.height=b;this.referenceWidth=a;this.referenceHeight=b;try{this.gl=d.getContext("experimental-webgl"),this.gl.viewportWidth=a,this.gl.viewportHeight=b,CAAT.GLRENDER=!0}catch(e){}if(this.gl)this.canvas=d,this.setBounds(0,0,a,b),this.crc=this.ctx,this.enableEvents(d),this.timeline=-1,this.glColorProgram=(new CAAT.ColorProgram(this.gl)).create().initialize(),this.glTextureProgram=(new CAAT.TextureProgram(this.gl)).create().initialize(),this.glTextureProgram.useProgram(),
this.glReset(),this.coords=new Float32Array(6144),this.uv=new Float32Array(4096),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=!0,this.checkDebug();else return this.initialize(a,b,d);return this},createScene:function(){var a=new CAAT.Scene;this.addScene(a);return a},
setImagesCache:function(a,b,d){var e;null!==this.glTextureManager&&(this.glTextureManager.deletePages(),this.glTextureManager=null);if(this.imagesCache){var f=[];for(e=0;e<this.imagesCache.length;e++)f.push(this.imagesCache[e].id);for(e=0;e<f.length;e++)delete this.imagesCache[f[e]]}if(this.imagesCache=a)for(e=0;e<a.length;e++)this.imagesCache[a[e].id]=a[e].image;this.tpW=b||2048;this.tpH=d||2048;this.updateGLPages();return this},updateGLPages:function(){this.glEnabled&&(this.glTextureManager=new CAAT.GLTexturePageManager,
this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture))},setGLTexturePage:function(a){this.currentTexturePage=a;this.glTextureProgram.setTexture(a.texture);return this},addImage:function(a,b,d){if(this.getImage(a))for(var e=0;e<this.imagesCache.length;e++){if(this.imagesCache[e].id===a){this.imagesCache[e].image=b;break}}else this.imagesCache.push({id:a,image:b});
this.imagesCache[a]=b;d||this.updateGLPages()},deleteImage:function(a,b){for(var d=0;d<this.imagesCache.length;d++)if(this.imagesCache[d].id===a){delete this.imagesCache[a];this.imagesCache.splice(d,1);break}b||this.updateGLPages()},setGLCurrentOpacity:function(a){this.currentOpacity=a;this.glTextureProgram.setAlpha(a)},glRender:function(a,b,d){var a=a||this.coords,d=d||this.uv,b=b||this.coordsIndex,e=this.gl,b=2*(b/12);this.glTextureProgram.updateVertexBuffer(a);this.glTextureProgram.updateUVBuffer(d);
e.drawElements(e.TRIANGLES,3*b,e.UNSIGNED_SHORT,0)},glFlush:function(){0!==this.coordsIndex&&this.glRender(this.coords,this.coordsIndex,this.uv);this.uvIndex=this.coordsIndex=0;this.statistics.draws++},findActorAtPosition:function(a){for(var b=this.childrenList.length-1;0<=b;b--){var d=this.childrenList[b],e=new CAAT.Point(a.x,a.y,0),d=d.findActorAtPosition(e);if(null!==d)return d}return this},resetStats:function(){this.statistics.size_total=0;this.statistics.size_active=0;this.statistics.draws=0},
render:function(a){if(!this.currentScene||!this.currentScene.isPaused()){this.time+=a;this.animate(this,this.time);CAAT.DEBUG&&this.resetStats();var b=this.childrenList.length,d,e,f,g=this.ctx;d=this.canvas;if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);for(d=this.uvIndex=this.coordsIndex=0;d<b;d++)if(f=this.childrenList[d],f.isInAnimationFrame(this.time)){e=f.time-f.start_time;if(f.onRenderStart)f.onRenderStart(e);f.paintActorGL(this,e);if(f.onRenderEnd)f.onRenderEnd(e);
f.isPaused()||(f.time+=a);CAAT.DEBUG&&(this.statistics.size_total+=f.size_total,this.statistics.size_active+=f.size_active)}this.glFlush()}else{g.globalAlpha=1;g.globalCompositeOperation="source-over";g.save();if(this.dirtyRectsEnabled)if(this.modelViewMatrix.transformRenderingContext(g),CAAT.DEBUG_DIRTYRECTS)g.clearRect(0,0,d.width,d.height);else{g.beginPath();this.nDirtyRects=0;e=this.cDirtyRects;for(d=0;d<e.length;d++)f=e[d],f.isEmpty()||(g.rect(f.x|0,f.y|0,1+(f.width|0),1+(f.height|0)),this.nDirtyRects++);
g.clip()}else!0===this.clear&&g.clearRect(0,0,d.width,d.height);for(d=0;d<b;d++)if(f=this.childrenList[d],f.isInAnimationFrame(this.time)){e=f.time-f.start_time;g.save();if(f.onRenderStart)f.onRenderStart(e);!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&f.paintActor(this,e):f.paintActor(this,e);if(f.onRenderEnd)f.onRenderEnd(e);g.restore();CAAT.DEBUGAABB&&(g.globalAlpha=1,g.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(g),f.drawScreenBoundingBox(this,
e));f.isPaused()||(f.time+=a);CAAT.DEBUG&&(this.statistics.size_total+=f.size_total,this.statistics.size_active+=f.size_active,this.statistics.size_dirtyRects=this.nDirtyRects)}if(0<this.nDirtyRects&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){g.beginPath();this.nDirtyRects=0;e=this.cDirtyRects;for(d=0;d<e.length;d++)f=e[d],f.isEmpty()||(g.rect(f.x|0,f.y|0,1+(f.width|0),1+(f.height|0)),this.nDirtyRects++);g.clip();g.fillStyle="rgba(160,255,150,.4)";g.fillRect(0,0,this.width,this.height)}g.restore()}this.frameCounter++}},
animate:function(){this.setModelViewMatrix(this);this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.setScreenBounds();this.invalid=this.dirty=!1;this.dirtyRectsIndex=-1;this.cDirtyRects=[];for(var a=this.childrenList,b,d=0;d<a.length;d++)b=a[d],b.animate(this,b.time-b.start_time);return this},addDirtyRect:function(a){if(!a.isEmpty()){var b,d,e,f,g=this.cDirtyRects;for(b=0;b<g.length;b++)if(d=g[b],!d.isEmpty()&&d.intersects(a)){for(var h=!0;h;){d.unionRectangle(a);for(e=0;e<g.length;e++)if(e!==
b&&(f=g[e],!f.isEmpty()&&f.intersects(d))){d.unionRectangle(f);f.setEmpty();break}e==g.length&&(h=!1)}for(e=0;e<g.length;e++)g[e].isEmpty()&&g.splice(e,1);return}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length)for(b=0;32>b;b++)this.dirtyRects.push(new CAAT.Rectangle);b=this.dirtyRects[this.dirtyRectsIndex];b.x=a.x;b.y=a.y;b.x1=a.x1;b.y1=a.y1;b.width=a.width;b.height=a.height;this.cDirtyRects.push(b)}},renderToContext:function(a,b){if(b.isInAnimationFrame(this.time)){a.setTransform(1,
0,0,1,0,0);a.globalAlpha=1;a.globalCompositeOperation="source-over";a.clearRect(0,0,this.width,this.height);var d=this.ctx,e=this.crc;this.crc=this.ctx=a;a.save();var f=this.modelViewMatrix,g=this.worldModelViewMatrix;this.modelViewMatrix=this.worldModelViewMatrix=new CAAT.Matrix;this.wdirty=!0;b.animate(this,b.time);if(b.onRenderStart)b.onRenderStart(b.time);b.paintActor(this,b.time);if(b.onRenderEnd)b.onRenderEnd(b.time);this.worldModelViewMatrix=g;this.modelViewMatrix=f;a.restore();this.ctx=d;
this.crc=e}},addScene:function(a){a.setBounds(0,0,this.width,this.height);this.scenes.push(a);a.setEaseListener(this);null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(a,b,d,e,f,g,h,i,j,k,l){a!==this.getCurrentSceneIndex()&&((a=this.scenes[a],e=this.scenes[e],!CAAT.__CSS__&&!this.glEnabled&&(this.renderToContext(this.transitionScene.ctx,e),e=this.transitionScene),a.setExpired(!1),e.setExpired(!1),a.mouseEnabled=!1,e.mouseEnabled=!1,a.resetTransform(),
e.resetTransform(),a.setPosition(0,0),e.setPosition(0,0),a.alpha=1,e.alpha=1,b===CAAT.Scene.prototype.EASE_ROTATION?a.easeRotationIn(h,i,d,j):b===CAAT.Scene.prototype.EASE_SCALE?a.easeScaleIn(0,h,i,d,j):b===CAAT.Scene.prototype.EASE_STATIONARY?a.easeStationary(h,i,!0):a.easeTranslationIn(h,i,d,j),f===CAAT.Scene.prototype.EASE_ROTATION?e.easeRotationOut(h,i,g,k):f===CAAT.Scene.prototype.EASE_SCALE?e.easeScaleOut(0,h,i,g,k):f===CAAT.Scene.prototype.EASE_STATIONARY?e.easeStationary(h,i,!1):e.easeTranslationOut(h,
i,g,k),this.childrenList=[],l)?(this.addChild(a),this.addChild(e)):(this.addChild(e),this.addChild(a)))},easeInOutRandom:function(a,b,d,e){var f=Math.random(),g=Math.random(),h;0.33>f?(f=CAAT.Scene.prototype.EASE_ROTATION,h=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)):0.66>f?(f=CAAT.Scene.prototype.EASE_SCALE,h=(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4)):(f=CAAT.Scene.prototype.EASE_TRANSLATE,h=(new CAAT.Interpolator).createBounceOutInterpolator());var i;0.33>
g?(g=CAAT.Scene.prototype.EASE_ROTATION,i=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)):0.66>g?(g=CAAT.Scene.prototype.EASE_SCALE,i=(new CAAT.Interpolator).createExponentialOutInterpolator(4)):(g=CAAT.Scene.prototype.EASE_TRANSLATE,i=(new CAAT.Interpolator).createBounceOutInterpolator());this.easeInOut(a,f,8.99*Math.random()>>0,b,g,8.99*Math.random()>>0,d,e,h,i,!0)},easeIn:function(a,b,d,e,f,g){a=this.scenes[a];b===CAAT.Scene.prototype.EASE_ROTATION?a.easeRotationIn(d,e,f,g):b===
CAAT.Scene.prototype.EASE_SCALE?a.easeScaleIn(0,d,e,f,g):a.easeTranslationIn(d,e,f,g);this.childrenList=[];this.addChild(a);a.resetTransform();a.setPosition(0,0);a.alpha=1;a.mouseEnabled=!1;a.setExpired(!1)},setScene:function(a){a=this.scenes[a];this.childrenList=[];this.addChild(a);this.currentScene=a;a.setExpired(!1);a.mouseEnabled=!0;a.resetTransform();a.setPosition(0,0);a.alpha=1;a.activated()},switchToScene:function(a,b,d,e){var f=this.getSceneIndex(this.currentScene);e?this.easeInOutRandom(a,
f,b,d):this.setScene(a)},switchToPrevScene:function(a,b,d){var e=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||0===e||(d?this.easeInOutRandom(e-1,e,a,b):this.setScene(e-1))},switchToNextScene:function(a,b,d){var e=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||e===this.getNumScenes()-1||(d?this.easeInOutRandom(e+1,e,a,b):this.setScene(e+1))},mouseEnter:function(){},mouseExit:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseDrag:function(){},
easeEnd:function(a,b){b?(this.currentScene=a,this.currentScene.activated()):(this.removeChild(a),a.setExpired(!0));a.mouseEnabled=!0;a.emptyBehaviorList()},getSceneIndex:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b]===a)return b;return-1},getScene:function(a){return this.scenes[a]},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},
getOSName:function(){return this.browserInfo.OS},getImage:function(a){var b=this.imagesCache[a];if(b)return b;for(b=0;b<this.imagesCache.length;b++)if(this.imagesCache[b].id===a)return this.imagesCache[b].image;return null},addAudio:function(a,b){this.audioManager.addAudio(a,b);return this},audioPlay:function(a){this.audioManager.play(a)},audioLoop:function(a){return this.audioManager.loop(a)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(a){return this.audioManager.setSoundEffectsEnabled(a)},
setMusicEnabled:function(a){return this.audioManager.setMusicEnabled(a)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(a,b){return this.audioManager.setVolume(a,b)},emptyScenes:function(){this.scenes=[]},addChild:function(a){var b=a.dirty;a.setParent(this);a.dirty=b;this.childrenList.push(a)},loop:function(a,b,d){d?(this.onRenderStart=b,this.onRenderEnd=d):b&&(this.onRenderEnd=
b);CAAT.loop()},renderFrame:function(){if(!this.stopped){CAAT.currentDirector=this;var a=(new Date).getTime(),b;b=0<this.timeline?a-this.timeline:1E3/60;this.timeline=a;500<b&&(b=500);this.timeDelta=b;if(this.onRenderStart)this.onRenderStart(b);this.render(b);this.debugInfo&&this.debugInfo(this.statistics);if(this.onRenderEnd)this.onRenderEnd(b);this.needsRepaint=!1;CAAT.currentDirector=null}},resetTimeline:function(){this.timeline=-1},endLoop:function(){},setClear:function(a){this.clear=a;this.clear===
CAAT.Director.CLEAR_DIRTY_RECTS&&(this.dirtyRectsEnabled=!0);return this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(a,b,d){for(var e=d+"Left",d=d+"Top",f=0,g=0,h;"iOS"!==navigator.browser&&(a&&a.style)&&!(h=a.currentStyle?a.currentStyle.position:(h=(a.ownerDocument.defaultView||a.ownerDocument.parentWindow).getComputedStyle(a,null))?h.getPropertyValue("position"):null,/^(fixed)$/.test(h));)f+=a[e],g+=a[d],a=a[b];return{x:f,y:g,style:h}},getOffset:function(a){var b=
this.cumulateOffset(a,"offsetParent","offset");return"fixed"===b.style?(a=this.cumulateOffset(a,a.parentNode?"parentNode":"parentElement","scroll"),{x:b.x+a.x,y:b.y+a.y}):{x:b.x,y:b.y}},getCanvasCoord:function(a,b){var d=new CAAT.Point,e=0,f=0;b||(b=window.event);if(b.pageX||b.pageY)e=b.pageX,f=b.pageY;else if(b.clientX||b.clientY)e=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=b.clientY+document.body.scrollTop+document.documentElement.scrollTop;var g=this.getOffset(this.canvas),
e=e-g.x,f=f-g.y;d.x=e;d.y=f;this.modelViewMatrixI||(this.modelViewMatrixI=this.modelViewMatrix.getInverse());this.modelViewMatrixI.transformCoord(d);e=d.x;f=d.y;a.set(e,f);this.screenMousePoint.set(e,f)},__mouseDownHandler:function(a){if(this.dragging&&this.lastSelectedActor)return this.__mouseUpHandler(a),!1;var b=this.mousePoint;this.getCanvasCoord(b,a);if(0>b.x||0>b.y||b.x>=this.width||b.y>=this.height)return!1;this.isMouseDown=!0;b=this.findActorAtPosition(this.mousePoint);if(null!==b){var d=
b.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));b.mouseDown((new CAAT.MouseEvent).init(d.x,d.y,a,b,new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=b;return!0},__mouseUpHandler:function(a){var b=null,d=this.lastSelectedActor;if(null===d)return!1;this.isMouseDown=!1;this.getCanvasCoord(this.mousePoint,a);b=d.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));d.actionPerformed&&d.contains(b.x,b.y)&&
d.actionPerformed(a);d.mouseUp((new CAAT.MouseEvent).init(b.x,b.y,a,d,this.screenMousePoint,this.currentScene.time));this.dragging||d.contains(b.x,b.y)&&d.mouseClick((new CAAT.MouseEvent).init(b.x,b.y,a,d,this.screenMousePoint,this.currentScene.time));this.in_=this.dragging=!1;return!0},__mouseMoveHandler:function(a){var b=this.mousePoint;this.getCanvasCoord(b,a);if(!this.dragging&&(0>b.x||0>b.y||b.x>=this.width||b.y>=this.height))return!1;var d,e,f=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&
null!==this.lastSelectedActor){if(!this.dragging&&Math.abs(this.prevScreenMousePoint.x-this.screenMousePoint.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(this.prevScreenMousePoint.y-this.screenMousePoint.y)<CAAT.DRAG_THRESHOLD_Y)return;d=this.lastSelectedActor;e=d.viewToModel(b.set(this.screenMousePoint.x,this.screenMousePoint.y,0));this.dragging=!0;var b=d.x,g=d.y;d.mouseDrag((new CAAT.MouseEvent).init(e.x,e.y,a,d,new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y),f));this.prevScreenMousePoint.x=
this.screenMousePoint.x;this.prevScreenMousePoint.y=this.screenMousePoint.y;if(b===d.x&&g===d.y&&(b=d.contains(e.x,e.y),this.in_&&!b&&(d.mouseExit((new CAAT.MouseEvent).init(e.x,e.y,a,d,this.screenMousePoint,f)),this.in_=!1),!this.in_&&b))d.mouseEnter((new CAAT.MouseEvent).init(e.x,e.y,a,d,this.screenMousePoint,f)),this.in_=!0;return!0}this.in_=!0;d=this.findActorAtPosition(this.mousePoint);if(d!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(e=this.lastSelectedActor.viewToModel(b.set(this.screenMousePoint.x,
this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.MouseEvent).init(e.x,e.y,a,this.lastSelectedActor,this.screenMousePoint,f))),null!==d))e=d.viewToModel(b.set(this.screenMousePoint.x,this.screenMousePoint.y,0)),d.mouseEnter((new CAAT.MouseEvent).init(e.x,e.y,a,d,this.screenMousePoint,f));e=d.viewToModel(b.set(this.screenMousePoint.x,this.screenMousePoint.y,0));null!==d&&d.mouseMove((new CAAT.MouseEvent).init(e.x,e.y,a,d,this.screenMousePoint,f));this.prevScreenMousePoint.x=this.screenMousePoint.x;
this.prevScreenMousePoint.y=this.screenMousePoint.y;this.lastSelectedActor=d;return!0},__mouseOutHandler:function(a){if(this.dragging)return!1;if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,a);var b=this.mousePoint.set(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(b);a=(new CAAT.MouseEvent).init(b.x,b.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);this.lastSelectedActor.mouseExit(a);this.lastSelectedActor.mouseOut(a);this.dragging||
(this.lastSelectedActor=null)}else this.in_=this.isMouseDown=!1;return!0},__mouseOverHandler:function(a){if(this.dragging)return!1;var b=this.mousePoint;this.getCanvasCoord(b,a);if(0>b.x||0>b.y||b.x>=this.width||b.y>=this.height)return!1;var d;null==this.lastSelectedActor?(d=this.findActorAtPosition(b),null!==d&&(b=d.viewToModel(b.set(this.screenMousePoint.x,this.screenMousePoint.y,0)),a=(new CAAT.MouseEvent).init(b.x,b.y,a,d,this.screenMousePoint,this.currentScene?this.currentScene.time:0),d.mouseOver(a),
d.mouseEnter(a)),this.lastSelectedActor=d):(d=this.lastSelectedActor,b=d.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),a=(new CAAT.MouseEvent).init(b.x,b.y,a,d,this.screenMousePoint,this.currentScene.time),d.mouseOver(a),d.mouseEnter(a));return!0},__mouseDBLClickHandler:function(a){var b=this.mousePoint;this.getCanvasCoord(b,a);if(0>b.x||0>b.y||b.x>=this.width||b.y>=this.height)return!1;null!==this.lastSelectedActor&&(b=this.lastSelectedActor.viewToModel(b.set(this.screenMousePoint.x,
this.screenMousePoint.y,0)),this.lastSelectedActor.mouseDblClick((new CAAT.MouseEvent).init(b.x,b.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time)));return!0},__touchStartHandler:function(a){a.target===this.canvas&&null===this.touching&&(a.preventDefault(),a=a.changedTouches[0],CAAT.currentDirector=this,this.__mouseDownHandler(a)&&(this.touching=a.identifier,null!==this.lastSelectedActor&&this.prevScreenMousePoint.set(this.screenMousePoint.x,this.screenMousePoint.y)),CAAT.currentDirector=
null)},__touchEndHandler:function(a){if(null!==this.touching){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b];if(d.identifier===this.touching){this.getCanvasCoord(this.mousePoint,d);CAAT.currentDirector=this;this.__mouseUpHandler(d);this.touching=CAAT.currentDirector=null;break}}}},__touchMoveHandler:function(a){if(null!==this.touching&&(a.preventDefault(),!this.gesturing))for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b];if(d.identifier===
this.touching){CAAT.currentDirector=this;this.__mouseMoveHandler(d);CAAT.currentDirector=null;break}}},__gestureStart:function(){this.gesturing=!0;this.__gestureRotation=this.lastSelectedActor.rotationAngle;this.__gestureSX=this.lastSelectedActor.scaleX-1;this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(a,b){if(!("undefined"===typeof a||"undefined"===typeof b)&&null!==this.lastSelectedActor&&this.lastSelectedActor.isGestureEnabled())this.lastSelectedActor.setRotation(b*Math.PI/
180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+a,this.__gestureSY+a)},__gestureEnd:function(){this.gesturing=!1;this.__gestureScale=this.__gestureRotation=0},__touchEndHandlerMT:function(a){CAAT.currentDirector=this;a.preventDefault();var b,d=[];for(b=0;b<a.changedTouches.length;b++){var e=a.changedTouches[b].identifier;d.push(e)}var f={};for(b=0;b<d.length;b++){var g=d[b];this.touches[g]&&(e=this.touches[g].actor,f[e.id]||(f[e.id]={actor:e,touch:(new CAAT.TouchEvent).init(a,
e,this.currentScene.time)}),f[e.id].touch.addChangedTouch(this.touches[g].touch))}for(b=0;b<a.changedTouches.length;b++)d=a.changedTouches[b],e=d.identifier,delete this.touches[e];for(var h in f){var a=f[h],e=a.actor,d=a.touch,i;for(i in this.touches)a=this.touches[i],a.actor.id===e.id&&d.addTouch(a.touch);e.touchEnd(d)}CAAT.currentDirector=null},__touchMoveHandlerMT:function(a){CAAT.currentDirector=this;a.preventDefault();var b,d=[];for(b=0;b<a.changedTouches.length;b++){var e=a.changedTouches[b],
f=e.identifier,g=this.touches[f];if(g){var h=this.mousePoint;this.getCanvasCoord(h,e);e=g.touch;if(e.dragging||!(Math.abs(e.screenPoint.x-h.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(e.screenPoint.y-h.y)<CAAT.DRAG_THRESHOLD_Y))g=g.actor,h=g.viewToModel(h),e.point.set(h.x,h.y),e.screenPoint.set(this.screenMousePoint.x,this.screenMousePoint.y),e.draggig=!0,d.push(f)}}if(0<d.length){f={};for(b=0;b<d.length;b++)e=d[b],g=this.touches[e].actor,f[g.id]||(f[g.id]={actor:g,touch:(new CAAT.TouchEvent).init(a,g,this.currentScene.time)}),
g=f[g.id].touch,g.addTouch(this.touches[e].touch),g.addChangedTouch(this.touches[e].touch);for(var i in f){var a=f[i],g=a.actor,e=a.touch,j;for(j in this.touches)a=this.touches[j],a.actor.id===g.id&&e.addTouch(a.touch);g.touchMove(e)}}CAAT.currentDirector=null},__touchCancelHandleMT:function(a){this.__touchEndHandlerMT(a)},__touchStartHandlerMT:function(a){CAAT.currentDirector=this;a.preventDefault();var b,d=[];for(b=0;b<a.changedTouches.length;b++){var e=a.changedTouches[b],f=e.identifier,g=this.mousePoint;
this.getCanvasCoord(g,e);if(!(0>g.x||0>g.y||g.x>=this.width||g.y>=this.height)){var h=this.findActorAtPosition(g);null!==h&&(g=h.viewToModel(g),this.touches[f]||(this.touches[f]={actor:h,touch:new CAAT.TouchInfo(f,g,this.screenMousePoint,h)},d.push(f)))}}f={};for(b=0;b<d.length;b++)e=d[b],h=this.touches[e].actor,f[h.id]||(f[h.id]={actor:h,touch:(new CAAT.TouchEvent).init(a,h,this.currentScene.time)}),h=f[h.id].touch,h.addTouch(this.touches[e].touch),h.addChangedTouch(this.touches[e].touch);for(var i in f){var a=
f[i],h=a.actor,e=a.touch,j;for(j in this.touches)a=this.touches[j],a.actor.id===h.id&&e.addTouch(a.touch);h.touchStart(e)}CAAT.currentDirector=null},__findTouchFirstActor:function(){var a=Number.MAX_VALUE,b=null,d;for(d in this.touches){var e=this.touches[d];e.touch.time&&(e.touch.time<a&&e.actor.isGestureEnabled())&&(b=e.actor,a=e.touch.time)}return b},__gesturedActor:null,__touchGestureStartHandleMT:function(a){CAAT.currentDirector=this;var b=this.__findTouchFirstActor();null!==b&&b.isGestureEnabled()&&
(this.__gesturedActor=b,this.__gestureRotation=b.rotationAngle,this.__gestureSX=b.scaleX-1,this.__gestureSY=b.scaleY-1,b.gestureStart(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY));CAAT.currentDirector=null},__touchGestureEndHandleMT:function(a){CAAT.currentDirector=this;null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY);this.__gestureScale=this.__gestureRotation=
0;CAAT.currentDirector=null},__touchGestureChangeHandleMT:function(a){CAAT.currentDirector=this;null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(a.rotation*Math.PI/180,this.__gestureSX+a.scale,this.__gestureSY+a.scale);CAAT.currentDirector=null},addHandlers:function(c){var b=this;window.addEventListener("mouseup",function(c){b.touching===a&&(c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation(),CAAT.currentDirector=b,b.__mouseUpHandler(c),
CAAT.currentDirector=null,b.touching=null)},!1);window.addEventListener("mousedown",function(d){if(d.target===c&&(null===b.touching||b.touching===a))d.preventDefault(),d.cancelBubble=!0,d.stopPropagation&&d.stopPropagation(),CAAT.currentDirector=b,b.touching=b.__mouseDownHandler(d)?a:null,CAAT.currentDirector=null},!1);window.addEventListener("mouseover",function(d){if(d.target===c&&(null===b.touching||b.touching===a))d.preventDefault(),d.cancelBubble=!0,d.stopPropagation&&d.stopPropagation(),CAAT.currentDirector=
b,b.__mouseOverHandler(d),CAAT.currentDirector=null},!1);window.addEventListener("mouseout",function(d){if(d.target===c&&(null===b.touching||b.touching===a))d.preventDefault(),d.cancelBubble=!0,d.stopPropagation&&d.stopPropagation(),CAAT.currentDirector=b,b.__mouseOutHandler(d),CAAT.currentDirector=null},!1);window.addEventListener("mousemove",function(c){null!==b.touching&&b.touching!==a||(c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation(),CAAT.currentDirector=b,b.__mouseMoveHandler(c),
CAAT.currentDirector=null)},!1);window.addEventListener("dblclick",function(d){if(d.target===c&&(null===b.touching||b.touching===a))d.preventDefault(),d.cancelBubble=!0,d.stopPropagation&&d.stopPropagation(),CAAT.currentDirector=b,b.__mouseDBLClickHandler(d),CAAT.currentDirector=null},!1);CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(c.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),c.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),c.addEventListener("touchend",
this.__touchEndHandler.bind(this),!1),c.addEventListener("gesturestart",function(a){a.target===c&&(a.preventDefault(),b.__gestureStart(a.scale,a.rotation))},!1),c.addEventListener("gestureend",function(a){a.target===c&&(a.preventDefault(),b.__gestureEnd(a.scale,a.rotation))},!1),c.addEventListener("gesturechange",function(a){a.target===c&&(a.preventDefault(),b.__gestureChange(a.scale,a.rotation))},!1)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(c.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),
!1),c.addEventListener("touchmove",this.__touchMoveHandlerMT.bind(this),!1),c.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),!1),c.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),!1),c.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),!1),c.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),!1),c.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),!1))},enableEvents:function(a){CAAT.RegisterDirector(this);
this.in_=!1;this.createEventHandler(a)},createEventHandler:function(a){this.in_=!1;this.addHandlers(a)}};CAAT.__CSS__&&(CAAT.Director.prototype.clip=!0,CAAT.Director.prototype.glEnabled=!1,CAAT.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Director.prototype.setScaleProportional=function(a,b){var d=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.setScaleAnchored(d,d,0,0);this.eventHandler.style.width=""+this.referenceWidth+"px";this.eventHandler.style.height=""+this.referenceHeight+
"px"},CAAT.Director.prototype.setBounds=function(a,b,d,e){CAAT.Director.superclass.setBounds.call(this,a,b,d,e);for(a=0;a<this.scenes.length;a++)this.scenes[a].setBounds(0,0,d,e);this.eventHandler.style.width=d+"px";this.eventHandler.style.height=e+"px";return this},CAAT.Director.prototype.initialize=function(a,b,d){this.timeline=-1;this.domElement=d;this.style("position","absolute");this.style("width",""+a+"px");this.style("height",""+b+"px");this.style("overflow","hidden");this.enableEvents(d);
this.setBounds(0,0,a,b);this.checkDebug();return this},CAAT.Director.prototype.render=function(a){this.time+=a;this.animate(this,a);var b,d,e;CAAT.DEBUG&&this.resetStats();b=0;for(d=this.childrenList.length;b<d;b++){var f=this.childrenList[b];if(f.isInAnimationFrame(this.time)){e=f.time-f.start_time;if(f.onRenderStart)f.onRenderStart(e);f.paintActor(this,e);if(f.onRenderEnd)f.onRenderEnd(e);f.isPaused()||(f.time+=a);CAAT.DEBUG&&(this.statistics.size_total+=f.size_total,this.statistics.size_active+=
f.size_active,this.statistics.size_dirtyRects=this.nDirtyRects)}}this.frameCounter++},CAAT.Director.prototype.addScene=function(a){a.setVisible(!0);a.setBounds(0,0,this.width,this.height);this.scenes.push(a);a.setEaseListener(this);null===this.currentScene&&this.setScene(0);this.domElement.appendChild(a.domElement)},CAAT.Director.prototype.emptyScenes=function(){this.scenes=[];this.domElement.innerHTML="";this.createEventHandler()},CAAT.Director.prototype.setClear=function(){return this},CAAT.Director.prototype.createEventHandler=
function(){this.eventHandler=document.createElement("div");this.domElement.appendChild(this.eventHandler);this.eventHandler.style.position="absolute";this.eventHandler.style.left="0";this.eventHandler.style.top="0";this.eventHandler.style.zIndex=999999;this.eventHandler.style.width=""+this.width+"px";this.eventHandler.style.height=""+this.height+"px";this.canvas=this.eventHandler;this.in_=!1;this.addHandlers(this.canvas)});extend(CAAT.Director,CAAT.ActorContainer,null)})();CAAT.TouchInfo=function(a,c,b,d){this.identifier=a;this.screenPointStart=(new CAAT.Point).set(b.x,b.y);this.point=(new CAAT.Point).set(c.x,c.y);this.screenPoint=(new CAAT.Point).set(b.x,b.y);this.target=d;this.time=(new Date).getTime();this.dragging=!1;return this};
(function(){CAAT.TouchEvent=function(){this.touches=[];this.changedTouches=[];return this};CAAT.TouchEvent.prototype={time:0,source:null,sourceEvent:null,shift:!1,control:!1,alt:!1,meta:!1,touches:null,changedTouches:null,init:function(a,c,b){this.source=c;this.alt=a.altKey;this.control=a.ctrlKey;this.shift=a.shiftKey;this.meta=a.metaKey;this.sourceEvent=a;this.time=b;return this},addTouch:function(a){-1===this.touches.indexOf(a)&&this.touches.push(a);return this},addChangedTouch:function(a){-1===
this.changedTouches.indexOf(a)&&this.changedTouches.push(a);return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}})();
(function(){CAAT.MouseEvent=function(){this.point=new CAAT.Point(0,0,0);this.screenPoint=new CAAT.Point(0,0,0);this.touches=[];return this};CAAT.MouseEvent.prototype={screenPoint:null,point:null,time:0,source:null,shift:!1,control:!1,alt:!1,meta:!1,sourceEvent:null,touches:null,init:function(a,c,b,d,e,f){this.point.set(a,c);this.source=d;this.screenPoint=e;this.alt=b.altKey;this.control=b.ctrlKey;this.shift=b.shiftKey;this.meta=b.metaKey;this.sourceEvent=b;this.x=a;this.y=c;this.time=f;return this},
isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}})();
CAAT.setCoordinateClamping=function(a){a?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)};CAAT.TOUCH_AS_MOUSE=1;
CAAT.TOUCH_AS_MULTITOUCH=2;CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE;CAAT.PMR=64;CAAT.GLRENDER=!1;CAAT.DEBUG=!1;CAAT.DEBUGBB=!1;CAAT.DEBUGBBBCOLOR="#00f";CAAT.DEBUGAABB=!1;CAAT.DEBUGAABBCOLOR="#f00";CAAT.DEBUG_DIRTYRECTS=!1;CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))};CAAT.FRAME_TIME=0;CAAT.GlobalEventsEnabled=!1;CAAT.prevOnDeviceMotion=null;CAAT.onDeviceMotion=null;CAAT.accelerationIncludingGravity={x:0,y:0,z:0};CAAT.rotationRate={alpha:0,beta:0,gamma:0};
CAAT.DRAG_THRESHOLD_X=5;CAAT.DRAG_THRESHOLD_Y=5;CAAT.renderEnabled=!1;CAAT.FPS=60;CAAT.windowResizeListeners=[];CAAT.windowResizeTimer=null;CAAT.registerResizeListener=function(a){CAAT.windowResizeListeners.push(a)};CAAT.unregisterResizeListener=function(a){for(var c=0;c<CAAT.windowResizeListeners.length;c++)if(a===CAAT.windowResizeListeners[c]){CAAT.windowResizeListeners.splice(c,1);break}};CAAT.keyListeners=[];CAAT.registerKeyListener=function(a){CAAT.keyListeners.push(a)};
CAAT.Keys={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,"0":48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,
ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};CAAT.SHIFT_KEY=16;CAAT.CONTROL_KEY=17;CAAT.ALT_KEY=18;CAAT.ENTER_KEY=13;CAAT.KEY_MODIFIERS={alt:!1,control:!1,shift:!1};
CAAT.KeyEvent=function(a,c,b,d){this.keyCode=a;this.action=c;this.modifiers=b;this.sourceEvent=d;this.preventDefault=function(){this.sourceEvent.preventDefault()};this.getKeyCode=function(){return this.keyCode};this.getAction=function(){return this.action};this.modifiers=function(){return this.modifiers};this.isShiftPressed=function(){return this.modifiers.shift};this.isControlPressed=function(){return this.modifiers.control};this.isAltPressed=function(){return this.modifiers.alt};this.getSourceEvent=
function(){return this.sourceEvent}};
CAAT.GlobalEnableEvents=function(){CAAT.GlobalEventsEnabled||(this.GlobalEventsEnabled=!0,window.addEventListener("keydown",function(a){var c=a.which?a.which:a.keyCode;if(c===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!0;else if(c===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!0;else if(c===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!0;else for(var b=0;b<CAAT.keyListeners.length;b++)CAAT.keyListeners[b](new CAAT.KeyEvent(c,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},
a))},!1),window.addEventListener("keyup",function(a){var c=a.which?a.which:a.keyCode;if(c===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!1;else if(c===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!1;else if(c===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!1;else for(var b=0;b<CAAT.keyListeners.length;b++)CAAT.keyListeners[b](new CAAT.KeyEvent(c,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))},!1),window.addEventListener("resize",function(){null!=CAAT.windowResizeTimer&&
clearTimeout(CAAT.windowResizeTimer);CAAT.windowResizeTimer=setTimeout(function(){CAAT.windowResizeTimer=null;for(var a=0;a<CAAT.windowResizeListeners.length;a++)CAAT.windowResizeListeners[a].windowResized(window.innerWidth,window.innerHeight)},500)},!1))};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/CAAT.FPS)}}();
CAAT.SET_INTERVAL=0;CAAT.endLoop=function(){CAAT.NO_RAF?null!==CAAT.INTERVAL_ID&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=!0;CAAT.renderEnabled=!1};CAAT.ENDRAF=!1;CAAT.INTERVAL_ID=null;
CAAT.loop=function(a){if(!CAAT.renderEnabled){for(var c=0,b=CAAT.director.length;c<b;c++)CAAT.director[c].timeline=(new Date).getTime();CAAT.FPS=a||60;CAAT.renderEnabled=!0;CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){var a=(new Date).getTime(),b=CAAT.director[c];(b.renderMode===CAAT.Director.RENDER_MODE_CONTINUOUS||b.needsRepaint)&&b.renderFrame();CAAT.FRAME_TIME=a-CAAT.SET_INTERVAL;CAAT.SET_INTERVAL=a},1E3/CAAT.FPS):CAAT.renderFrame()}};CAAT.currentDirector=null;CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()};
CAAT.FPS_REFRESH=500;CAAT.RAF=0;CAAT.REQUEST_ANIMATION_FRAME_TIME=0;CAAT.renderFrame=function(){if(CAAT.ENDRAF)CAAT.ENDRAF=!1;else{for(var a=(new Date).getTime(),c=0,b=CAAT.director.length;c<b;c++){var d=CAAT.director[c];(d.renderMode===CAAT.Director.RENDER_MODE_CONTINUOUS||d.needsRepaint)&&d.renderFrame()}a=(new Date).getTime()-a;CAAT.FRAME_TIME=a;CAAT.RAF&&(CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF);CAAT.RAF=(new Date).getTime();window.requestAnimFrame(CAAT.renderFrame,0)}};
CAAT.setCursor=function(a){"iOS"!==navigator.browser&&(document.body.style.cursor=a)};CAAT.RegisterDirector=function(a){CAAT.director||(CAAT.director=[]);CAAT.director.push(a);CAAT.GlobalEnableEvents()};
(function(){function a(a){CAAT.rotationRate={alpha:0,beta:a[0],gamma:a[1]}}window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(c){a([c.beta,c.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(c){a([2*c.acceleration.x,2*c.acceleration.y])},!0):window.addEventListener("MozOrientation",function(c){a([45*-c.y,45*c.x])},!0)})();(function(){CAAT.SpriteImageHelper=function(a,c,b,d,e,f){this.x=a;this.y=c;this.width=b;this.height=d;this.setGL(a/e,c/f,(a+b-1)/e,(c+d-1)/f);return this};CAAT.SpriteImageHelper.prototype={x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(a,c,b,d){this.u=a;this.v=c;this.u1=b;this.v1=d;return this}}})();
(function(){CAAT.SpriteImage=function(){this.paint=this.paintN;this.setAnimationImageIndex([0]);this.mapInfo={};return this};CAAT.SpriteImage.prototype={animationImageIndex:null,animationCycle:!0,prevAnimationTime:-1,changeFPS:1E3,transformation:0,spriteIndex:0,TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_TILE:5,TR_TILE_VERTICAL:6,TR_TILE_HORIZONTAL:7,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,
ownerActor:null,mapInfo:null,map:null,setOwner:function(a){this.ownerActor=a;return this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){return this.mapInfo[this.spriteIndex].width},getHeight:function(){return this.mapInfo[this.spriteIndex].height},getRef:function(){var a=new CAAT.SpriteImage;a.image=this.image;a.rows=this.rows;a.columns=this.columns;a.width=this.width;a.height=this.height;a.singleWidth=this.singleWidth;a.singleHeight=this.singleHeight;
a.mapInfo=this.mapInfo;a.offsetX=this.offsetX;a.offsetY=this.offsetY;a.scaleX=this.scaleX;a.scaleY=this.scaleY;return a},setOffsetX:function(a){this.offsetX=a;return this},setOffsetY:function(a){this.offsetY=a;return this},setOffset:function(a,c){this.offsetX=a;this.offsetY=c;return this},initialize:function(a,c,b){this.image=a;this.rows=c;this.columns=b;this.width=a.width;this.height=a.height;this.singleWidth=Math.floor(this.width/b);this.singleHeight=Math.floor(this.height/c);this.mapInfo={};var d,
e,f,g;if(a.__texturePage){a.__du=this.singleWidth/a.__texturePage.width;a.__dv=this.singleHeight/a.__texturePage.height;e=this.singleWidth;f=this.singleHeight;var h=this.columns;a.inverted&&(d=e,e=f,f=d,h=this.rows);var a=this.image.__tx,i=this.image.__ty,j=this.image.__texturePage;for(d=0;d<c*b;d++){g=a+(d%h>>0)*e;var k=i+(d/h>>0)*f,l=g+e,n=k+f;g=(new CAAT.SpriteImageHelper(g,k,l-g,n-k,j.width,j.height)).setGL(g/j.width,k/j.height,l/j.width,n/j.height);this.mapInfo[d]=g}}else for(d=0;d<c*b;d++)e=
(d%this.columns|0)*this.singleWidth,f=(d/this.columns|0)*this.singleHeight,g=new CAAT.SpriteImageHelper(e,f,this.singleWidth,this.singleHeight,a.width,a.height),this.mapInfo[d]=g;return this},paintTiled:function(a,c,b,d){this.setSpriteIndexAtTime(c);var c=this.mapInfo[this.spriteIndex],e=new CAAT.Rectangle;this.ownerActor.AABB.intersect(a.AABB,e);var f=this.getWidth(),g=this.getHeight(),b=(this.offsetX+b)%f;0<b&&(b-=f);b>>=0;d=(this.offsetY+d)%g;0<d&&(d-=g);var d=d>>0,h=(e.width-b)/f,f=h>>0;f<h&&
f++;g=(e.height-d)/g;e=g>>0;e<g&&e++;for(var h=a.ctx,i=b,a=0;a<e;a++){b=i;for(g=0;g<f;g++)h.drawImage(this.image,c.x,c.y,c.width,c.height,b,d,c.width,c.height),b+=c.width;d+=c.height}},paintTiledVerticalStretchedHorizontal:function(a,c,b,d){this.setSpriteIndexAtTime(c);var c=this.mapInfo[this.spriteIndex],e=this.ownerActor.width,f=this.getHeight(),b=this.offsetX+b>>0,d=(this.offsetY+d)%f;0<d&&(d-=f);var d=d>>0,g=(this.ownerActor.height-d)/f,f=g>>0;f<g&&f++;g=a.ctx;for(a=0;a<f;a++)g.drawImage(this.image,
c.x,c.y,c.width,c.height,b,d,e,c.height),d+=c.height},paintStretchedVerticalTiledHorizontal:function(a,c,b,d){this.setSpriteIndexAtTime(c);var c=this.mapInfo[this.spriteIndex],e=this.getWidth(),f=this.ownerActor.height,b=(this.offsetX+b)%e,d=this.offsetY+d>>0;0<b&&(b-=e);var b=b>>0,g=(this.ownerActor.width-b)/e,e=g>>0;e<g&&e++;g=a.ctx;for(a=0;a<e;a++)g.drawImage(this.image,c.x,c.y,c.width,c.height,b,d,c.width,f),b+=c.width},paintInvertedH:function(a,c,b,d){this.setSpriteIndexAtTime(c);c=this.mapInfo[this.spriteIndex];
a=a.ctx;a.save();a.translate((b|0)+c.width,d|0);a.scale(-1,1);a.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX>>0,this.offsetY>>0,c.width,c.height);a.restore();return this},paintInvertedV:function(a,c,b,d){this.setSpriteIndexAtTime(c);c=this.mapInfo[this.spriteIndex];a=a.ctx;a.save();a.translate(b|0,d+c.height|0);a.scale(1,-1);a.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX>>0,this.offsetY>>0,c.width,c.height);a.restore();return this},paintInvertedHV:function(a,c,b,d){this.setSpriteIndexAtTime(c);
c=this.mapInfo[this.spriteIndex];a=a.ctx;a.save();a.translate(b|0,d+c.height|0);a.scale(1,-1);a.translate(c.width,0);a.scale(-1,1);a.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX>>0,this.offsetY>>0,c.width,c.height);a.restore();return this},paintN:function(a,c,b,d){this.setSpriteIndexAtTime(c);c=this.mapInfo[this.spriteIndex];a.ctx.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX+b>>0,this.offsetY+d>>0,c.width,c.height);return this},paintChunk:function(a,c,b,d,e,f,g){a.drawImage(this.image,
d,e,f,g,c,b,f,g)},paintTileChunk:function(a,c,b,d,e,f,g,h,i,j){null==c&&(c=this.spriteIndex);c=this.mapInfo[c];if(null==c)return this;b=Math.max(0,Math.min(1,b));d=Math.max(0,Math.min(1,d));e=Math.max(b,Math.min(1,e));f=Math.max(d,Math.min(1,f));null==i&&(i=c.width*(e-b));null==j&&(j=c.height*(f-d));a.drawImage(this.image,c.x+(c.width*b>>0),c.y+(c.height*d>>0),c.width*e>>0,c.height*f>>0,g>>0,h>>0,i>>0,j>>0);return this},paintTile:function(a,c,b,d){null==c&&(c=this.spriteIndex);c=this.mapInfo[c];if(null==
c)return this;a.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX+b>>0,this.offsetY+d>>0,c.width,c.height);return this},paintScaled:function(a,c,b,d){this.setSpriteIndexAtTime(c);c=this.mapInfo[this.spriteIndex];a.ctx.drawImage(this.image,c.x,c.y,c.width,c.height,this.offsetX+b>>0,this.offsetY+d>>0,this.ownerActor.width,this.ownerActor.height);return this},getCurrentSpriteImageCSSPosition:function(){var a=this.mapInfo[this.spriteIndex],c=-(a.x-this.offsetX),a=-(a.y-this.offsetY),b=this.ownerActor.transformation,
d="no repeat";b===this.TR_TILE?d="repeat":b===this.TR_TILE_VERTICAL?d="repeat-y":b===this.TR_TILE_HORIZONTAL&&(d="repeat-x");return""+c+"px "+a+"px "+d},getNumImages:function(){return this.rows*this.columns},setUV:function(a,c){var b=this.image;if(b.__texturePage){var d=c,e=this.mapInfo[this.spriteIndex],f=e.u,g=e.v,h=e.u1,e=e.v1;if(this.offsetX||this.offsetY)f=b.__texturePage,g=-this.offsetY/f.height,h=(this.ownerActor.width-this.offsetX)/f.width,e=(this.ownerActor.height-this.offsetY)/f.height,
f=-this.offsetX/f.width+b.__u,g+=b.__v,h+=b.__u,e+=b.__v;b.inverted?(a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e,a[d++]=f,a[d++]=g):(a[d++]=f,a[d++]=g,a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e)}},setChangeFPS:function(a){this.changeFPS=a;return this},setSpriteTransformation:function(a){this.transformation=a;switch(a){case this.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case this.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case this.TR_FLIP_ALL:this.paint=
this.paintInvertedHV;break;case this.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case this.TR_TILE:this.paint=this.paintTiled;break;case this.TR_TILE_VERTICAL:this.paint=this.paintTiledVerticalStretchedHorizontal;break;case this.TR_TILE_HORIZONTAL:this.paint=this.paintStretchedVerticalTiledHorizontal;break;default:this.paint=this.paintN}return this},resetAnimationTime:function(){this.prevAnimationTime=-1;return this},setAnimationImageIndex:function(a,c){this.animationImageIndex=a;this.animationCycle=
null!=c?c:!0;this.spriteIndex=a[0];this.prevAnimationTime=-1;return this},setSpriteIndex:function(a){this.spriteIndex=a;return this},setSpriteIndexAtTime:function(a){1<this.animationImageIndex.length&&(-1===this.prevAnimationTime?(this.prevAnimationTime=a,this.spriteIndex=this.animationImageIndex[0]):(a-=this.prevAnimationTime,a/=this.changeFPS,a=this.animationCycle?a%this.animationImageIndex.length:Math.min(a,this.animationImageIndex.length-1),this.spriteIndex=this.animationImageIndex[Math.floor(a)]))},
getMapInfo:function(a){return this.mapInfo[a]},initializeFromMap:function(a,c){this.initialize(a,1,1);var b,d,e=0;for(b in c)d=c[b],d=new CAAT.SpriteImageHelper(d.x,d.y,d.width,d.height,a.width,a.height),this.mapInfo[b]=d,e||this.setAnimationImageIndex([b]),e++;return this},initializeAsGlyphDesigner:function(a,c){this.initialize(a,1,1);var b,d,e=0;for(b in c){var f=c[b];d=new CAAT.SpriteImageHelper(f.x,f.y,f.width,f.height,a.width,a.height);d.xoffset="undefined"===typeof f.xoffset?0:f.xoffset;d.yoffset=
"undefined"===typeof f.yoffset?0:f.yoffset;d.xadvance="undefined"===typeof f.xadvance?f.width:f.xadvance;this.mapInfo[b]=d;e||this.setAnimationImageIndex([b]);e++}return this},initializeAsFontMap:function(a,c){this.initialize(a,1,1);for(var b,d=0,e=0;e<c.length;e++){var f=c[e];b=new CAAT.SpriteImageHelper(d,0,f.width,a.height,a.width,a.height);b.xoffset=0;b.yoffset=0;b.xadvance=f.width;d+=f.width;this.mapInfo[c[e].c]=b;e||this.setAnimationImageIndex([c[e].c])}return this},initializeAsMonoTypeFontMap:function(a,
c){for(var b=[],d=c.split(""),e=a.width/d.length>>0,f=0;f<d.length;f++)b.push({c:d[f],width:e});return this.initializeAsFontMap(a,b)},stringWidth:function(a){var c,b,d=0,e;c=0;for(b=a.length;c<b;c++)(e=this.mapInfo[a.charAt(c)])&&(d+=e.xadvance);return d},stringHeight:function(){if(this.fontHeight)return this.fontHeight;var a=0,c;for(c in this.mapInfo){var b=this.mapInfo[c],b=b.height+b.yoffset;b>a&&(a=b)}return this.fontHeight=a},drawString:function(a,c,b,d){for(var e,f,g=c.split(""),c=0;c<g.length;c++)if(e=
this.mapInfo[g[c]])f=e.width,a.drawImage(this.image,e.x,e.y,f,e.height,b+e.xoffset,d+e.yoffset,f,e.height),b+=e.xadvance}}})();(function(){CAAT.ImagePreloader=function(){this.images=[];return this};CAAT.ImagePreloader.prototype={images:null,notificationCallback:null,imageCounter:0,loadImages:function(a,c,b){if(a){var d=this,e;this.notificationCallback=c;this.images=[];for(e=0;e<a.length;e++)this.images.push({id:a[e].id,image:new Image});for(e=0;e<a.length;e++)this.images[e].image.onload=function(){d.imageCounter++;d.notificationCallback(d.imageCounter,d.images)},this.images[e].image.onerror=function(a){return function(c){b&&
b(c,a)}}(e),this.images[e].image.src=a[e].url;0===a.length&&c(0,[])}else c&&c(0,[])}}})();(function(){CAAT.TimerTask=function(){return this};CAAT.TimerTask.prototype={startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,scene:null,taskId:0,remove:!1,create:function(a,c,b,d,e){this.startTime=a;this.duration=c;this.callback_timeout=b;this.callback_tick=d;this.callback_cancel=e;return this},checkTask:function(a){var c;c=a-this.startTime;c>=this.duration?(this.remove=!0,this.callback_timeout&&this.callback_timeout(a,c,this)):this.callback_tick&&this.callback_tick(a,
c,this);return this},reset:function(a){this.remove=!1;this.startTime=a;this.scene.ensureTimerTask(this);return this},cancel:function(){this.remove=!0;null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this);return this}}})();(function(){CAAT.Scene=function(){CAAT.Scene.superclass.constructor.call(this);this.timerList=[];this.fillStyle=null;return this};CAAT.Scene.prototype={easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:!1,EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3,EASE_STATIONARY:4,timerList:null,timerSequence:0,paused:!1,isPaused:function(){return this.paused},setPaused:function(a){this.paused=a},checkTimers:function(a){for(var c=this.timerList,b=c.length-1;0<=b;)c[b].remove||c[b].checkTask(a),
b--},ensureTimerTask:function(a){this.hasTimer(a)||this.timerList.push(a);return this},hasTimer:function(a){for(var c=this.timerList,b=c.length-1;0<=b;){if(c[b]===a)return!0;b--}return!1},createTimer:function(a,c,b,d,e){a=(new CAAT.TimerTask).create(a,c,b,d,e);a.taskId=this.timerSequence++;a.sceneTime=this.time;a.scene=this;this.timerList.push(a);return a},removeExpiredTimers:function(){var a,c=this.timerList;for(a=0;a<c.length;a++)c[a].remove&&c.splice(a,1)},animate:function(a,c){this.checkTimers(c);
CAAT.Scene.superclass.animate.call(this,a,c);this.removeExpiredTimers()},getScene:function(){return this},createAlphaBehaviour:function(a,c){var b=new CAAT.AlphaBehavior;b.setDelayTime(0,a);b.startAlpha=c?0:1;b.endAlpha=c?1:0;this.easeContainerBehaviour.addBehavior(b)},easeTranslationIn:function(a,c,b,d){this.easeTranslation(a,c,b,!0,d)},easeTranslationOut:function(a,c,b,d){this.easeTranslation(a,c,b,!1,d)},easeTranslation:function(a,c,b,d,e){this.easeContainerBehaviour&&this.easeContainerBehaviour.emptyListenerList();
this.easeContainerBehaviour=new CAAT.ContainerBehavior;this.easeIn=d;var f=new CAAT.PathBehavior;e&&f.setInterpolator(e);f.setDelayTime(0,a);1>b?b=1:4<b&&(b=4);switch(b){case CAAT.Actor.prototype.ANCHOR_TOP:d?f.setPath((new CAAT.Path).setLinear(0,-this.height,0,0)):f.setPath((new CAAT.Path).setLinear(0,0,0,-this.height));break;case CAAT.Actor.prototype.ANCHOR_BOTTOM:d?f.setPath((new CAAT.Path).setLinear(0,this.height,0,0)):f.setPath((new CAAT.Path).setLinear(0,0,0,this.height));break;case CAAT.Actor.prototype.ANCHOR_LEFT:d?
f.setPath((new CAAT.Path).setLinear(-this.width,0,0,0)):f.setPath((new CAAT.Path).setLinear(0,0,-this.width,0));break;case CAAT.Actor.prototype.ANCHOR_RIGHT:d?f.setPath((new CAAT.Path).setLinear(this.width,0,0,0)):f.setPath((new CAAT.Path).setLinear(0,0,this.width,0))}c&&this.createAlphaBehaviour(a,d);this.easeContainerBehaviour.addBehavior(f);this.easeContainerBehaviour.setDelayTime(0,a);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,
this.easeContainerBehaviour)},easeStationary:function(a,c,b){this.easeContainerBehaviour&&this.easeContainerBehaviour.emptyListenerList();this.easeContainerBehaviour=new CAAT.ContainerBehavior;this.easeIn=b;c&&this.createAlphaBehaviour(a,b);this.easeContainerBehaviour.setDelayTime(0,a);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(a,c,b,d,e){this.easeScale(a,c,b,d,!0,e);this.easeIn=
!0},easeScaleOut:function(a,c,b,d,e){this.easeScale(a,c,b,d,!1,e);this.easeIn=!1},easeScale:function(a,c,b,d,e,f){this.easeContainerBehaviour&&this.easeContainerBehaviour.emptyListenerList();this.easeContainerBehaviour=new CAAT.ContainerBehavior;var g=0,h=0,i=0,j=0;switch(d){case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:case CAAT.Actor.prototype.ANCHOR_CENTER:j=i=1;break;
case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:i=g=1;h=0;j=1;break;case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:j=h=1;g=0;i=1;break;default:alert("scale anchor ?? "+d)}if(!e){var k;k=g;g=i;i=k;k=h;h=j;j=k}b&&this.createAlphaBehaviour(c,e);b=this.getAnchorPercent(d);a=(new CAAT.ScaleBehavior).setDelayTime(a,c).setValues(g,i,h,j,b.x,b.y);f&&a.setInterpolator(f);this.easeContainerBehaviour.addBehavior(a);this.easeContainerBehaviour.setDelayTime(0,
c);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(){return this},easeRotationIn:function(a,c,b,d){this.easeRotation(a,c,b,!0,d);this.easeIn=!0},easeRotationOut:function(a,c,b,d){this.easeRotation(a,c,b,!1,d);this.easeIn=!1},easeRotation:function(a,c,b,d,e){this.easeContainerBehaviour&&this.easeContainerBehaviour.emptyListenerList();this.easeContainerBehaviour=new CAAT.ContainerBehavior;
var f=0,g=0;b==CAAT.Actor.prototype.ANCHOR_CENTER&&(b=CAAT.Actor.prototype.ANCHOR_TOP);switch(b){case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:f=Math.PI*(0.5>Math.random()?1:-1);break;case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:f=Math.PI/2*(0.5>Math.random()?1:
-1);break;default:alert("rot anchor ?? "+b)}if(!1===d)var h=f,f=g,g=h;c&&this.createAlphaBehaviour(a,d);c=this.getAnchorPercent(b);f=(new CAAT.RotateBehavior).setDelayTime(0,a).setValues(f,g,c.x,c.y);e&&f.setInterpolator(e);this.easeContainerBehaviour.addBehavior(f);this.easeContainerBehaviour.setDelayTime(this.time,a);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(a){this.easeContainerBehaviourListener=
a},behaviorExpired:function(){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(a){this.expired=a},paint:function(a){this.fillStyle&&(a=a.crc,a.fillStyle=this.fillStyle,a.fillRect(0,0,this.width,this.height))},findActorAtPosition:function(a){var c,b,d=new CAAT.Point;if(this.inputList){var e=this.inputList;for(c=0;c<e.length;c++){var f=e[c];for(b=0;b<f.length;b++){d.set(a.x,a.y);var g=f[b].findActorAtPosition(d);if(null!=g)return g}}}d.set(a.x,
a.y);return CAAT.Scene.superclass.findActorAtPosition.call(this,d)},enableInputList:function(a){this.inputList=[];for(var c=0;c<a;c++)this.inputList.push([]);return this},addActorToInputList:function(a,c,b){0>c?c=0:c>=this.inputList.length&&(c=this.inputList.length-1);c=this.inputList[c];"undefined"===typeof b||b>=c.length?c.push(a):0>=b?c.unshift(a):c.splice(b,0,a);return this},emptyInputList:function(a){0>a?a=0:a>=this.inputList.length&&(a=this.inputList.length-1);this.inputList[a]=[];return this},
removeActorFromInputList:function(a,c){if("undefined"===typeof c){var b,d;for(b=0;b<this.inputList.length;b++){var e=this.inputList[b];for(d=0;d<e.length;d++)e[d]==a&&e.splice(d,1)}return this}0>c?c=0:c>=this.inputList.length&&(c=this.inputList.length-1);e=this.inputList[c];for(d=0;d<e.length;d++)e[d]==a&&e.splice(d,1);return this}};extend(CAAT.Scene,CAAT.ActorContainer)})();CAAT.modules=CAAT.modules||{};CAAT.modules.CircleManager=CAAT.modules.CircleManager||{};(function(){CAAT.modules.LayoutUtils={};CAAT.modules.LayoutUtils.row=function(a,c,b){for(var d=a.width,e=0,f=0,g=0,h=0,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,g=c.length-1;g;g-=1)if(i<c[g].width&&(i=c[g].width),h<c[g].height)h=c[g].height;b.padding_left&&(e=b.padding_left,d-=e);b.padding_right&&(d-=b.padding_right);if(b.top&&(f=parseInt(b.top,10),isNaN(f)))switch(b.top){case "center":f=(a.height-h)/2;break;case "top":f=0;break;case "bottom":f=a.height-h;break;default:f=0}a=d/c.length;g=0;for(h=c.length;g<
h;g++)c[g].setPosition(e+g*a+(a-c[g].width)/2,f)}})();(function(){CAAT.modules.CircleManager.PackedCircle=function(){this.boundsRule=CAAT.modules.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE;this.position=new CAAT.Point(0,0,0);this.offset=new CAAT.Point(0,0,0);this.targetPosition=new CAAT.Point(0,0,0);return this};CAAT.modules.CircleManager.PackedCircle.prototype={id:0,delegate:null,position:new CAAT.Point(0,0,0),offset:new CAAT.Point(0,0,0),targetPosition:null,targetChaseSpeed:0.02,isFixed:!1,boundsRule:0,collisionMask:0,collisionGroup:0,BOUNDS_RULE_WRAP:1,
BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8,containsPoint:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},getDistanceSquaredFromPosition:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},intersects:function(a){var c=this.position.getDistanceSquared(a.position);return c<this.radiusSquared||c<a.radiusSquared},setPosition:function(a){this.position=a;return this},setDelegate:function(a){this.delegate=a;return this},setOffset:function(a){this.offset=
a;return this},setTargetPosition:function(a){this.targetPosition=a;return this},setTargetChaseSpeed:function(a){this.targetChaseSpeed=a;return this},setIsFixed:function(a){this.isFixed=a;return this},setCollisionMask:function(a){this.collisionMask=a;return this},setCollisionGroup:function(a){this.collisionGroup=a;return this},setRadius:function(a){this.radius=a;this.radiusSquared=this.radius*this.radius;return this},initialize:function(a){if(a)for(var c in a)this[c]=a[c];return this},dealloc:function(){this.targetPosition=
this.delegate=this.offset=this.position=null}}})();(function(){CAAT.modules.CircleManager.PackedCircleManager=function(){return this};CAAT.modules.CircleManager.PackedCircleManager.prototype={allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:new CAAT.Rectangle,addCircle:function(a){a.id=this.allCircles.length;this.allCircles.push(a);return this},removeCircle:function(a){var c=0,b=!1,d=this.allCircles.length;if(0===d)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";for(;d--;)if(this.allCircles[d]===
a){b=!0;c=d;break}if(!b)throw"Could not locate circle in allCircles array!";this.allCircles[c].dealloc();this.allCircles[c]=null;return this},forceCirclesToMatchDelegatePositions:function(){for(var a=this.allCircles.length,c=0;c<a;c++){var b=this.allCircles[c];b&&b.delegate&&b.position.set(b.delegate.x+b.offset.x,b.delegate.y+b.offset.y)}},pushAllCirclesTowardTarget:function(){for(var a=new CAAT.Point(0,0,0),c=this.allCircles,b=c.length,d=0;d<this.numberOfTargetingPasses;d++)for(var e=0;e<b;e++){var f=
c[e];f.isFixed||(a.x=f.position.x-(f.targetPosition.x+f.offset.x),a.y=f.position.y-(f.targetPosition.y+f.offset.y),a.multiply(f.targetChaseSpeed),f.position.x-=a.x,f.position.y-=a.y)}},handleCollisions:function(){this.removeExpiredElements();for(var a=new CAAT.Point(0,0,0),c=this.allCircles,b=c.length,d=0;d<this.numberOfCollisionPasses;d++)for(var e=0;e<b;e++)for(var f=c[e],g=e+1;g<b;g++){var h=c[g];if(this.circlesCanCollide(f,h)){var i=h.position.x-f.position.x,j=h.position.y-f.position.y,k=1.08*
(f.radius+h.radius),l=f.position.getDistanceSquared(h.position);if(l<k*k-0.02&&(a.x=i,a.y=j,a.normalize(),i=0.5*(k-Math.sqrt(l)),a.multiply(i),h.isFixed||(f.isFixed&&a.multiply(2.2),h.position.translatePoint(a)),!f.isFixed))h.isFixed&&a.multiply(2.2),f.position.subtract(a)}}},handleBoundaryForCircle:function(a,c){var b=a.position.x,d=a.position.y,e=a.radius,f=2*e,c=12;c&1&&b-f>this.bounds.right?a.position.x=this.bounds.left+e:c&1&&b+f<this.bounds.left&&(a.position.x=this.bounds.right-e);c&4&&d-f>
this.bounds.bottom?a.position.y=this.bounds.top-e:c&4&&d+f<this.bounds.top&&(a.position.y=this.bounds.bottom+e);c&8&&b+e>=this.bounds.right?a.position.x=a.position.x=this.bounds.right-e:c&8&&b-e<this.bounds.left&&(a.position.x=this.bounds.left+e);c&16&&d+e>this.bounds.bottom?a.position.y=this.bounds.bottom-e:c&16&&d-e<this.bounds.top&&(a.position.y=this.bounds.top+e)},getCircleAt:function(a,c,b){for(var d=this.allCircles,e=d.length,a=new CAAT.Point(a,c,0),c=null,f=Number.MAX_VALUE,g=0;g<e;g++){var h=
d[g];if(h){var i=h.position.getDistanceSquared(a);i<f&&i<h.radiusSquared+b&&(f=i,c=h)}}return c},circlesCanCollide:function(a,c){return!a||!c||a===c?!1:!0},setBounds:function(a,c,b,d){this.bounds.x=a;this.bounds.y=c;this.bounds.width=b;this.bounds.height=d},setNumberOfCollisionPasses:function(a){this.numberOfCollisionPasses=a;return this},setNumberOfTargetingPasses:function(a){this.numberOfTargetingPasses=a;return this},sortOnDistanceToTarget:function(a,c){var b=a.getDistanceSquaredFromPosition(a.targetPosition),
d=c.getDistanceSquaredFromPosition(a.targetPosition),e=0;b>d?e=-1:b<d&&(e=1);return e},removeExpiredElements:function(){for(var a=this.allCircles.length;0<=a;a--)null===this.allCircles[a]&&this.allCircles.splice(a,1)},initialize:function(a){if(a)for(var c in a)this[c]=a[c];return this}}})();(function(){CAAT.modules.LocalStorage=function(){return this};CAAT.modules.LocalStorage.prototype={save:function(a,c){try{localStorage.setItem(a,JSON.stringify(c))}catch(b){}return this},load:function(a){try{return JSON.parse(localStorage.getItem(a))}catch(c){return null}},remove:function(a){try{localStorage.removeItem(a)}catch(c){}return this}}})();(function(){CAAT.modules.ImageUtil={};CAAT.modules.ImageUtil.createAlphaSpriteSheet=function(a,c,b,d,e){if(a<c)var f=a,a=c,c=f;f=document.createElement("canvas");f.width=d.width;f.height=d.height*b;var g=f.getContext("2d");g.fillStyle=e?e:"rgba(255,255,255,0)";g.fillRect(0,0,d.width,d.height*b);for(e=0;e<b;e++)g.globalAlpha=1-(a-c)/b*(e+1),g.drawImage(d,0,e*d.height);return f};CAAT.modules.ImageUtil.rotate=function(a,c){c=c||0;if(!c)return a;var b=document.createElement("canvas");b.width=a.height;
b.height=a.width;var d=b.getContext("2d");d.globalAlpha=1;d.fillStyle="rgba(0,0,0,0)";d.clearRect(0,0,b.width,b.height);var e=new CAAT.Matrix;e.multiply((new CAAT.Matrix).setTranslate(b.width/2,b.width/2));e.multiply((new CAAT.Matrix).setRotation(c*Math.PI/180));e.multiply((new CAAT.Matrix).setTranslate(-b.width/2,-b.width/2));e.transformRenderingContext(d);d.drawImage(a,0,0);return b};CAAT.modules.ImageUtil.optimize=function(a,c,b){var c=c>>0,d=!0,e=!0,f=!0,g=!0;if("undefined"!==typeof b&&("undefined"!==
typeof b.top&&(d=b.top),"undefined"!==typeof b.bottom&&(e=b.bottom),"undefined"!==typeof b.left&&(f=b.left),"undefined"!==typeof b.right))g=b.right;b=document.createElement("canvas");b.width=a.width;b.height=a.height;var h=b.getContext("2d");h.fillStyle="rgba(0,0,0,0)";h.fillRect(0,0,a.width,a.height);h.drawImage(a,0,0);var i=h.getImageData(0,0,a.width,a.height).data,j,a=0,k=b.height-1,l=0,n=b.width-1,m=!1;if(d){for(d=0;d<b.height;d++){for(j=0;j<b.width;j++)if(i[4*d*b.width+3+4*j]>c){m=!0;break}if(m)break}a=
d}if(e){m=!1;for(d=b.height-1;d>=a;d--){for(j=0;j<b.width;j++)if(i[4*d*b.width+3+4*j]>c){m=!0;break}if(m)break}k=d}if(f){m=!1;for(j=0;j<b.width;j++){for(d=a;d<=k;d++)if(i[4*d*b.width+3+4*j]>c){m=!0;break}if(m)break}l=j}if(g){m=!1;for(j=b.width-1;j>=l;j--){for(d=a;d<=k;d++)if(i[4*d*b.width+3+4*j]>c){m=!0;break}if(m)break}n=j}if(0===l&&0===a&&b.width-1===n&&b.height-1===k)return b;c=n-l+1;e=k-a+1;f=h.getImageData(l,a,c,e);b.width=c;b.height=e;h=b.getContext("2d");h.putImageData(f,0,0);return b};CAAT.modules.ImageUtil.createThumb=
function(a,c,b,d){var c=c||24,b=b||24,e=document.createElement("canvas");e.width=c;e.height=b;var f=e.getContext("2d");if(d){var g=Math.max(a.width,a.height),d=a.width/g*c,g=a.height/g*b;f.drawImage(a,(c-d)/2,(b-g)/2,d,g)}else f.drawImage(a,0,0,c,b);return e}})();(function(){CAAT.Font=function(){return this};CAAT.Font.prototype={fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,padding:0,image:null,charMap:null,height:0,setPadding:function(a){this.padding=a;return this},setFontStyle:function(a){this.fontStyle=a;return this},setFontSize:function(a){this.fontSize=a;this.fontSizeUnit="px";return this},setFont:function(a){this.font=a;return this},setFillStyle:function(a){this.fillStyle=a;return this},setStrokeStyle:function(a){this.strokeStyle=
a;return this},createDefault:function(a){for(var c="",b=32;128>b;b++)c+=String.fromCharCode(b);return this.create(c,a)},create:function(a,c){this.padding=c|=0;var b=document.createElement("canvas");b.width=1;b.height=1;var d=b.getContext("2d");d.textBaseline="top";d.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var e=0,f=[],g,h;for(g=0;g<a.length;g++)h=Math.max(1,(d.measureText(a.charAt(g)).width>>0)+1)+2*c,f.push(h),e+=h;b.width=e;b.height=1.5*this.fontSize>>0;d=b.getContext("2d");
d.textBaseline="top";d.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;d.fillStyle=this.fillStyle;d.strokeStyle=this.strokeStyle;this.charMap={};for(g=e=0;g<a.length;g++)h=a.charAt(g),d.fillText(h,e+c,0),this.strokeStyle&&(d.beginPath(),d.strokeText(h,e+c,0)),this.charMap[h]={x:e,width:f[g]},e+=f[g];this.image=CAAT.modules.ImageUtil.optimize(b,32,{top:!0,bottom:!0,left:!1,right:!1});this.height=this.image.height;return this},setAsSpriteImage:function(){var a=[],c=0,b;for(b in this.charMap){var d=
b,e=this.charMap[b];a[b]={id:c++,height:this.height,xoffset:0,letter:d,yoffset:0,width:e.width,xadvance:e.width,x:e.x,y:0}}return(new CAAT.SpriteImage).initializeAsGlyphDesigner(this.image,a)},stringWidth:function(a){var c,b,d=0,e;c=0;for(b=a.length;c<b;c++)d=(e=this.charMap[a.charAt(c)])?d+e.width:d+10;return d},drawText:function(a,c,b,d){var e,f,g,h,i=this.image.height;e=0;for(f=a.length;e<f;e++)(g=this.charMap[a.charAt(e)])?(h=g.width,c.drawImage(this.image,g.x,0,h,i,b,d,h,i),b+=h):(c.strokeStyle=
"#f00",c.strokeRect(b,d,10,i),b+=10)},save:function(){var a=this.image.toDataURL("image/png");document.location.href=a.replace("image/png","image/octet-stream")}}})();(function(){CAAT.InterpolatorActor=function(){CAAT.InterpolatorActor.superclass.constructor.call(this);return this};CAAT.InterpolatorActor.prototype={interpolator:null,contour:null,S:50,gap:5,setGap:function(a){this.gap=a;return this},setInterpolator:function(a,c){this.interpolator=a;this.contour=a.getContour(c||this.S);return this},paint:function(a,c){CAAT.InterpolatorActor.superclass.paint.call(this,a,c);if(this.backgroundImage)return this;if(this.interpolator){var b=a.crc,d=this.width-2*this.gap,
e=this.height-2*this.gap;b.beginPath();b.moveTo(this.gap+d*this.contour[0].x,-this.gap+this.height-e*this.contour[0].y);for(var f=1;f<this.contour.length;f++)b.lineTo(this.gap+d*this.contour[f].x,-this.gap+this.height-e*this.contour[f].y);b.strokeStyle=this.strokeStyle;b.stroke()}},getInterpolator:function(){return this.interpolator}};extend(CAAT.InterpolatorActor,CAAT.ActorContainer,null)})();(function(){CAAT.PathSegment=function(){this.bbox=new CAAT.Rectangle;return this};CAAT.PathSegment.prototype={color:"#000",length:0,bbox:null,parent:null,setParent:function(a){this.parent=a;return this},setColor:function(a){a&&(this.color=a);return this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(){},setPoint:function(){},getPosition:function(){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},
getControlPoint:function(){},endPath:function(){},getContour:function(){},updatePath:function(){},applyAsPath:function(){},transform:function(){},drawHandle:function(a,c,b){a.beginPath();a.arc(c,b,CAAT.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,!1);a.fill()}}})();
(function(){CAAT.LinearPath=function(){CAAT.LinearPath.superclass.constructor.call(this);this.points=[];this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.newPosition=new CAAT.Point(0,0,0);return this};CAAT.LinearPath.prototype={points:null,newPosition:null,applyAsPath:function(a){a.ctx.lineTo(this.points[0].x,this.points[1].y)},setPoint:function(a,c){0===c?this.points[0]=a:1===c&&(this.points[1]=a)},updatePath:function(){var a=this.points[1].x-this.points[0].x,c=this.points[1].y-
this.points[0].y;this.length=Math.sqrt(a*a+c*c);this.bbox.setEmpty();this.bbox.union(this.points[0].x,this.points[0].y);this.bbox.union(this.points[1].x,this.points[1].y);return this},setPoints:function(a){this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setInitialPosition:function(a,c){this.points[0].x=a;this.points[0].y=c;this.newPosition.set(a,c);return this},setFinalPosition:function(a,c){this.points[1].x=a;this.points[1].y=c;return this},endCurvePosition:function(){return this.points[1]},
startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(1<a||0>a)a%=1;0>a&&(a=1+a);this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*a,this.points[0].y+(this.points[1].y-this.points[0].y)*a);return this.newPosition},getPositionFromLength:function(a){return this.getPosition(a/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(a,c){var b=a.ctx;b.save();b.strokeStyle=this.color;
b.beginPath();b.moveTo(this.points[0].x,this.points[0].y);b.lineTo(this.points[1].x,this.points[1].y);b.stroke();c&&(b.globalAlpha=0.5,b.fillStyle="#7f7f00",b.beginPath(),this.drawHandle(b,this.points[0].x,this.points[0].y),this.drawHandle(b,this.points[1].x,this.points[1].y));b.restore()},numControlPoints:function(){return 2},getControlPoint:function(a){if(0===a)return this.points[0];if(1===a)return this.points[1]},getContour:function(){var a=[];a.push(this.getPosition(0).clone());a.push(this.getPosition(1).clone());
return a}};extend(CAAT.LinearPath,CAAT.PathSegment)})();
(function(){CAAT.CurvePath=function(){CAAT.CurvePath.superclass.constructor.call(this);this.newPosition=new CAAT.Point(0,0,0);return this};CAAT.CurvePath.prototype={curve:null,newPosition:null,applyAsPath:function(a){this.curve.applyAsPath(a);return this},setPoint:function(a,c){this.curve&&this.curve.setPoint(a,c)},setPoints:function(a){var c=new CAAT.Bezier;c.setPoints(a);this.curve=c;return this},setQuadric:function(a,c,b,d,e,f){var g=new CAAT.Bezier;g.setQuadric(a,c,b,d,e,f);this.curve=g;this.updatePath();
return this},setCubic:function(a,c,b,d,e,f,g,h){var i=new CAAT.Bezier;i.setCubic(a,c,b,d,e,f,g,h);this.curve=i;this.updatePath();return this},updatePath:function(){this.curve.update();this.length=this.curve.getLength();this.curve.getBoundingBox(this.bbox);return this},getPosition:function(a){if(1<a||0>a)a%=1;0>a&&(a=1+a);this.curve.solve(this.newPosition,a);return this.newPosition},getPositionFromLength:function(a){this.curve.solve(this.newPosition,a/this.length);return this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},
finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(a,c){this.curve.drawHandles=c;a.ctx.strokeStyle=this.color;this.curve.paint(a,c)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(a){return this.curve.coordlist[a]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(a){for(var c=[],b=0;b<=a;b++)c.push({x:b/
a,y:this.getPosition(b/a).y});return c}};extend(CAAT.CurvePath,CAAT.PathSegment,null)})();
(function(){CAAT.ArcPath=function(){CAAT.ArcPath.superclass.constructor.call(this);this.points=[];this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.newPosition=new CAAT.Point;return this};CAAT.ArcPath.prototype={points:null,length:-1,cw:!0,bbox:null,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:!1,setRadius:function(a){this.radius=a},isArcTo:function(){return this.arcTo},setArcTo:function(a){this.arcTo=a;return this},initialize:function(a,c,b,d){this.setInitialPosition(a,
c);this.setFinalPosition(a+b,c);this.angle=d||2*Math.PI;return this},applyAsPath:function(a){a=a.ctx;this.arcTo?a.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):a.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw);return this},setPoint:function(a,c){0<=c&&c<this.points.length&&(this.points[c]=a)},setPoints:function(a){this.points=[];this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setClockWise:function(a){this.cw=
void 0!==a?a:!0;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,c){for(var b=0,d=this.points.length;b<d;b++)this.points[0].x=a,this.points[0].y=c;return this},setFinalPosition:function(a,c){this.points[1].x=a;this.points[1].y=c;this.updatePath(this.points[1]);return this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(1<a||0>a)a%=1;0>a&&(a=1+a);-1===this.length?this.newPosition.set(this.points[0].x,
this.points[0].y):(a=this.angle*a*(this.cw?1:-1)+this.startAngle,this.newPosition.set(this.points[0].x+this.radius*Math.cos(a),this.points[0].y+this.radius*Math.sin(a)));return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(a,c){var b=a.ctx;b.save();b.strokeStyle=this.color;b.beginPath();this.arcTo?b.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):b.arc(this.points[0].x,
this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw);b.stroke();if(c){b.globalAlpha=0.5;b.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(b,this.points[d].x,this.points[d].y)}b.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(a){for(var c=[],b=0;b<a;b++)c.push({x:this.points[0].x+this.radius*Math.cos(b*Math.PI/(a/2)),y:this.points[0].y+this.radius*Math.sin(b*
Math.PI/(a/2))});return c},getPositionFromLength:function(a){return this.getPosition(a/this.length*(this.cw?1:-1))},updatePath:function(a){this.points[1]===a?(this.arcTo||(this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))),this.length=this.angle*this.radius,this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)):this.points[0]===a&&this.points[1].set(this.points[0].x+
this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle));this.bbox.setEmpty();this.bbox.x=this.points[0].x-this.radius;this.bbox.y=this.points[0].y-this.radius;this.bbox.x1=this.points[0].x+this.radius;this.bbox.y1=this.points[0].y+this.radius;this.bbox.width=2*this.radius;this.bbox.height=2*this.radius;return this}};extend(CAAT.ArcPath,CAAT.PathSegment)})();
(function(){CAAT.RectPath=function(){CAAT.RectPath.superclass.constructor.call(this);this.points=[];this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.newPosition=new CAAT.Point;this.lengths=[0,0,0,0];return this};CAAT.RectPath.prototype={points:null,length:-1,cw:!0,bbox:null,newPosition:null,applyAsPath:function(a){a=a.ctx;this.cw?(a.lineTo(this.points[0].x,this.points[0].y),a.lineTo(this.points[1].x,
this.points[1].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[4].x,this.points[4].y)):(a.lineTo(this.points[4].x,this.points[4].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[1].x,this.points[1].y),a.lineTo(this.points[0].x,this.points[0].y));return this},setPoint:function(a,c){0<=c&&c<this.points.length&&(this.points[c]=a)},setPoints:function(a){this.points=[];this.points.push(a[0]);
this.points.push((new CAAT.Point).set(a[1].x,a[0].y));this.points.push(a[1]);this.points.push((new CAAT.Point).set(a[0].x,a[1].y));this.points.push(a[0].clone());this.updatePath();return this},setClockWise:function(a){this.cw=void 0!==a?a:!0;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,c){for(var b=0,d=this.points.length;b<d;b++)this.points[b].x=a,this.points[b].y=c;return this},setFinalPosition:function(a,c){this.points[2].x=a;this.points[2].y=c;this.points[1].x=
a;this.points[1].y=this.points[0].y;this.points[3].x=this.points[0].x;this.points[3].y=c;this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y;this.updatePath();return this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(1<a||0>a)a%=1;0>a&&(a=1+a);if(-1===this.length)this.newPosition.set(0,0);else{var c=this.bbox.width/this.length,b=this.bbox.height/this.length,d=0,e,f=0;this.cw?(e=[0,1,2,3,4],c=[c,b,
c,b]):(e=[4,3,2,1,0],c=[b,c,b,c]);for(;f<c.length;)if(d+c[f]<a)d+=c[f],f++;else break;a-=d;d=e[f];e=e[f+1];this.newPosition.set(this.points[d].x+(this.points[e].x-this.points[d].x)*a/c[f],this.points[d].y+(this.points[e].y-this.points[d].y)*a/c[f])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(a,c){var b=a.ctx;b.save();b.strokeStyle=this.color;b.beginPath();b.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,
this.bbox.height);if(c){b.globalAlpha=0.5;b.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(b,this.points[d].x,this.points[d].y)}b.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c]);return a},updatePath:function(a){a&&(a===this.points[0]?(this.points[1].y=a.y,this.points[3].x=a.x):a===this.points[1]?(this.points[0].y=a.y,
this.points[2].x=a.x):a===this.points[2]?(this.points[3].y=a.y,this.points[1].x=a.x):a===this.points[3]&&(this.points[0].x=a.x,this.points[2].y=a.y),this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y);this.bbox.setEmpty();for(a=0;4>a;a++)this.bbox.union(this.points[a].x,this.points[a].y);this.length=2*this.bbox.width+2*this.bbox.height;this.points[0].x=this.bbox.x;this.points[0].y=this.bbox.y;this.points[1].x=this.bbox.x+this.bbox.width;this.points[1].y=this.bbox.y;this.points[2].x=
this.bbox.x+this.bbox.width;this.points[2].y=this.bbox.y+this.bbox.height;this.points[3].x=this.bbox.x;this.points[3].y=this.bbox.y+this.bbox.height;this.points[4].x=this.bbox.x;this.points[4].y=this.bbox.y;return this},getPositionFromLength:function(a){return this.getPosition(a/(2*this.bbox.width+2*this.bbox.height))}};extend(CAAT.RectPath,CAAT.PathSegment);CAAT.ShapePath=CAAT.RectPath})();
(function(){CAAT.Path=function(){CAAT.Path.superclass.constructor.call(this);this.newPosition=new CAAT.Point(0,0,0);this.pathSegments=[];this.behaviorList=[];this.matrix=new CAAT.Matrix;this.tmpMatrix=new CAAT.Matrix;return this};CAAT.Path.prototype={pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:!0,behaviorList:null,rb_angle:0,rb_rotateAnchorX:0.5,rb_rotateAnchorY:0.5,
sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:0.5,sb_scaleAnchorY:0.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,applyAsPath:function(a){var c=a.ctx;a.modelViewMatrix.transformRenderingContext(c);c.beginPath();c.globalCompositeOperation="source-out";c.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var b=0;b<this.pathSegments.length;b++)this.pathSegments[b].applyAsPath(a);
c.globalCompositeOperation="source-over";return this},setInteractive:function(a){this.interactive=a;return this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},
getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(a,c,b,d){this.beginPath(a,c);this.addLineTo(b,d);this.endPath();return this},setQuadric:function(a,c,b,d,e,f){this.beginPath(a,c);this.addQuadricTo(b,d,e,f);this.endPath();return this},setCubic:function(a,c,b,d,e,f,g,h){this.beginPath(a,c);this.addCubicTo(b,d,e,f,g,h);this.endPath();return this},setRectangle:function(a,c,b,d){this.beginPath(a,c);this.addRectangleTo(b,d);this.endPath();return this},
setCatmullRom:function(a,c){c&&(a=a.slice(0),a.unshift(a[a.length-1]),a.push(a[1]),a.push(a[2]));for(var b=1;b<a.length-2;b++){var d=(new CAAT.CurvePath).setColor("#000").setParent(this),e=(new CAAT.CatmullRom).setCurve(a[b-1],a[b],a[b+1],a[b+2]);d.curve=e;this.pathSegments.push(d)}return this},addSegment:function(a){a.setParent(this);this.pathSegments.push(a);return this},addArcTo:function(a,c,b,d,e,f,g){f=new CAAT.ArcPath;f.setArcTo(!0);f.setRadius(e);f.setInitialPosition(a,c).setFinalPosition(b,
d);f.setParent(this);f.setColor(g);this.pathSegments.push(f);return this},addRectangleTo:function(a,c,b,d){var e=new CAAT.RectPath;e.setPoints([this.endCurvePosition(),(new CAAT.Point).set(a,c)]);e.setClockWise(b);e.setColor(d);e.setParent(this);this.pathSegments.push(e);return this},addQuadricTo:function(a,c,b,d,e){var f=new CAAT.Bezier;f.setPoints([this.endCurvePosition(),(new CAAT.Point).set(a,c),(new CAAT.Point).set(b,d)]);this.trackPathX=b;this.trackPathY=d;a=(new CAAT.CurvePath).setColor(e).setParent(this);
a.curve=f;this.pathSegments.push(a);return this},addCubicTo:function(a,c,b,d,e,f,g){var h=new CAAT.Bezier;h.setPoints([this.endCurvePosition(),(new CAAT.Point).set(a,c),(new CAAT.Point).set(b,d),(new CAAT.Point).set(e,f)]);this.trackPathX=e;this.trackPathY=f;a=(new CAAT.CurvePath).setColor(g).setParent(this);a.curve=h;this.pathSegments.push(a);return this},addCatmullTo:function(a,c,b,d,e,f,g){g=(new CAAT.CatmullRom).setColor(g);g.setCurve(this.trackPathX,this.trackPathY,a,c,b,d,e,f);this.trackPathX=
e;this.trackPathY=f;a=(new CAAT.CurvePath).setParent(this);a.curve=g;this.pathSegments.push(a);return this},addLineTo:function(a,c,b){b=(new CAAT.LinearPath).setColor(b);b.setPoints([this.endCurvePosition(),(new CAAT.Point).set(a,c)]);b.setParent(this);this.trackPathX=a;this.trackPathY=c;this.pathSegments.push(b);return this},beginPath:function(a,c){this.trackPathX=a;this.trackPathY=c;this.beginPathX=a;this.beginPathY=c;return this},closePath:function(){this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),
this.getLastPathSegment().numControlPoints()-1);this.trackPathX=this.beginPathX;this.trackPathY=this.beginPathY;this.endPath();return this},endPath:function(){this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];this.updatePath();return this},getPosition:function(a){if(1<a||0>a)a%=1;0>a&&(a=1+a);for(var c=this.pathSegments,b=this.pathSegmentStartTime,d=this.pathSegmentDurationTime,e=0,f=c.length,g,h=this.newPosition,i;e!==f;){g=(f+e)/2|0;i=b[g];if(i<=a&&a<=i+d[g])return a=d[g]?(a-i)/d[g]:
0,a=c[g].getPosition(a),h.x=a.x,h.y=a.y,h;a<i?f=g:e=g+1}return this.endCurvePosition()},getPositionFromLength:function(a){a%=this.getLength();0>a&&(a+=this.getLength());for(var c=0,b=0;b<this.pathSegments.length;b++){if(c<=a&&a<=this.pathSegments[b].getLength()+c){a-=c;a=this.pathSegments[b].getPositionFromLength(a);this.newPosition.x=a.x;this.newPosition.y=a.y;break}c+=this.pathSegments[b].getLength()}return this.newPosition},paint:function(a){for(var c=0;c<this.pathSegments.length;c++)this.pathSegments[c].paint(a,
this.interactive)},release:function(){this.ay=this.ax=-1},getNumSegments:function(){return this.pathSegments.length},getSegment:function(a){return this.pathSegments[a]},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},updatePath:function(a,c){var b,d;this.length=0;this.bbox.setEmpty();this.points=[];var e=Number.MAX_VALUE,f=Number.MAX_VALUE;for(b=0;b<this.pathSegments.length;b++){this.pathSegments[b].updatePath(a);this.length+=this.pathSegments[b].getLength();
this.bbox.unionRectangle(this.pathSegments[b].bbox);for(d=0;d<this.pathSegments[b].numControlPoints();d++){var g=this.pathSegments[b].getControlPoint(d);this.points.push(g);g.x<e&&(e=g.x);g.y<f&&(f=g.y)}}this.clipOffsetX=-e;this.clipOffsetY=-f;this.width=this.bbox.width;this.height=this.bbox.height;this.setPosition(this.bbox.x,this.bbox.y);this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];for(b=0;b<this.pathSegments.length;b++)this.pathSegmentStartTime.push(0),this.pathSegmentDurationTime.push(0);
for(b=0;b<this.pathSegments.length;b++)this.pathSegmentDurationTime[b]=this.getLength()?this.pathSegments[b].getLength()/this.getLength():0,0<b?this.pathSegmentStartTime[b]=this.pathSegmentStartTime[b-1]+this.pathSegmentDurationTime[b-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[b].endPath();this.extractPathPoints();c&&c(this);return this},press:function(a,c){if(this.interactive){for(var b=CAAT.Curve.prototype.HANDLE_SIZE/2,d=0;d<this.pathSegments.length;d++)for(var e=0;e<this.pathSegments[d].numControlPoints();e++){var f=
this.pathSegments[d].getControlPoint(e);if(a>=f.x-b&&c>=f.y-b&&a<f.x+b&&c<f.y+b){this.point=f;return}}this.point=null}},drag:function(a,c,b){if(this.interactive&&null!==this.point){if(-1===this.ax||-1===this.ay)this.ax=a,this.ay=c;this.point.x+=a-this.ax;this.point.y+=c-this.ay;this.ax=a;this.ay=c;this.updatePath(this.point,b)}},getContour:function(a){for(var c=[],b=0;b<=a;b++)c.push((new CAAT.Point).set(b/a,this.getPosition(b/a).y,0));return c},setPoints:function(a){if(this.points.length===a.length)for(var c=
0;c<a.length;c++)this.points[c].x=a[c].x,this.points[c].y=a[c].y;return this},setPoint:function(a,c){0<=c&&c<this.points.length&&(this.points[c].x=a.x,this.points[c].y=a.y);return this},emptyBehaviorList:function(){this.behaviorList=[];return this},extractPathPoints:function(){if(!this.pathPoints){var a;this.pathPoints=[];for(a=0;a<this.numControlPoints();a++)this.pathPoints.push(this.getControlPoint(a).clone())}return this},addBehavior:function(a){this.behaviorList.push(a);return this},removeBehavior:function(a){for(var c=
this.behaviorList.length-1;0<=c;){if(this.behaviorList[c]===a){this.behaviorList.splice(c,1);break}c--}return this},removeBehaviorById:function(a){for(var c=0;c<this.behaviorList.length;c++)this.behaviorList[c].id===a&&this.behaviorList.splice(c,1);return this},applyBehaviors:function(a){for(var c=this.behaviorList.length-1;0<=c;c--)this.behaviorList[c].apply(a,this);this.setATMatrix();for(c=0;c<this.numControlPoints();c++)this.setPoint(this.matrix.transformCoord(this.pathPoints[c].clone().translate(this.clipOffsetX,
this.clipOffsetY)),c);return this},setATMatrix:function(){this.matrix.identity();this.tmpMatrix.identity();var a=this.matrix.matrix,c,b,d,e,f,g,h,i,j,k;h=this.bbox;var l=h.width,n=h.height,m=h.x,p=h.y;h=1;j=e=0;g=1;i=this.tb_x-m-this.tAnchorX*l;k=this.tb_y-p-this.tAnchorY*n;if(this.rb_angle){var o=this.rb_rotateAnchorX*l+m,q=this.rb_rotateAnchorY*n+p;i+=h*o+e*q;k+=j*o+g*q;c=Math.cos(this.rb_angle);b=Math.sin(this.rb_angle);d=h;f=j;h=d*c+e*b;e=-d*b+e*c;j=f*c+g*b;g=-f*b+g*c;i+=-h*o-e*q;k+=-j*o-g*q}if(1!=
this.sb_scaleX||1!=this.sb_scaleY)l=this.sb_scaleAnchorX*l+m,n=this.sb_scaleAnchorY*n+p,i+=h*l+e*n,k+=j*l+g*n,h*=this.sb_scaleX,e*=this.sb_scaleY,j*=this.sb_scaleX,g*=this.sb_scaleY,i+=-h*l-e*n,k+=-j*l-g*n;a[0]=h;a[1]=e;a[2]=i;a[3]=j;a[4]=g;a[5]=k;return this},setRotationAnchored:function(a,c,b){this.rb_angle=a;this.rb_rotateAnchorX=c;this.rb_rotateAnchorY=b;return this},setRotationAnchor:function(a,c){this.rb_rotateAnchorX=a;this.rb_rotateAnchorY=c},setRotation:function(a){this.rb_angle=a},setScaleAnchored:function(a,
c,b,d){this.sb_scaleX=a;this.sb_scaleAnchorX=b;this.sb_scaleY=c;this.sb_scaleAnchorY=d;return this},setScale:function(a,c){this.sb_scaleX=a;this.sb_scaleY=c;return this},setScaleAnchor:function(a,c){this.sb_scaleAnchorX=a;this.sb_scaleAnchorY=c;return this},setPositionAnchor:function(a,c){this.tAnchorX=a;this.tAnchorY=c;return this},setPositionAnchored:function(a,c,b,d){this.tb_x=a;this.tb_y=c;this.tAnchorX=b;this.tAnchorY=d;return this},setPosition:function(a,c){this.tb_x=a;this.tb_y=c;return this},
setLocation:function(a,c){return this.setPosition(a,c)},flatten:function(a,c){for(var b=this.getPositionFromLength(0),d=(new CAAT.Path).beginPath(b.x,b.y),e=0;e<a;e++)b=this.getPositionFromLength(e/a*this.length),d.addLineTo(b.x,b.y);c?d.closePath():d.endPath();return d}};extend(CAAT.Path,CAAT.PathSegment,null)})();(function(){CAAT.PathActor=function(){CAAT.PathActor.superclass.constructor.call(this);return this};CAAT.PathActor.prototype={path:null,pathBoundingRectangle:null,bOutline:!1,outlineColor:"black",onUpdateCallback:null,interactive:!1,showBBox:!1,getPath:function(){return this.path},setPath:function(a){this.path=a;null!=a&&(this.pathBoundingRectangle=a.getBoundingBox(),this.setInteractive(this.interactive));return this},paint:function(a,c){CAAT.PathActor.superclass.paint.call(this,a,c);if(this.path){var b=
a.ctx;b.strokeStyle="#000";this.path.paint(a,this.interactive);this.bOutline&&(b.strokeStyle=this.outlineColor,b.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height))}},showBoundingBox:function(a,c){if((this.bOutline=a)&&c)this.outlineColor=c;return this},setInteractive:function(a){this.interactive=a;this.path&&this.path.setInteractive(a);return this},setOnUpdateCallback:function(a){this.onUpdateCallback=a;return this},
mouseDrag:function(a){this.path.drag(a.point.x,a.point.y,this.onUpdateCallback)},mouseDown:function(a){this.path.press(a.point.x,a.point.y)},mouseUp:function(){this.path.release()}};extend(CAAT.PathActor,CAAT.ActorContainer,null)})();(function(){CAAT.ImageProcessor=function(){return this};CAAT.ImageProcessor.prototype={canvas:null,ctx:null,width:0,height:0,imageData:null,bufferImage:null,grabPixels:function(a){var c=document.createElement("canvas");if(null!==c){c.width=a.width;c.height=a.height;var b=c.getContext("2d");b.drawImage(a,0,0);try{return b.getImageData(0,0,c.width,c.height)}catch(d){CAAT.log("error pixelgrabbing.",a)}}return null},makeArray:function(a,c){for(var b=[],d=0;d<a;d++)b.push(c);return b},makeArray2D:function(a,
c,b){for(var d=[],e=0;e<a;e++)d.push(this.makeArray(c,b));return d},initialize:function(a,c){this.width=a;this.height=c;this.canvas=document.createElement("canvas");null!==this.canvas&&(this.canvas.width=a,this.canvas.height=c,this.ctx=this.canvas.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,a,c),this.bufferImage=this.imageData.data);return this},clear:function(a,c,b,d){if(null===this.imageData)return this;for(var e=this.imageData.data,f=0;f<this.width*this.height;f++)e[4*f+0]=a,e[4*
f+1]=c,e[4*f+2]=b,e[4*f+3]=d;this.imageData.data=e;return this},getImageData:function(){return this.ctx.getImageData(0,0,this.width,this.height)},apply:function(){null!==this.imageData&&(this.imageData.data=this.bufferImage,this.ctx.putImageData(this.imageData,0,0));return this},getCanvas:function(){return this.canvas},createPattern:function(a){return this.ctx.createPattern(this.canvas,a?a:"repeat")},paint:function(a){null!==this.canvas&&a.ctx.drawImage(this.getCanvas(),0,0)}}})();
(function(){CAAT.IMPlasma=function(){CAAT.IMPlasma.superclass.constructor.call(this);return this};CAAT.IMPlasma.prototype={wavetable:null,m_colorMap:null,spd1:1,spd2:2,spd3:3,spd4:4,pos1:0,pos2:0,pos3:0,pos4:0,tpos1:0,tpos2:0,tpos3:0,tpos4:0,m_colorMapSize:256,i1:0,i2:0,i3:0,i4:0,b1:!1,b2:!1,b3:!1,b4:!1,color:[4294967295,4294902015,4294967040,4278255360,4294901760,4278190335,4278190080],initialize:function(a,c,b){CAAT.IMPlasma.superclass.initialize.call(this,a,c);this.wavetable=[];for(a=0;256>a;a++)this.wavetable.push(Math.floor(32*
(1+Math.cos(2*a*Math.PI/256))));this.pos1=Math.floor(255*Math.random());this.pos2=Math.floor(255*Math.random());this.pos3=Math.floor(255*Math.random());this.pos4=Math.floor(255*Math.random());this.m_colorMap=CAAT.Color.prototype.makeRGBColorRamp(null!==b?b:this.color,256,CAAT.Color.prototype.RampEnumeration.RAMP_CHANNEL_RGBA_ARRAY);this.setB();return this},setB:function(){this.b1=0.5<Math.random();this.b2=0.5<Math.random();this.b3=0.5<Math.random();this.b4=0.5<Math.random();this.spd1=Math.floor((3*
Math.random()+1)*(0.5>Math.random()?1:-1));this.spd2=Math.floor((3*Math.random()+1)*(0.5>Math.random()?1:-1));this.spd3=Math.floor((3*Math.random()+1)*(0.5>Math.random()?1:-1));this.spd4=Math.floor((3*Math.random()+1)*(0.5>Math.random()?1:-1));this.i1=Math.floor((2.4*Math.random()+1)*(0.5>Math.random()?1:-1));this.i2=Math.floor((2.4*Math.random()+1)*(0.5>Math.random()?1:-1));this.i3=Math.floor((2.4*Math.random()+1)*(0.5>Math.random()?1:-1));this.i4=Math.floor((2.4*Math.random()+1)*(0.5>Math.random()?
1:-1))},apply:function(a,c){var b=0;this.tpos1=this.pos1;this.tpos2=this.pos2;for(var d=this.bufferImage,e=this.m_colorMap,f=this.wavetable,g,h=0;h<this.height;h++){this.tpos3=this.pos3;this.tpos4=this.pos4;for(var i=0;i<this.width;i++){g=this.tpos1+this.tpos2+this.tpos3;var j=this.tpos2+this.tpos3-this.tpos1,k=this.tpos3+this.tpos4-this.tpos2,l=this.tpos4+this.tpos1-this.tpos2;this.b1&&(g=-g);this.b2&&(j=-j);this.b3&&(k=-k);this.b4&&(l=-l);g=Math.floor(f[g&255]+f[j&255]+f[k&255]+f[l&255]);g=e[g];
d[b++]=g[0];d[b++]=g[1];d[b++]=g[2];d[b++]=g[3];this.tpos3+=this.i1;this.tpos3&=255;this.tpos4+=this.i2;this.tpos4&=255}this.tpos1+=this.i3;this.tpos1&=255;this.tpos2+=this.i4;this.tpos2&=255}this.pos1+=this.spd1;this.pos2-=this.spd2;this.pos3+=this.spd3;this.pos4-=this.spd4;this.pos1&=255;this.pos3&=255;this.pos2&=255;this.pos4&=255;return CAAT.IMPlasma.superclass.apply.call(this,a,c)}};extend(CAAT.IMPlasma,CAAT.ImageProcessor,null)})();
(function(){CAAT.IMBump=function(){CAAT.IMBump.superclass.constructor.call(this);return this};CAAT.IMBump.prototype={m_avgX:null,m_avgY:null,m_tt:null,phong:null,m_radius:75,m_lightcolor:null,bcolor:!1,lightPosition:[],prepareBump:function(a,c){var b,d;this.m_radius=c?c:75;d=this.grabPixels(a);this.m_tt=this.makeArray(this.height,0);for(b=0;b<this.height;b++)this.m_tt[b]=this.width*b;this.m_avgX=this.makeArray2D(this.height,this.width,0);this.m_avgY=this.makeArray2D(this.height,this.width,0);var e=
this.makeArray2D(this.height,this.width,0);if(null!==d){var f=d.data;for(b=0;b<this.height;b++)for(d=0;d<this.width;d++){var g=4*(b*this.width+d);e[b][d]=f[g]+f[g+1]+f[g+2]}e=this.soften(e);for(b=1;b<this.width-1;b++)for(d=1;d<this.height-1;d++)this.m_avgX[d][b]=Math.floor(e[d][b+1]-e[d][b-1]),this.m_avgY[d][b]=Math.floor(e[d+1][b]-e[d-1][b])}},soften:function(a){for(var c,b=this.makeArray2D(this.height,this.width,0),d=0;d<this.width;d++)for(var e=0;e<this.height;e++)c=a[e][d],c+=a[(e+1)%this.height][d],
c+=a[(e+this.height-1)%this.height][d],c+=a[e][(d+1)%this.width],c+=a[e][(d+this.width-1)%this.width],c+=a[(e+1)%this.height][(d+1)%this.width],c+=a[(e+this.height-1)%this.height][(d+this.width-1)%this.width],c+=a[(e+this.height-1)%this.height][(d+1)%this.width],c+=a[(e+1)%this.height][(d+this.width-1)%this.width],c/=9,b[e][d]=c/3;return b},calculatePhong:function(){this.phong=this.makeArray2D(this.m_radius,this.m_radius,0);var a,c,b;for(a=0;a<this.m_radius;a++)for(c=0;c<this.m_radius;c++){b=c/this.m_radius;
var d=a/this.m_radius;b=0.8*(1-Math.sqrt(b*b+d*d));0>b&&(b=0);this.phong[a][c]=Math.floor(255*b)}},drawColored:function(a){var c,b,d;for(c=0;c<this.height;c++)for(b=0;b<this.width;b++){var e=0,f=0,g=0;for(d=0;d<this.m_lightcolor.length;d++){var h=this.lightPosition[d].y,i=Math.floor(Math.abs(this.m_avgX[c][b]-b+this.lightPosition[d].x)),h=Math.floor(Math.abs(this.m_avgY[c][b]-c+h));i>=this.m_radius&&(i=this.m_radius-1);h>=this.m_radius&&(h=this.m_radius-1);var i=this.phong[i][h],j=h=0,k=0;0<=i?(h=
this.m_lightcolor[d][0]*i/128,j=this.m_lightcolor[d][1]*i/128,k=this.m_lightcolor[d][2]*i/128):(i=128+i,h=this.m_lightcolor[d][0],j=this.m_lightcolor[d][1],k=this.m_lightcolor[d][2],h=Math.floor(h+(255-h)*i/128),j=Math.floor(j+(255-j)*i/128),k=Math.floor(k+(255-k)*i/128));e+=h;f+=j;g+=k}255<e&&(e=255);255<f&&(f=255);255<g&&(g=255);d=4*(b+this.m_tt[c]);a[d]=e;a[d+1]=f;a[d+2]=g;a[d+3]=255}},setLightColors:function(a){this.m_lightcolor=a;this.lightPosition=[];for(a=0;a<this.m_lightcolor.length;a++){var c=
this.width*Math.random(),b=this.height*Math.random();this.lightPosition.push((new CAAT.Point).set(c,b))}return this},initialize:function(a,c){CAAT.IMBump.superclass.initialize.call(this,a.width,a.height);this.setLightColors([[255,128,0],[0,0,255]]);this.prepareBump(a,c);this.calculatePhong();return this},setLightPosition:function(a,c,b){this.lightPosition[a].set(c,b);return this},apply:function(a,c){this.drawColored(this.bufferImage);return CAAT.IMBump.superclass.apply.call(this,a,c)}};extend(CAAT.IMBump,
CAAT.ImageProcessor,null)})();
(function(){CAAT.IMRotoZoom=function(){CAAT.IMRotoZoom.superclass.constructor.call(this);return this};CAAT.IMRotoZoom.prototype={m_alignv:1,m_alignh:1,distortion:2,mask:0,shift:0,sourceImageData:null,initialize:function(a,c,b){CAAT.IMRotoZoom.superclass.initialize.call(this,a,c);this.clear(255,128,0,255);this.sourceImageData=this.grabPixels(b);if(null!==this.sourceImageData)switch(this.sourceImageData.width){case 1024:this.mask=1023;this.shift=10;break;case 512:this.mask=511;this.shift=9;break;case 256:this.mask=
255;this.shift=8;break;case 128:this.mask=127;this.shift=7;break;case 64:this.mask=63;this.shift=6;break;case 32:this.mask=31;this.shift=5;break;case 16:this.mask=15;this.shift=4;break;case 8:this.mask=7,this.shift=3}this.setCenter();return this},rotoZoom:function(){var a=(new Date).getTime(),c=2*Math.PI*Math.cos(1.0E-4*a),b=600+550*Math.sin(2.0E-4*a),a=this.distortion,d=0,e=Math.floor(Math.cos(c)*b),c=Math.floor(Math.sin(c)*b),f=0,g=0;switch(this.m_alignh){case 0:f=0;break;case 1:f=this.height>>
1;break;case 2:f=this.height-1}switch(this.m_alignv){case 0:g=0;break;case 1:g=this.width>>1;break;case 2:g=this.width-1}for(var b=(this.width>>1<<8)-e*g+c*f&65535,f=(this.height>>1<<8)-c*g-e*f&65535,g=this.sourceImageData.width,h=this.sourceImageData.data,i=this.bufferImage,j,k,l;d<4*this.width*this.height;){k=b;l=f;for(var n=0;n<this.width;n++)j=(l>>this.shift&this.mask)*g+(k>>this.shift&this.mask),j<<=2,i[d++]=h[j++],i[d++]=h[j++],i[d++]=h[j++],i[d++]=h[j++],k+=e,l+=c;a+=this.distortion;b-=c;f+=
e-a}},apply:function(a,c){null!==this.sourceImageData&&this.rotoZoom(a,c);return CAAT.IMRotoZoom.superclass.apply.call(this,a,c)},setCenter:function(){var a=Math.random();this.m_alignv=0.33>a?0:0.66>a?1:2;a=Math.random();this.m_alignh=0.33>a?0:0.66>a?1:2}};extend(CAAT.IMRotoZoom,CAAT.ImageProcessor,null)})();(function(){CAAT.Program=function(a){this.gl=a;return this};CAAT.Program.prototype={shaderProgram:null,gl:null,setAlpha:function(){},getShader:function(a,c,b){if("x-shader/x-fragment"===c)c=a.createShader(a.FRAGMENT_SHADER);else if("x-shader/x-vertex"===c)c=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(c,b);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?(alert(a.getShaderInfoLog(c)),null):c},getDomShader:function(a,c){var b=document.getElementById(c);if(!b)return null;
for(var d="",e=b.firstChild;e;)3===e.nodeType&&(d+=e.textContent),e=e.nextSibling;if("x-shader/x-fragment"===b.type)b=a.createShader(a.FRAGMENT_SHADER);else if("x-shader/x-vertex"===b.type)b=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(b,d);a.compileShader(b);return!a.getShaderParameter(b,a.COMPILE_STATUS)?(alert(a.getShaderInfoLog(b)),null):b},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var a=
this.gl;this.shaderProgram=a.createProgram();a.attachShader(this.shaderProgram,this.getVertexShader());a.attachShader(this.shaderProgram,this.getFragmentShader());a.linkProgram(this.shaderProgram);a.useProgram(this.shaderProgram);return this},setMatrixUniform:function(a){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,new Float32Array(a.flatten()))},useProgram:function(){this.gl.useProgram(this.shaderProgram);return this}}})();
(function(){CAAT.ColorProgram=function(a){CAAT.ColorProgram.superclass.constructor.call(this,a);return this};CAAT.ColorProgram.prototype={colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},
initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor");this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.useProgram();this.colorBuffer=this.gl.createBuffer();
this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(6144);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0);return CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(a){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
this.colorBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,!1,0,0)}};extend(CAAT.ColorProgram,CAAT.Program,null)})();
(function(){CAAT.TextureProgram=function(a){CAAT.TextureProgram.superclass.constructor.call(this,a);return this};CAAT.TextureProgram.prototype={vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},
getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);
this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var a;this.linesBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var c=[];for(a=0;1024>a;a++)c[a]=a;this.linesBufferArray=new Uint16Array(c);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW);this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);
this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord");this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler");this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha");this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,
"uUseColor");this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor");this.setAlpha(1);this.setUseColor(!1);this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(49152);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0);this.vertexUVBuffer=this.gl.createBuffer();
this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.vertexUVArray=new Float32Array(32768);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,!1,0,0);this.vertexIndexBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);c=[];for(a=0;4096>a;a++)c.push(0+4*a),c.push(1+4*a),c.push(2+4*a),c.push(0+4*a),c.push(2+4*a),c.push(3+4*
a);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),this.gl.DYNAMIC_DRAW);return CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(a,c,b,d,e){this.gl.uniform1i(this.shaderProgram.useColor,a?1:0);if(a&&(this.prevA!==e||this.prevR!==c||this.prevG!==b||this.prevB!==d))this.gl.uniform4f(this.shaderProgram.color,c,b,d,e),this.prevA=e,this.prevR=c,this.prevG=b,this.prevB=d},setTexture:function(a){if(this.prevTexture!==a){var c=this.gl;c.activeTexture(c.TEXTURE0);
c.bindTexture(c.TEXTURE_2D,a);c.uniform1i(this.shaderProgram.samplerUniform,0);this.prevTexture=a}return this},updateVertexBuffer:function(a){var c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,this.vertexPositionBuffer);c.bufferSubData(c.ARRAY_BUFFER,0,a);return this},updateUVBuffer:function(a){var c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,this.vertexUVBuffer);c.bufferSubData(c.ARRAY_BUFFER,0,a);return this},setAlpha:function(a){this.prevAlpha!==a&&(this.gl.uniform1f(this.shaderProgram.alphaUniform,a),this.prevAlpha=
a);return this},drawLines:function(a,c,b,d,e,f,g){var h=this.gl;this.setAlpha(f);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer);h.lineWidth(g);this.updateVertexBuffer(a);this.setUseColor(!0,b,d,e,1);h.drawElements(h.LINES,c,h.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(!1);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(a,c,b,d,e,f,g){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer);h.lineWidth(g);this.setAlpha(f);this.updateVertexBuffer(a);
this.setUseColor(!0,b,d,e,1);h.drawElements(h.LINE_STRIP,c,h.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(!1);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}};extend(CAAT.TextureProgram,CAAT.Program,null)})();function makePerspective(a,c,b,d,e){var a=b*Math.tan(a*Math.PI/360),f=-a;return makeFrustum(f*c,a*c,f,a,b,d,e)}function makeFrustum(a,c,b,d,e,f,g){var h=2*e/(c-a),i=2*e/(d-b),a=(c+a)/(c-a),b=(d+b)/(d-b),d=-(f+e)/(f-e),e=-2*f*e/(f-e);return(new CAAT.Matrix3).initWithMatrix([[h,0,a,-g/2],[0,-i,b,g/2],[0,0,d,e],[0,0,-1,0]])}
function makeOrtho(a,c,b,d,e,f){var g=-(c+a)/(c-a),h=-(d+b)/(d-b),i=-(f+e)/(f-e);return(new CAAT.Matrix3).initWithMatrix([[2/(c-a),0,0,g],[0,2/(d-b),0,h],[0,0,-2/(f-e),i],[0,0,0,1]])};(function(){CAAT.GLTextureElement=function(){return this};CAAT.GLTextureElement.prototype={inverted:!1,image:null,u:0,v:0,glTexture:null}})();
(function(){CAAT.GLTextureScan=function(a){this.freeChunks=[{position:0,size:a||1024}];return this};CAAT.GLTextureScan.prototype={freeChunks:null,findWhereFits:function(a){if(0===this.freeChunks.length)return[];var c=[],b;for(b=0;b<this.freeChunks.length;b++)for(var d=0;d+a<=this.freeChunks[b].size;)c.push(d+this.freeChunks[b].position),d+=a;return c},fits:function(a,c){for(var b=0,b=0;b<this.freeChunks.length;b++){var d=this.freeChunks[b];if(d.position<=a&&a+c<=d.position+d.size)return!0}return!1},
substract:function(a,c){for(var b=0,b=0;b<this.freeChunks.length;b++){var d=this.freeChunks[b];if(d.position<=a&&a+c<=d.position+d.size){var e=0,f=0,g=0,h=0,e=d.position,f=a-d.position,g=a+c,h=d.position+d.size-g;this.freeChunks.splice(b,1);0<f&&this.freeChunks.splice(b++,0,{position:e,size:f});0<h&&this.freeChunks.splice(b,0,{position:g,size:h});return!0}}return!1},log:function(a){if(0===this.freeChunks.length)CAAT.log("index "+a+" empty");else{for(var a="index "+a,c=0;c<this.freeChunks.length;c++)var b=
this.freeChunks[c],a=a+("["+b.position+","+b.size+"]");CAAT.log(a)}}}})();
(function(){CAAT.GLTextureScanMap=function(a,c){this.scanMapHeight=c;this.scanMapWidth=a;this.scanMap=[];for(var b=0;b<this.scanMapHeight;b++)this.scanMap.push(new CAAT.GLTextureScan(this.scanMapWidth));return this};CAAT.GLTextureScanMap.prototype={scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(a,c){if(a>this.width||c>this.height)return null;for(var b,d,e=0;e<=this.scanMapHeight-c;){var f=null;for(b=!1;e<=this.scanMapHeight-c;e++)if(f=this.scanMap[e].findWhereFits(a),null!==f&&
0<f.length){b=!0;break}if(b){for(d=0;d<f.length;d++){var g=!0;for(b=e;b<e+c;b++)if(!this.scanMap[b].fits(f[d],a)){g=!1;break}if(g)return{x:f[d],y:e}}e++}else break}return null},substract:function(a,c,b,d){for(var e=0;e<d;e++)this.scanMap[e+c].substract(a,b)||CAAT.log("Error: removing chunk ",b,d," at ",a,c)},log:function(){for(var a=0;a<this.scanMapHeight;a++)this.scanMap[a].log(a)}}})();
(function(){CAAT.GLTexturePage=function(a,c){this.width=a||1024;this.height=c||1024;this.images=[];return this};CAAT.GLTexturePage.prototype={width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:!1,padding:4,scan:null,images:null,criteria:"area",initialize:function(a){this.gl=a;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.texture);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var c=new Uint8Array(4*this.width*
this.height),b=0;b<4*this.width*this.height;)c[b++]=0,c[b++]=0,c[b++]=0,c[b++]=0;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,c);a.enable(a.BLEND);for(c=0;c<this.images.length;c++)b=this.images[c],b.inverted&&(b=CAAT.modules.ImageUtil.prototype.rotate(b,-90)),a.texSubImage2D(a.TEXTURE_2D,0,this.images[c].__tx,this.images[c].__ty,a.RGBA,a.UNSIGNED_BYTE,b)},create:function(a){for(var c=[],b=0;b<a.length;b++){var d=a[b].image;d.__texturePage||c.push(d)}this.createFromImages(c)},
clear:function(){this.createFromImages([])},update:function(a,c,b,d){this.allowImagesInvertion=a;this.padding=c;100>b&&(b=100);100>d&&(d=100);this.width=b;this.height=d;this.createFromImages(this.images)},createFromImages:function(a){var c;this.scan=new CAAT.GLTextureScanMap(this.width,this.height);this.images=[];if(this.allowImagesInvertion)for(c=0;c<a.length;c++)a[c].inverted=this.allowImagesInvertion&&a[c].height<a[c].width;var b=this;a.sort(function(a,c){var f=a.width*a.height,g=c.width*c.height;
return"width"===b.criteria?a.width<c.width?1:a.width>c.width?-1:0:"height"===b.criteria?a.height<c.height?1:a.height>c.height?-1:0:f<g?1:f>g?-1:0});for(c=0;c<a.length;c++)this.packImage(a[c])},addImage:function(a,c,b){this.allowImagesInvertion=c;this.padding=b;this.images.push(a);this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var a=this.gl;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST);
a.generateMipmap(a.TEXTURE_2D)},deletePage:function(){for(var a=0;a<this.images.length;a++)delete this.images[a].__texturePage,delete this.images[a].__u,delete this.images[a].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(a,c){a=a||document.createElement("canvas");a.width=this.width;a.height=this.height;var b=a.getContext("2d");b.fillStyle="rgba(0,0,0,0)";b.fillRect(0,0,this.width,this.height);for(var d=0;d<this.images.length;d++)b.drawImage(!this.images[d].inverted?this.images[d]:CAAT.modules.ImageUtil.prototype.rotate(this.images[d],
90),this.images[d].__tx,this.images[d].__ty),c&&(b.strokeStyle="red",b.strokeRect(this.images[d].__tx,this.images[d].__ty,this.images[d].__w,this.images[d].__h));c&&(b.strokeStyle="red",b.strokeRect(0,0,this.width,this.height));return a},packImage:function(a){var c,b;a.inverted?(c=a.height,b=a.width):(c=a.width,b=a.height);var d=c,e=b,f;d&&this.padding&&(f=this.padding,d+f<=this.width&&(d+=f));e&&this.padding&&(f=this.padding,e+f<=this.height&&(e+=f));f=this.scan.whereFitsChunk(d,e);null!==f?(this.images.push(a),
a.__tx=f.x,a.__ty=f.y,a.__u=f.x/this.width,a.__v=f.y/this.height,a.__u1=(f.x+c)/this.width,a.__v1=(f.y+b)/this.height,a.__texturePage=this,a.__w=c,a.__h=b,this.scan.substract(f.x,f.y,d,e)):CAAT.log("Imagen ",a.src," de tamano ",a.width,a.height," no cabe.")},changeHeuristic:function(a){this.criteria=a}}})();
(function(){CAAT.GLTexturePageManager=function(){this.pages=[];return this};CAAT.GLTexturePageManager.prototype={pages:null,createPages:function(a,c,b,d){for(var e=!1;!e;){e=new CAAT.GLTexturePage(c,b);e.create(d);e.initialize(a);e.endCreation();this.pages.push(e);for(var e=!0,f=0;f<d.length;f++)if(!d[f].image.__texturePage){d[f].image.width<=c&&d[f].image.height<=b&&(e=!1);break}}},deletePages:function(){for(var a=0;a<this.pages.length;a++)this.pages[a].deletePage();this.pages=null}}})();
